(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{440:function(s,n,e){"use strict";e.r(n);var a=e(51),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"greenplum高可用部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#greenplum高可用部署"}},[s._v("#")]),s._v(" Greenplum高可用部署")]),s._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("p",[s._v("greenplum已更新至6.0版本，本文将带大家实战6.0高可用架构。")]),s._v(" "),e("h2",{attrs:{id:"下载软件包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载软件包"}},[s._v("#")]),s._v(" 下载软件包")]),s._v(" "),e("p",[s._v("登录"),e("a",{attrs:{href:"https://network.pivotal.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("Pivotal官网"),e("OutboundLink")],1),s._v("下载rpm安装包。")]),s._v(" "),e("blockquote",[e("p",[s._v("注：\n如果无法下载可能是你注册的时候城市选择了国内城市，可以重新注册选择国外城市即可。")])]),s._v(" "),e("h2",{attrs:{id:"配置系统"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置系统"}},[s._v("#")]),s._v(" 配置系统")]),s._v(" "),e("h3",{attrs:{id:"禁用selinu和firewall"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#禁用selinu和firewall"}},[s._v("#")]),s._v(" 禁用SELinu和Firewall")]),s._v(" "),e("p",[s._v("vi /etc/selinux/config")]),s._v(" "),e("blockquote",[e("p",[s._v("SELINUX=disabled")])]),s._v(" "),e("p",[s._v("关闭防火墙")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl stop firewalld.service\nsystemctl disable firewalld.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"系统参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#系统参数"}},[s._v("#")]),s._v(" 系统参数")]),s._v(" "),e("p",[e("strong",[s._v("/etc/sysctl.conf")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# kernel.shmall = _PHYS_PAGES / 2 # echo $(expr $(getconf _PHYS_PAGES) / 2)\nkernel.shmall = 8000000\n# kernel.shmmax = kernel.shmall * PAGE_SIZE # echo $(expr $(getconf _PHYS_PAGES) / 2 \\* $(getconf PAGE_SIZE))\nkernel.shmmax = 30000000000\nkernel.shmmni = 4096\nvm.overcommit_memory = 2\nvm.overcommit_ratio = 95\nnet.ipv4.ip_local_port_range = 10000 65535\nkernel.sem = 500 2048000 200 40960\nkernel.sysrq = 1\nkernel.core_uses_pid = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nkernel.msgmni = 2048\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.conf.default.accept_source_route = 0\nnet.ipv4.tcp_max_syn_backlog = 4096\nnet.ipv4.conf.all.arp_filter = 1\nnet.core.netdev_max_backlog = 10000\nnet.core.rmem_max = 2097152\nnet.core.wmem_max = 2097152\nvm.swappiness = 10\nvm.zone_reclaim_mode = 0\nvm.dirty_expire_centisecs = 500\nvm.dirty_writeback_centisecs = 100\n# 以下4项是64GB物理内存的优化建议，如果小于64GB，则删除vm.dirty_background_bytes和vm.dirty_bytes，同事设置vm.dirty_background_ratio = 3，vm.dirty_ratio = 10。\nvm.dirty_background_ratio = 0\nvm.dirty_ratio = 0\nvm.dirty_background_bytes = 1610612736\nvm.dirty_bytes = 4294967296\n# vm.min_free_kbytes不可高于5%的物理内存，awk \'BEGIN {OFMT = "%.0f";} /MemTotal/ {print "vm.min_free_kbytes =", $2 * .03;}\' /proc/meminfo >> /etc/sysctl.conf\nvm.min_free_kbytes = 1972773\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br")])]),e("p",[e("strong",[s._v("/etc/security/limits.conf")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@gpadmin soft nofile 655350\n@gpadmin hard nofile 655350\n@gpadmin soft nproc 655350\n@gpadmin hard nproc 655350\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("文件系统建议挂载配置")])]),s._v(" "),e("p",[e("code",[s._v("/dev/data /data xfs nodev,noatime,nobarrier,inode64 0 0")])]),s._v(" "),e("p",[e("strong",[s._v("配置预读")])]),s._v(" "),e("p",[e("code",[s._v("/sbin/blockdev --setra 16384 /dev/sdb")])]),s._v(" "),e("p",[e("strong",[s._v("IO调度策略")])]),s._v(" "),e("p",[e("code",[s._v("echo deadline > /sys/block/sbd/queue/scheduler")])]),s._v(" "),e("p",[e("strong",[s._v("禁用 Transparent Huge Pages (THP)")])]),s._v(" "),e("p",[e("code",[s._v('# grubby --update-kernel=ALL --args="transparent_hugepage=never"')])]),s._v(" "),e("p",[e("code",[s._v("# cat /sys/kernel/mm/*transparent_hugepage/enabled")])]),s._v(" "),e("p",[e("strong",[s._v("禁用IPC")])]),s._v(" "),e("p",[s._v("/etc/systemd/logind.conf添加：")]),s._v(" "),e("blockquote",[e("p",[s._v("RemoveIPC=no")])]),s._v(" "),e("p",[s._v("service systemd-logind restart")]),s._v(" "),e("p",[e("strong",[s._v("/etc/hosts 增加所有节点主机民解析")])]),s._v(" "),e("p",[s._v("也可以使用dns解析。")]),s._v(" "),e("p",[e("strong",[s._v("创建gpadmin用户")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# groupadd gpadmin")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# useradd gpadmin -g gpadmin")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# passwd gpadmin")]),s._v("\nNew password: "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("changeme"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nRetype new password: "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("changeme"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("创建目录")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /greenplum/primary\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /greenplum/mirror\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R gpadmin. /greenplum\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /greenplum\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),e("p",[s._v("在所有host上安装greenplum-db-6.0.0-rhel7-x86_64.rpm包")]),s._v(" "),e("blockquote",[e("p",[s._v("yum install greenplum-db-6.0.0-rhel7-x86_64.rpm")])]),s._v(" "),e("p",[s._v("安装完成后在/usr/local下生成如下目录：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("lrwxrwxrwx   1 root root   29 Sep 16 11:41 greenplum-db -> /usr/local/greenplum-db-6.0.0\ndrwxr-xr-x  11 root root  235 Sep 16 11:41 greenplum-db-6.0.0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("修改一下属组")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R gpadmin /usr/local/greenplum*\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chgrp")]),s._v(" -R gpadmin /usr/local/greenplum*\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("修改gpadmin用户环境变量.bash_profile，增加：")]),s._v(" "),e("blockquote",[e("p",[s._v('echo "source /usr/local/greenplum-db/greenplum_path.sh">>~gpadmin/.bash_profile')])]),s._v(" "),e("p",[s._v("配置所有节点的gpadmin用户之间免密登录。具体方法自行搜索了。")]),s._v(" "),e("h2",{attrs:{id:"初始化db"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化db"}},[s._v("#")]),s._v(" 初始化DB")]),s._v(" "),e("p",[s._v("编辑gpinitsystem_config，这里我们直接启用了mirror。如果不需要mirror去掉mirror相关配置"),e("code",[s._v("MIRROR_PORT_BASE、REPLICATION_PORT_BASE 、MIRROR_REPLICATION_PORT_BASE 、MIRROR_DATA_DIRECTORY")]),s._v("注释即可。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# FILE NAME: gpinitsystem_config\n\n# Configuration file needed by the gpinitsystem\n\n################################################\n#### REQUIRED PARAMETERS\n################################################\n\n#### Name of this Greenplum system enclosed in quotes.\nARRAY_NAME="mydw"\n\n#### Naming convention for utility-generated data directories.\nSEG_PREFIX=gpseg\n\n#### Base number by which primary segment port numbers\n#### are calculated.\nPORT_BASE=40000\n\n#### File system location(s) where primary segment data directories\n#### will be created. The number of locations in the list dictate\n#### the number of primary segments that will get created per\n#### physical host (if multiple addresses for a host are listed in\n#### the hostfile, the number of segments will be spread evenly across\n#### the specified interface addresses).\n#### 要启动几个segment就写几个，比如下面启动4个segment（每个core对应一个segemnt）\ndeclare -a DATA_DIRECTORY=(/greenplum/primary /greenplum/primary /greenplum/primary /greenplum/primary)\n\n#### OS-configured hostname or IP address of the master host.\nMASTER_HOSTNAME=greenplum-001.test.com\n\n#### File system location where the master data directory\n#### will be created.\nMASTER_DIRECTORY=/greenplum/master\n\n#### Port number for the master instance.\nMASTER_PORT=1921\n\n#### Shell utility used to connect to remote hosts.\nTRUSTED_SHELL=ssh\n\n#### Maximum log file segments between automatic WAL checkpoints.\nCHECK_POINT_SEGMENTS=256\n\n#### Default server-side character set encoding.\nENCODING=UTF-8\n\n################################################\n#### OPTIONAL MIRROR PARAMETERS\n################################################\n\n#### Base number by which mirror segment port numbers\n#### are calculated.\nMIRROR_PORT_BASE=50000\n\n#### Base number by which primary file replication port\n#### numbers are calculated.\nREPLICATION_PORT_BASE=41000\n\n#### Base number by which mirror file replication port\n#### numbers are calculated.\nMIRROR_REPLICATION_PORT_BASE=51000\n\n#### File system location(s) where mirror segment data directories\n#### will be created. The number of mirror locations must equal the\n#### number of primary locations as specified in the\n#### DATA_DIRECTORY parameter.\n#### declare -a MIRROR_DATA_DIRECTORY=(/gpdata/mirror /gpdata/mirror)\n#### 有几个primary segment这里就对应的写几个mirror segment，不写则表示不启用高可用特性\ndeclare -a MIRROR_DATA_DIRECTORY=(/greenplum/mirror /greenplum/mirror /greenplum/mirror /greenplum/mirror)\n\n\n################################################\n#### OTHER OPTIONAL PARAMETERS\n################################################\n\n#### Create a database of this name after initialization.\nDATABASE_NAME=mydw\n\n#### Specify the location of the host address file here instead of\n#### with the the -h option of gpinitsystem.\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br")])]),e("p",[s._v("编辑hosts文件，写入所有segent节点的hostname，如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("greenplum-001.test.com\ngreenplum-002.test.com\ngreenplum-003.test.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("执行初始化命令：")]),s._v(" "),e("blockquote",[e("p",[s._v("gpinitsystem -c gpinitsystem_config -h hosts --max_connections=500 --shared_buffers=256MB")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[INFO]:-Checking new segment hosts, Completed\n[INFO]:-Greenplum Database Creation Parameters\n[INFO]:---------------------------------------\n[INFO]:-Master Configuration\n[INFO]:---------------------------------------\n[INFO]:-Master instance name       = mydw\n[INFO]:-Master hostname            = greenplum-001.test.com\n[INFO]:-Master port                = 1921\n[INFO]:-Master instance dir        = /greenplum/master/gpseg-1\n[INFO]:-Master LOCALE              = en_US.utf8\n[INFO]:-Greenplum segment prefix   = gpseg\n[INFO]:-Master Database            = mydw\n[INFO]:-Master connections         = 500\n[INFO]:-Master buffers             = 256MB\n[INFO]:-Segment connections        = 1500\n[INFO]:-Segment buffers            = 256MB\n[INFO]:-Checkpoint segments        = 256\n[INFO]:-Encoding                   = UTF-8\n[INFO]:-Postgres param file        = Off\n[INFO]:-Initdb to be used          = /usr/local/greenplum-db/./bin/initdb\n[INFO]:-GP_LIBRARY_PATH is         = /usr/local/greenplum-db/./lib\n[INFO]:-HEAP_CHECKSUM is           = on\n[INFO]:-HBA_HOSTNAMES is           = 0\n[INFO]:-Ulimit check               = Passed\n[INFO]:-Array host connect type    = Single hostname per node\n[INFO]:-Master IP address [1]      = x.x.x.x\n[INFO]:-Standby Master             = Not Configured\n[INFO]:-Number of primary segments = 4\n[INFO]:-Total Database segments    = 12\n[INFO]:-Trusted shell              = ssh\n[INFO]:-Number segment hosts       = 3\n[INFO]:-Mirror port base           = 50000\n[INFO]:-Number of mirror segments  = 4\n[INFO]:-Mirroring config           = ON\n[INFO]:-Mirroring type             = Group\n[INFO]:----------------------------------------\n[INFO]:-Greenplum Primary Segment Configuration\n[INFO]:----------------------------------------\n[INFO]:-greenplum-001.test.com        /greenplum/primary/gpseg0       40000   2       0\n[INFO]:-greenplum-001.test.com        /greenplum/primary/gpseg1       40001   3       1\n[INFO]:-greenplum-001.test.com        /greenplum/primary/gpseg2       40002   4       2\n[INFO]:-greenplum-001.test.com        /greenplum/primary/gpseg3       40003   5       3\n[INFO]:-greenplum-002.test.com        /greenplum/primary/gpseg4       40000   6       4\n[INFO]:-greenplum-002.test.com        /greenplum/primary/gpseg5       40001   7       5\n[INFO]:-greenplum-002.test.com        /greenplum/primary/gpseg6       40002   8       6\n[INFO]:-greenplum-002.test.com        /greenplum/primary/gpseg7       40003   9       7\n[INFO]:-greenplum-003.test.com        /greenplum/primary/gpseg8       40000   10      8\n[INFO]:-greenplum-003.test.com        /greenplum/primary/gpseg9       40001   11      9\n[INFO]:-greenplum-003.test.com        /greenplum/primary/gpseg10      40002   12      10\n[INFO]:-greenplum-003.test.com        /greenplum/primary/gpseg11      40003   13      11\n[INFO]:---------------------------------------\n[INFO]:-Greenplum Mirror Segment Configuration\n[INFO]:---------------------------------------\n[INFO]:-greenplum-002.test.com        /greenplum/mirror/gpseg0        50000   14      0\n[INFO]:-greenplum-002.test.com        /greenplum/mirror/gpseg1        50001   15      1\n[INFO]:-greenplum-002.test.com        /greenplum/mirror/gpseg2        50002   16      2\n[INFO]:-greenplum-002.test.com        /greenplum/mirror/gpseg3        50003   17      3\n[INFO]:-greenplum-003.test.com        /greenplum/mirror/gpseg4        50000   18      4\n[INFO]:-greenplum-003.test.com        /greenplum/mirror/gpseg5        50001   19      5\n[INFO]:-greenplum-003.test.com        /greenplum/mirror/gpseg6        50002   20      6\n[INFO]:-greenplum-003.test.com        /greenplum/mirror/gpseg7        50003   21      7\n[INFO]:-greenplum-001.test.com        /greenplum/mirror/gpseg8        50000   22      8\n[INFO]:-greenplum-001.test.com        /greenplum/mirror/gpseg9        50001   23      9\n[INFO]:-greenplum-001.test.com        /greenplum/mirror/gpseg10       50002   24      10\n[INFO]:-greenplum-001.test.com        /greenplum/mirror/gpseg11       50003   25      11\n\nContinue with Greenplum creation Yy|Nn (default=N):\n>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br")])]),e("p",[s._v("看一下配置，没有错误，输入Y，回车。等待初始化完成即可。")]),s._v(" "),e("p",[s._v("运行"),e("code",[s._v("gpstate")]),s._v("命令查看一下集群状态：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[INFO]:-Greenplum instance status summary\n[INFO]:-----------------------------------------------------\n[INFO]:-   Master instance                                           = Active\n[INFO]:-   Master standby                                            = No master standby configured\n[INFO]:-   Total segment instance count from metadata                = 24\n[INFO]:-----------------------------------------------------\n[INFO]:-   Primary Segment Status\n[INFO]:-----------------------------------------------------\n[INFO]:-   Total primary segments                                    = 12\n[INFO]:-   Total primary segment valid (at master)                   = 12\n[INFO]:-   Total primary segment failures (at master)                = 0\n[INFO]:-   Total number of postmaster.pid files missing              = 0\n[INFO]:-   Total number of postmaster.pid files found                = 12\n[INFO]:-   Total number of postmaster.pid PIDs missing               = 0\n[INFO]:-   Total number of postmaster.pid PIDs found                 = 12\n[INFO]:-   Total number of /tmp lock files missing                   = 0\n[INFO]:-   Total number of /tmp lock files found                     = 12\n[INFO]:-   Total number postmaster processes missing                 = 0\n[INFO]:-   Total number postmaster processes found                   = 12\n[INFO]:-----------------------------------------------------\n[INFO]:-   Mirror Segment Status\n[INFO]:-----------------------------------------------------\n[INFO]:-   Total mirror segments                                     = 12\n[INFO]:-   Total mirror segment valid (at master)                    = 12\n[INFO]:-   Total mirror segment failures (at master)                 = 0\n[INFO]:-   Total number of postmaster.pid files missing              = 0\n[INFO]:-   Total number of postmaster.pid files found                = 12\n[INFO]:-   Total number of postmaster.pid PIDs missing               = 0\n[INFO]:-   Total number of postmaster.pid PIDs found                 = 12\n[INFO]:-   Total number of /tmp lock files missing                   = 0\n[INFO]:-   Total number of /tmp lock files found                     = 12\n[INFO]:-   Total number postmaster processes missing                 = 0\n[INFO]:-   Total number postmaster processes found                   = 12\n[INFO]:-   Total number mirror segments acting as primary segments   = 0\n[INFO]:-   Total number mirror segments acting as mirror segments    = 12\n[INFO]:-----------------------------------------------------\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br")])]),e("p",[s._v("psql登录查看版本信息：")]),s._v(" "),e("blockquote",[e("p",[s._v("psql -p 1921 -dpostgres")]),s._v(" "),e("p",[s._v("postgres=# select version();")])]),s._v(" "),e("p",[s._v("PostgreSQL 9.4.24 (Greenplum Database 6.0.0 build commit:a2ff2fc318c327d702e66ab58ae4aff34c42296c) on x86_64-unknown-linux-gnu, compiled by gcc (GCC) 6.4.0, 64-bit compiled on Aug 28 2019 21:29:36\n(1 row)")]),s._v(" "),e("h2",{attrs:{id:"数据库参数调整"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#数据库参数调整"}},[s._v("#")]),s._v(" 数据库参数调整")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("gpconfig -c log_statement -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"all"')]),s._v("\ngpconfig -c optimizer -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"off"')]),s._v("\ngpconfig -c gp_vmem_protect_limit -v "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\ngpconfig -c statement_mem -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"256MB"')]),s._v("\ngpconfig -c max_statement_mem -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4000MB"')]),s._v("\ngpconfig -c gp_max_plan_size -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200MB"')]),s._v("\ngpconfig -c max_fsm_pages -v "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000")]),s._v("\ngpconfig -c TimeZone -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PRC'")]),s._v("\ngpconfig -c track_counts             -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\ngpconfig -c track_activities             -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\ngpconfig -c vacuum_cost_delay          -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10ms"')]),s._v("\ngpconfig -c vacuum_cost_limit          -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10000"')]),s._v("\ngpconfig -c maintenance_work_mem       -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4GB"')]),s._v("\ngpconfig -c log_rotation_age           -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3d"')]),s._v("\ngpconfig -c log_rotation_size          -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1GB"')]),s._v("\ngpconfig -c log_truncate_on_rotation   -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\ngpconfig -c log_checkpoints            -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\ngpconfig -c log_min_duration_statement -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"600s"')]),s._v("\ngpconfig -c log_lock_waits             -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on"')]),s._v("\ngpconfig -c gp_segment_connect_timeout             -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"30min"')]),s._v("\ngpconfig -c synchronous_commit -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"off"')]),s._v("\ngpconfig -c autovacuum_multixact_freeze_max_age -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1600000000"')]),s._v("\ngpconfig -c vacuum_multixact_freeze_table_age -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1500000000"')]),s._v("\ngpconfig -c vacuum_freeze_table_age -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1500000000"')]),s._v("\ngpconfig -c gp_default_storage_options -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendonly=false,blocksize=32768,compresstype=quicklz,checksum=true,orientation=column"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[s._v("执行gpstop -u，使得参数更改生效。")]),s._v(" "),e("h2",{attrs:{id:"账号配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#账号配置"}},[s._v("#")]),s._v(" 账号配置")]),s._v(" "),e("p",[e("strong",[s._v("新建用户gpmon")])]),s._v(" "),e("blockquote",[e("p",[s._v("create user gpmon PASSWORD 'xxx123' CONNECTION LIMIT 3 NOCREATEROLE;")])]),s._v(" "),e("p",[s._v("编辑/greenplum/master/gpseg-1/pg_hba.conf，根据需要增加内容，如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("local all all trust\n# all user need password\nhost   all  all  0.0.0.0/0   password\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("执行"),e("code",[s._v("pg_ctl reload -D /greenplum/master/gpseg-1")]),s._v(" ，以上配置才生效。")]),s._v(" "),e("p",[e("strong",[s._v("授权：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" xx "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" xxs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v(" xx "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" xxs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"master节点高可用配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master节点高可用配置"}},[s._v("#")]),s._v(" Master节点高可用配置")]),s._v(" "),e("p",[s._v("master节点的高可用是通过增加standby节点实现的，添加方法有两种：")]),s._v(" "),e("ul",[e("li",[s._v("gpinitsystem时增加"),e("code",[s._v("-s standby_hostname")])]),s._v(" "),e("li",[s._v("gpinitstandby -s standby_hostname")])]),s._v(" "),e("p",[e("code",[s._v("gpstate -f")]),s._v(" 检查状态")]),s._v(" "),e("p",[e("code",[s._v("gpactivatestandby")]),s._v(" 激活standby")]),s._v(" "),e("h2",{attrs:{id:"配置gphdfs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置gphdfs"}},[s._v("#")]),s._v(" 配置gphdfs")]),s._v(" "),e("p",[s._v("由于6.0版本开始，gphdfs协议已经取消了，取代的是pxf，这里简单介绍一下gphdfs的配置方法，仅适用于6.0之前的版本。")]),s._v(" "),e("h3",{attrs:{id:"安装hadoop-client"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装hadoop-client"}},[s._v("#")]),s._v(" 安装hadoop client")]),s._v(" "),e("p",[s._v("在所有节点上安装与你的hadoop集群一致的hadoop client，这里我把client放到/usr/local/hadoop-3.1.0目录。")]),s._v(" "),e("p",[s._v("修改greenplum_path.sh，增加hadoop路径配置。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/usr/local/greenplum-db/greenplum_path.sh\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HADOOP_HOME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/hadoop-3.1.0\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HADOOP_HOME")]),s._v("/bin:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HADOOP_HOME")]),s._v("/sbin:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MASTER_DATA_DIRECTORY")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/greenplum/master/gpseg-1\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PGPORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1921")]),s._v("\nEOF\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"配置gphdfs-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置gphdfs-2"}},[s._v("#")]),s._v(" 配置gphdfs")]),s._v(" "),e("p",[e("strong",[s._v("6版本之后已经被pxf取代")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("gpconfig -c gp_hadoop_home -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"'/usr/local/hadoop-3.1.0'\"")]),s._v("\ngpconfig -c gp_hadoop_target_version -v "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"'hadoop'\"")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("code",[s._v("gpstop -u")]),s._v(" 使配置生效。")]),s._v(" "),e("h3",{attrs:{id:"数据加载测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#数据加载测试"}},[s._v("#")]),s._v(" 数据加载测试")]),s._v(" "),e("p",[e("strong",[s._v("新建外部表")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" EXTERNAL "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" test_gphdfs "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    a "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    b "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" LOCATION "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gphdfs://xx.xx.xx.xx:9820/2018/2018-10-19/part-*'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FORMAT "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" E"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v(" E"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("escape")]),s._v(" E"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\\\'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nENCODING "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UTF8'")]),s._v("\nLOG "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ERRORS")]),s._v(" SEGMENT REJECT "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PERCENT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("strong",[s._v("加载外部表数")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" gphdfs "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" a"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" test_gphdfs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"pxf"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pxf"}},[s._v("#")]),s._v(" PXF")]),s._v(" "),e("p",[s._v("The Greenplum Platform Extension Framework (PXF) provides parallel, high throughput data access and federated queries across heterogeneous data sources via built-in connectors that map a Greenplum Database external table definition to an external data source. PXF has its roots in the Apache HAWQ project.")]),s._v(" "),e("ul",[e("li",[s._v("(可选) yum install krb5-libs krb5-workstation")]),s._v(" "),e("li",[s._v("(可选) copy /etc/krb5.conf 到所有segment节点的/etc目录下")]),s._v(" "),e("li",[s._v("(可选) 生成访问k8s的用户及key文件，默认放到是"),e("code",[s._v("$PXF_CONF/keytabs/pxf.service.keytab")])]),s._v(" "),e("li",[e("code",[s._v('sed -i \'s/connectionTimeout="20000"/connectionTimeout="86400000"/g\' /usr/local/greenplum-db/pxf/pxf-service/conf/server.xml')])]),s._v(" "),e("li",[s._v("export PXF_CONF=/usr/local/greenplum-db/greenplum-pxf")]),s._v(" "),e("li",[s._v("pxf cluster init")]),s._v(" "),e("li",[s._v("mkdir -p /usr/local/greenplum-db/greenplum-pxf/servers/hdp3，也可以使用默认的default目录。")]),s._v(" "),e("li",[s._v("copy hadoop集群的"),e("code",[s._v("hdfs-site.xml")]),s._v(","),e("code",[s._v("core-site.xml")]),s._v(","),e("code",[s._v("mapred-site.xml")]),s._v(","),e("code",[s._v("yarn-site.xml")]),s._v("文件到"),e("code",[s._v("hdp3")]),s._v("目录下。")]),s._v(" "),e("li",[s._v("copy pxf-site.xml 文件到"),e("code",[s._v("hdp3")]),s._v("目录下（基于kerberos的hadoop集群需要）。")]),s._v(" "),e("li",[s._v("删除pxf-site.xml里面的"),e("code",[s._v("pxf.service.user.name")]),s._v("配置项目。")]),s._v(" "),e("li",[s._v("修改conf目录下的pxf-env.sh的PXF_USER_IMPERSONATION=false。")]),s._v(" "),e("li",[s._v("pxf cluster sync")]),s._v(" "),e("li",[s._v("pxf cluster start")]),s._v(" "),e("li",[s._v("测试")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" EXTENSION pxf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" EXTERNAL "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" EXTERNAL "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" test "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    offsetid "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    tdid "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    monthid "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("integer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    app_install "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" LOCATION "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pxf://data/pxf_examples/part-00000?PROFILE=hdfs:text&SERVER=hdp3'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" FORMAT "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(" E"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v(" E"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("escape")]),s._v(" E"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\\\'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nENCODING "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UTF8'")]),s._v("\nSEGMENT REJECT "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PERCENT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[e("p",[s._v("select count(*) from test;")]),s._v(" "),e("blockquote",[e("p",[s._v("注意：不支持开启了Erasure Coding Policies的目录及文件的读取。")])])])]),s._v(" "),e("h2",{attrs:{id:"gpcopy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gpcopy"}},[s._v("#")]),s._v(" gpcopy")]),s._v(" "),e("h2",{attrs:{id:"故障恢复"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#故障恢复"}},[s._v("#")]),s._v(" 故障恢复")]),s._v(" "),e("p",[s._v("正常情况下执行"),e("code",[s._v("gpstate -e")]),s._v("，输出是这样的。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[INFO]:-----------------------------------------------------\n[INFO]:-Segment Mirroring Status Report\n[INFO]:-----------------------------------------------------\n[INFO]:-All segments are running normally\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"primary节点故障"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#primary节点故障"}},[s._v("#")]),s._v(" primary节点故障")]),s._v(" "),e("p",[s._v("primary节点故障后，原来的mirror会提升为primary。执行"),e("code",[s._v("gpstate -e")]),s._v("查看。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[INFO]:-Downed Segments (may include segments where status could not be retrieved)\n[INFO]:-   Segment                  Port    Config status   Status\n[INFO]:-   greenplum-002.test.com   40002   Up              Process error -- database process may be down\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("strong",[s._v("恢复：")])]),s._v(" "),e("p",[e("code",[s._v("gprecoverseg -a")])]),s._v(" "),e("p",[s._v("再次执行"),e("code",[s._v("gpstate -e")]),s._v("查看，角色发生了变化。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[INFO]:-Segments with Primary and Mirror Roles Switched\n[INFO]:-   Current Primary          Port    Mirror                   Port\n[INFO]:-   greenplum-003.test.com   50002   greenplum-002.test.com   40002\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("strong",[s._v("角色切换")])]),s._v(" "),e("p",[s._v("执行"),e("code",[s._v("gprecoverseg -r")]),s._v("，恢复角色，这个操作会阻塞其他操作，需要在业务低峰时间执行。")]),s._v(" "),e("h3",{attrs:{id:"mirror节点故障"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mirror节点故障"}},[s._v("#")]),s._v(" mirror节点故障")]),s._v(" "),e("p",[s._v("同"),e("strong",[s._v("rimary节点故障")]),s._v("恢复步骤，唯一不同是最后一步不需要执行，因为没有发生角色切换。")]),s._v(" "),e("h2",{attrs:{id:"tpch测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tpch测试"}},[s._v("#")]),s._v(" TPCH测试")]),s._v(" "),e("ol",[e("li",[s._v("下载pg_tpch - "),e("code",[s._v("wget https://github.com/tvondra/pg_tpch/archive/master.zip")])]),s._v(" "),e("li",[s._v("下载tpch-dbgen - "),e("code",[s._v("git clone https://github.com/electrum/tpch-dbgen.git")])]),s._v(" "),e("li",[s._v("修改makefile中的几个参数：")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## CHANGE NAME OF ANSI COMPILER HERE")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################")]),s._v("\nCC      "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" gcc\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Current values for DATABASE are: INFORMIX, DB2, TDAT (Teradata)")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                                  SQLSERVER, SYBASE, ORACLE, VECTORWISE")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Current values for MACHINE are:  ATT, DOS, HP, IBM, ICL, MVS,")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                                  SGI, SUN, U2200, VMS, LINUX, WIN32")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Current values for WORKLOAD are:  TPCH")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATABASE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ORACLE\nMACHINE "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LINUX\nWORKLOAD "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TPCH\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("安装 - "),e("code",[s._v("make")])]),s._v(" "),e("li",[s._v("使用dbgen产生测试数据, -s表示scale（单位为GB) - "),e("code",[s._v("./dbgen -s 100 f")])]),s._v(" "),e("li",[s._v("将数据转换为postgresql识别的格式，删除末尾的分隔符| - "),e("code",[s._v("for i in")]),s._v("ls *.tbl"),e("code",[s._v("; do sed 's/|$//' $i > ${i/tbl/csv}; done")])]),s._v(" "),e("li",[s._v("将pg_tpch的文件逗拷贝到dbgen下面 - "),e("code",[s._v("cp -r * ../tpch-dbgen")])]),s._v(" "),e("li",[s._v("生成测试SQL , SF=dbgen指定的scale值")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("SF=100\nmkdir dss/queries\nfor q in `seq 1 22`\ndo\n    DSS_QUERY=dss/templates ./qgen -s $SF $q > dss/queries/$q.sql\n    sed 's/^select/explain select/' dss/queries/$q.sql > dss/queries/$q.explain.sql\ndone\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ol",{attrs:{start:"9"}},[e("li",[s._v("在greenplum数据库中创建数据库和用户")]),s._v(" "),e("li",[s._v("加载测试数据 - "),e("code",[s._v("./tpch.sh ./results localhost 5432 tpch gpadmin password {row|column}")])]),s._v(" "),e("li",[s._v("生成报告 - "),e("code",[s._v("php process.php ./results output.csv")])]),s._v(" "),e("li",[s._v("测试结果")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("2019-12-04 10:40:36 [1575427236] : preparing TPC-H database\n2019-12-04 10:40:36 [1575427236] :   loading data\n2019-12-04 10:40:37 [1575427237] :   creating primary keys\n2019-12-04 10:40:37 [1575427237] :   creating foreign keys\n2019-12-04 10:40:37 [1575427237] :   creating indexes\n2019-12-04 10:40:37 [1575427237] :   analyzing\n2019-12-04 10:40:38 [1575427238] : running TPC-H benchmark\n2019-12-04 10:40:38 [1575427238] : running queries defined in TPC-H benchmark\n2019-12-04 10:40:38 [1575427238] : finished TPC-H benchmark\n2019-12-04 12:06:01 [1575432361] : preparing TPC-H database\n2019-12-04 12:06:01 [1575432361] :   loading data\n2019-12-04 12:07:20 [1575432440] : preparing TPC-H database\n2019-12-04 12:07:20 [1575432440] :   loading data\n2019-12-04 12:44:26 [1575434666] :   creating primary keys\n2019-12-04 12:44:26 [1575434666] :   creating foreign keys\n2019-12-04 12:44:26 [1575434666] :   creating indexes\n2019-12-04 12:47:00 [1575434820] :   analyzing\n2019-12-04 12:47:14 [1575434834] : running TPC-H benchmark\n2019-12-04 12:47:14 [1575434834] : running queries defined in TPC-H benchmark\n2019-12-04 12:47:14 [1575434834] :   running query 1\n2019-12-04 12:47:49 [1575434869] :     query 1 finished OK (34 seconds)\n2019-12-04 12:47:49 [1575434869] :   running query 2\n2019-12-04 12:47:56 [1575434876] :     query 2 finished OK (5 seconds)\n2019-12-04 12:47:56 [1575434876] :   running query 3\n2019-12-04 12:48:07 [1575434887] :     query 3 finished OK (10 seconds)\n2019-12-04 12:48:07 [1575434887] :   running query 4\n2019-12-04 12:48:17 [1575434897] :     query 4 finished OK (9 seconds)\n2019-12-04 12:48:17 [1575434897] :   running query 5\n2019-12-04 12:48:33 [1575434913] :     query 5 finished OK (15 seconds)\n2019-12-04 12:48:33 [1575434913] :   running query 6\n2019-12-04 12:48:38 [1575434918] :     query 6 finished OK (4 seconds)\n2019-12-04 12:48:38 [1575434918] :   running query 7\n2019-12-04 12:48:48 [1575434928] :     query 7 finished OK (9 seconds)\n2019-12-04 12:48:48 [1575434928] :   running query 8\n2019-12-04 12:48:58 [1575434938] :     query 8 finished OK (9 seconds)\n2019-12-04 12:48:58 [1575434938] :   running query 9\n2019-12-04 12:49:27 [1575434967] :     query 9 finished OK (27 seconds)\n2019-12-04 12:49:27 [1575434967] :   running query 10\n2019-12-04 12:49:36 [1575434976] :     query 10 finished OK (8 seconds)\n2019-12-04 12:49:36 [1575434976] :   running query 11\n2019-12-04 12:49:40 [1575434980] :     query 11 finished OK (3 seconds)\n2019-12-04 12:49:40 [1575434980] :   running query 12\n2019-12-04 12:49:48 [1575434988] :     query 12 finished OK (7 seconds)\n2019-12-04 12:49:48 [1575434988] :   running query 13\n2019-12-04 12:49:56 [1575434996] :     query 13 finished OK (8 seconds)\n2019-12-04 12:49:56 [1575434996] :   running query 14\n2019-12-04 12:50:02 [1575435002] :     query 14 finished OK (5 seconds)\n2019-12-04 12:50:02 [1575435002] :   running query 15\n2019-12-04 12:50:12 [1575435012] :     query 15 finished OK (9 seconds)\n2019-12-04 12:50:12 [1575435012] :   running query 16\n2019-12-04 12:50:16 [1575435016] :     query 16 finished OK (3 seconds)\n2019-12-04 12:50:16 [1575435016] :   running query 17\n2019-12-04 12:51:24 [1575435084] :     query 17 finished OK (67 seconds)\n2019-12-04 12:51:24 [1575435084] :   running query 18\n2019-12-04 12:52:07 [1575435127] :     query 18 finished OK (42 seconds)\n2019-12-04 12:52:07 [1575435127] :   running query 19\n2019-12-04 12:52:13 [1575435133] :     query 19 finished OK (5 seconds)\n2019-12-04 12:52:13 [1575435133] :   running query 20\n2019-12-04 12:52:27 [1575435147] :     query 20 finished OK (12 seconds)\n2019-12-04 12:52:27 [1575435147] :   running query 21\n2019-12-04 12:52:54 [1575435174] :     query 21 finished OK (25 seconds)\n2019-12-04 12:52:54 [1575435174] :   running query 22\n2019-12-04 12:53:01 [1575435181] :     query 22 finished OK (6 seconds)\n2019-12-04 12:53:01 [1575435181] : finished TPC-H benchmark\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);
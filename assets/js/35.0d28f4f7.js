(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{442:function(s,a,n){"use strict";n.r(a);var t=n(51),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"使用pg-rman对postgresql进行全量备份"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用pg-rman对postgresql进行全量备份"}},[s._v("#")]),s._v(" 使用PG_RMAN对PostgreSQL进行全量备份")]),s._v(" "),n("h2",{attrs:{id:"pg-rman特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pg-rman特点"}},[s._v("#")]),s._v(" pg_rman特点")]),s._v(" "),n("ul",[n("li",[s._v("使用简单，一个命令即可完成备份和恢复。")]),s._v(" "),n("li",[s._v("支持在线全备，增量备份，归档备份。")]),s._v(" "),n("li",[s._v("支持备份压缩，通过gzip工具实现页内压缩。")]),s._v(" "),n("li",[s._v("自动备份维护，自动删除过期的WAL备份文件。")]),s._v(" "),n("li",[s._v("支持备份验证。")]),s._v(" "),n("li",[s._v("恢复期间无事务丢失，支持基于PITR的配置文件生成器。")]),s._v(" "),n("li",[s._v("需要挂载备份介质到本机")])]),s._v(" "),n("h2",{attrs:{id:"初始化备份目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初始化备份目录"}},[s._v("#")]),s._v(" 初始化备份目录")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /backup/pgsql5432 \n/usr/pgsql-9.5/bin/pg_rman init -D /pgsql/pgsql5432 -B /backup/pgsql5432\n\nINFO: ARCLOG_PATH is "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/pgsql/pgsql5432/archlog'")]),s._v("\nINFO: SRVLOG_PATH is "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/pgsql/pgsql5432/pg_log'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"全备实例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全备实例"}},[s._v("#")]),s._v(" 全备实例")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("export PGPASSWORD=postgres         # 超级用户密码  \n\npg_rman backup \\    \n-b full \\                          # 全量备份   \n-B /backup/pgsql5432 \\       # 备份目录  \n-D /pgsql/pgsql5432 \\   # 备库的$PGDATA  \n-s \\                               # 备份pg_log  \n-Z \\                               # 压缩  \n--keep-data-generations=3 \\        # 保留3个全量备份，删除不需要的全量备份  \n--keep-data-days=10 \\              # 保证能恢复到10天内的任意时间点，删除不需要的  \n--keep-arclog-files=30 \\           # 保留最近30个归档文件  \n--keep-arclog-days=20 \\            # 保留20天内的归档文件  \n--keep-srvlog-files=10 \\           # 保留最近10个日志文件(pg_log)  \n--keep-srvlog-days=20 \\            # 保留20天内的日志文件(pg_log)  \n--standby-host=127.0.0.1 \\         # 如何连接standby  \n--standby-port=5432 \\              # 如何连接standby  \n-h 127.0.0.1 \\                     # 如何连接primary  \n-p 1921 \\                          # 如何连接primary  \n-U postgres \\                      # 如何连接primary, standby(超级用户)  \n-d postgres                        # 如何连接primary, standby(database name)  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"备份集校验"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#备份集校验"}},[s._v("#")]),s._v(" 备份集校验")]),s._v(" "),n("p",[s._v("每次备份完，必须要做一次校验，否则备份集不可用用来恢复，增量备份时也不会用它来做增量比较。")]),s._v(" "),n("blockquote",[n("p",[s._v("pg_rman validate")])]),s._v(" "),n("h2",{attrs:{id:"删除备份集"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除备份集"}},[s._v("#")]),s._v(" 删除备份集")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("按指定时间从catalog删除备份集")]),s._v(" "),n("blockquote",[n("p",[s._v('pg_rman delete "2017-08-30 17:27:49"')])])]),s._v(" "),n("li",[n("p",[s._v("根据备份策略来删除备份集")]),s._v(" "),n("blockquote",[n("p",[s._v("KEEP_DATA_GENERATIONS = 3   -- 备份集冗余度是3")])]),s._v(" "),n("blockquote",[n("p",[s._v("KEEP_DATA_DAYS = 10         -- 备份集保留日期是10d")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);
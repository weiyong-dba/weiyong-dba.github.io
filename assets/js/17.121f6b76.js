(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{463:function(s,t,n){"use strict";n.r(t);var a=n(51),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"安装工具包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装工具包"}},[s._v("#")]),s._v(" 安装工具包")]),s._v(" "),n("blockquote",[n("p",[s._v("yum install rpmbuild rpmdevtools -y")])]),s._v(" "),n("h3",{attrs:{id:"初始化目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初始化目录"}},[s._v("#")]),s._v(" 初始化目录")]),s._v(" "),n("blockquote",[n("p",[s._v("rpmdev-setuptree rpmbuild")])]),s._v(" "),n("h3",{attrs:{id:"准备源码包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备源码包"}},[s._v("#")]),s._v(" 准备源码包")]),s._v(" "),n("p",[s._v("把原码包mysql-5.7.27.tar.gz上传到SOURCES目录下，其他需要用到的包也放在这个目录下。")]),s._v(" "),n("h3",{attrs:{id:"编写spec文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编写spec文件"}},[s._v("#")]),s._v(" 编写spec文件")]),s._v(" "),n("p",[s._v("在SPECS目录下添加mysql.spec文件，文件内容如下，可以根据需要修改。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("Name:       mysql\nVersion:    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v(".27\nRelease:    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0\nLicense:    GPL\nURL:        http://www.mysql.com\nGroup:      applications/database\nSource0:     mysql-%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".tar.gz\nSource1:     common_schema.sql\nBuildRoot:  %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mktemp -ud %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_tmppath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("release"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".el7.centos-XXXXXX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nBuildRequires:  cmake\nRequires: libaio\nPackager:   dba\nAutoreq:    no\nSummary: MySQL-%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" RPM\n\n%description\nMySQL %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" Server.\n\n%define MYSQL_PORT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n%define DATA_DIR /mysql/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n%define BASE_DIR /usr/local/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n%define MYSQL_USER mysql\n%define MYSQL_GROUP mysql\n\n%prep\n%setup -q mysql-%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%build\n\ncmake -DCMAKE_INSTALL_PREFIX"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DWITH_BOOST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("boost/boost_1_59_0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DMYSQL_DATADIR"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DSYSCONFDIR"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/etc/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DWITH_INNOBASE_STORAGE_ENGINE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DWITH_ARCHIVE_STORAGE_ENGINE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DWITH_FEDERATED_STORAGE_ENGINE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DWITH_PARTITION_STORAGE_ENGINE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DWITH_BLACKHOLE_STORAGE_ENGINE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DWITH_MYISAM_STORAGE_ENGINE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DMYSQL_UNIX_ADDR"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/mysqld.sock "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DMYSQL_TCP_PORT"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DENABLED_LOCAL_INFILE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DEXTRA_CHARSETS"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("all "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DDEFAULT_CHARSET"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DDEFAULT_COLLATION"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4_general_ci "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DWITH_EMBEDDED_SERVER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-DCPACK_MONOLITHIC_INSTALL"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("?_smp_mflags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -j "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/cpuinfo "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" processor"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n%install\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("buildroot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DESTDIR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("buildroot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("__install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -p -D %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("SOURCE1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("buildroot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/etc/common_schema-2.2-TD.sql\n\n%pre\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("check_port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -nltup "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v("/dev/null\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -d %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error: The data directory %{DATA_DIR} already exists, Aborting."')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -d %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error: The base directory %{BASE_DIR} already exists, Aborting."')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" check_port %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error: The port %{MYSQL_PORT} already in used, Aborting."')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -e /etc/init.d/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error: The file /etc/init.d/mysql%{MYSQL_PORT} already exists, Aborting."')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -e /lib/systemd/system/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error: The file /lib/systemd/system/mysql%{MYSQL_PORT}.service already exists, Aborting."')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -e /etc/my.cnf "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error: The file /etc/my.cnf already exists, Aborting."')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOTAL_SIZE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" -g "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Mem "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALLOC_SIZE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$((")]),s._v(" $TOTAL_SIZE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("))")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BUFFER_SIZE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" $ALLOC_SIZE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F. "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"G"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_ID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" inet "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scope global"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secondary"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%{MYSQL_PORT}"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/etc\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/etc/my.cnf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[client]\nport = %{MYSQL_PORT}\nsocket = %{DATA_DIR}/mysqld.sock\ndefault-character-set=utf8mb4\n\n[mysqld]\ncharacter-set-server=utf8mb4\nport = %{MYSQL_PORT}\nsocket = %{DATA_DIR}/mysqld.sock\nbasedir = %{BASE_DIR}\ndatadir = %{DATA_DIR}\nback_log = 500\nskip-name-resolve\nskip-external-locking\nconcurrent_insert = 2\ndelay-key-write = ALL\nkey_buffer_size = 256M\nmax_allowed_packet = 1024M\ntable_open_cache = 4096\nsort_buffer_size = 2M\nnet_buffer_length = 8K\nread_buffer_size = 2M\nread_rnd_buffer_size = 512K\nmyisam_sort_buffer_size = 64M\nthread_stack = 512K\nlog-bin = mysql-bin\nlog_bin_trust_function_creators = on\nbinlog_format = mixed\nbinlog_row_image=minimal\ntransaction-isolation = REPEATABLE-READ\nsync_binlog=0\nrelay_log = relay-bin\nserver-id = "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SERVER_ID")]),s._v("\nbinlog_cache_size = 8M\nmax_binlog_size = 1024M\nmax_relay_log_size = 1024M\nexpire_logs_days = 15\nthread_cache_size = 48\nquery_cache_type = on\nquery_cache_size = 0\nquery_cache_limit = 8M\nmax_connections = 4000\nmax_connect_errors = 2000\ntmp_table_size = 256M\nlong_query_time = 3\nslow_query_log=off\ninnodb_page_size = 16384\ninnodb_file_per_table\ninnodb_buffer_pool_size = "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BUFFER_SIZE")]),s._v("\ninnodb_flush_log_at_trx_commit = 2\ninnodb_flush_method = O_DIRECT\ninnodb_log_file_size = 1G\ninnodb_log_files_in_group = 3\ninnodb_fast_shutdown = 1\ninnodb_lock_wait_timeout=86400\nsql_mode = NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\ninnodb_io_capacity = 2000\ninnodb_io_capacity_max = 10000\ninnodb_open_files = 1000\nfederated\nevent_scheduler=1\nsecure-file-priv = \"\"\nslave-parallel-type=LOGICAL_CLOCK\nslave-parallel-workers=8\nmaster_info_repository=TABLE\nrelay_log_info_repository=TABLE\nrelay_log_recovery=ON\nexplicit_defaults_for_timestamp=OFF\ngtid-mode=ON\nenforce-gtid-consistency=ON\nslave_pending_jobs_size_max=512M\nlog_timestamps=SYSTEM\ndefault-time-zone='+8:00'\nlog_slave_updates=0\nopen_files_limit=655350\nshow_compatibility_56=on\ngroup_concat_max_len=10240000\noptimizer_switch='mrr=on,mrr_cost_based=off'\ninnodb_undo_log_truncate=on\ninnodb_undo_tablespaces=3\ninnodb_max_undo_log_size=10737418240\n[mysqldump]\nquick\nmax_allowed_packet = 16M\n\n[mysql]\nno-auto-rehash\n\n[myisamchk]\nkey_buffer_size = 20M\nsort_buffer_size = 20M\nread_buffer = 2M\nwrite_buffer = 2M\n\n[mysqlhotcopy]\ninteractive-timeout\nEOF")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -s /bin/nologin -M %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_USER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_USER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_GROUP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%post\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sf %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/support-files/mysql.server /etc/init.d/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sf %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/bin/mysql /usr/bin/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/bin/mysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/etc/my.cnf --initialize-insecure --user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql --basedir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" --datadir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[Unit]'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("Description=mysql%{MYSQL_PORT}"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("[Service]"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("Type=forking"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("User=mysql"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("Group=mysql"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("ExecStart=/etc/init.d/mysql%{MYSQL_PORT} start"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("ExecReload=/etc/init.d/mysql%{MYSQL_PORT} restart"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("ExecStop=/etc/init.d/mysql%{MYSQL_PORT} stop"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("PrivateTmp=true"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("TimeoutSec=0"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("LimitNOFILE=infinity"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("LimitMEMLOCK=infinity"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("[Install]"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("WantedBy=multi-user.target"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/lib/systemd/system/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service\n\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n\nsystemctl daemon-reload\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_USER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_GROUP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R og-rw %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -e /etc/my.cnf "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/my.cnf /etc/my.cnf_bak_"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y%m%d%H%M%S"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\nsystemctl start mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#if [ -x /usr/bin/openssl ] ; then")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        passwd=`/usr/bin/openssl rand -base64 8 | cut -c 1-8`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#else")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        passwd=`/usr/bin/cat /dev/urandom | head -n 8 | md5sum | head -c 8`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sql")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/usr/bin/echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"\ndrop database if exists test;\nDELETE FROM mysql.user where user='';\nDELETE FROM mysql.user where user='root' and host<>'localhost';\nGRANT ALL PRIVILEGES ON *.* TO root@localhost identified by PASSWORD '*EEEDEED0EEE5735BC3FC11AADF97B497233B6FEE' WITH GRANT OPTION;\nflush privileges;\nreset master;\"")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("common_schema_sql")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/usr/bin/echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source %{BASE_DIR}/etc/common_schema.sql;"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n/usr/local/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/bin/mysql -uroot -q -s -S %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/mysqld.sock -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${common_schema_sql}")]),s._v('"')]),s._v("\n\n/usr/local/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/bin/mysql -uroot -q -s -S %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DATA_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/mysqld.sock -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${sql}")]),s._v('"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Info: MySQL %{version} install successed, run 'mysql3306 -uroot -p****** -P%{MYSQL_PORT} -hlocalhost' to connect!\"")]),s._v("\n\n%preun\nsystemctl stop mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service\nsystemctl disable mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" 10s\n\n%postun\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f /lib/systemd/system/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".service\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /usr/local/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /mysql/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f /etc/init.d/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f /usr/bin/mysql%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%clean\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("buildroot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%files\n%defattr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-, %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_USER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_GROUP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n%attr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(", %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_USER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_GROUP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/*\n\n%changelog\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br"),n("span",{staticClass:"line-number"},[s._v("188")]),n("br"),n("span",{staticClass:"line-number"},[s._v("189")]),n("br"),n("span",{staticClass:"line-number"},[s._v("190")]),n("br"),n("span",{staticClass:"line-number"},[s._v("191")]),n("br"),n("span",{staticClass:"line-number"},[s._v("192")]),n("br"),n("span",{staticClass:"line-number"},[s._v("193")]),n("br"),n("span",{staticClass:"line-number"},[s._v("194")]),n("br"),n("span",{staticClass:"line-number"},[s._v("195")]),n("br"),n("span",{staticClass:"line-number"},[s._v("196")]),n("br"),n("span",{staticClass:"line-number"},[s._v("197")]),n("br"),n("span",{staticClass:"line-number"},[s._v("198")]),n("br"),n("span",{staticClass:"line-number"},[s._v("199")]),n("br"),n("span",{staticClass:"line-number"},[s._v("200")]),n("br"),n("span",{staticClass:"line-number"},[s._v("201")]),n("br"),n("span",{staticClass:"line-number"},[s._v("202")]),n("br"),n("span",{staticClass:"line-number"},[s._v("203")]),n("br"),n("span",{staticClass:"line-number"},[s._v("204")]),n("br"),n("span",{staticClass:"line-number"},[s._v("205")]),n("br"),n("span",{staticClass:"line-number"},[s._v("206")]),n("br"),n("span",{staticClass:"line-number"},[s._v("207")]),n("br"),n("span",{staticClass:"line-number"},[s._v("208")]),n("br"),n("span",{staticClass:"line-number"},[s._v("209")]),n("br"),n("span",{staticClass:"line-number"},[s._v("210")]),n("br"),n("span",{staticClass:"line-number"},[s._v("211")]),n("br"),n("span",{staticClass:"line-number"},[s._v("212")]),n("br"),n("span",{staticClass:"line-number"},[s._v("213")]),n("br"),n("span",{staticClass:"line-number"},[s._v("214")]),n("br"),n("span",{staticClass:"line-number"},[s._v("215")]),n("br"),n("span",{staticClass:"line-number"},[s._v("216")]),n("br"),n("span",{staticClass:"line-number"},[s._v("217")]),n("br"),n("span",{staticClass:"line-number"},[s._v("218")]),n("br"),n("span",{staticClass:"line-number"},[s._v("219")]),n("br"),n("span",{staticClass:"line-number"},[s._v("220")]),n("br"),n("span",{staticClass:"line-number"},[s._v("221")]),n("br"),n("span",{staticClass:"line-number"},[s._v("222")]),n("br"),n("span",{staticClass:"line-number"},[s._v("223")]),n("br"),n("span",{staticClass:"line-number"},[s._v("224")]),n("br"),n("span",{staticClass:"line-number"},[s._v("225")]),n("br"),n("span",{staticClass:"line-number"},[s._v("226")]),n("br"),n("span",{staticClass:"line-number"},[s._v("227")]),n("br"),n("span",{staticClass:"line-number"},[s._v("228")]),n("br"),n("span",{staticClass:"line-number"},[s._v("229")]),n("br"),n("span",{staticClass:"line-number"},[s._v("230")]),n("br"),n("span",{staticClass:"line-number"},[s._v("231")]),n("br"),n("span",{staticClass:"line-number"},[s._v("232")]),n("br"),n("span",{staticClass:"line-number"},[s._v("233")]),n("br"),n("span",{staticClass:"line-number"},[s._v("234")]),n("br"),n("span",{staticClass:"line-number"},[s._v("235")]),n("br"),n("span",{staticClass:"line-number"},[s._v("236")]),n("br"),n("span",{staticClass:"line-number"},[s._v("237")]),n("br"),n("span",{staticClass:"line-number"},[s._v("238")]),n("br"),n("span",{staticClass:"line-number"},[s._v("239")]),n("br"),n("span",{staticClass:"line-number"},[s._v("240")]),n("br"),n("span",{staticClass:"line-number"},[s._v("241")]),n("br"),n("span",{staticClass:"line-number"},[s._v("242")]),n("br"),n("span",{staticClass:"line-number"},[s._v("243")]),n("br"),n("span",{staticClass:"line-number"},[s._v("244")]),n("br"),n("span",{staticClass:"line-number"},[s._v("245")]),n("br"),n("span",{staticClass:"line-number"},[s._v("246")]),n("br"),n("span",{staticClass:"line-number"},[s._v("247")]),n("br"),n("span",{staticClass:"line-number"},[s._v("248")]),n("br"),n("span",{staticClass:"line-number"},[s._v("249")]),n("br"),n("span",{staticClass:"line-number"},[s._v("250")]),n("br"),n("span",{staticClass:"line-number"},[s._v("251")]),n("br"),n("span",{staticClass:"line-number"},[s._v("252")]),n("br"),n("span",{staticClass:"line-number"},[s._v("253")]),n("br"),n("span",{staticClass:"line-number"},[s._v("254")]),n("br"),n("span",{staticClass:"line-number"},[s._v("255")]),n("br"),n("span",{staticClass:"line-number"},[s._v("256")]),n("br")])]),n("h3",{attrs:{id:"开始制作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开始制作"}},[s._v("#")]),s._v(" 开始制作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("rpmbuild -bb rpmbuild/SPECS/mysql-5.7.17-new.spec\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("完成后在rpmbuild/RPM目录下就会两个rpm包")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@rhce ~]# ll rpmbuild/RPMS/x86_64/\ntotal 267280\n-rw-r--r-- 1 root root  80603892 May 28 19:47 mysql-5.7.17-1.el6.x86_64.rpm\n-rw-r--r-- 1 root root 193088996 May 28 19:48 mysql-debuginfo-5.7.17-1.el6.x86_64.rpm\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"安装mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装mysql"}},[s._v("#")]),s._v(" 安装MySQL")]),s._v(" "),n("p",[s._v("执行rpm安装，安装完成后会直接启动MySQL：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rhce ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ivh rpmbuild/RPMS/x86_64/mysql-5.7.17-1.el6.x86_64.rpm")]),s._v("\nPreparing"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("########################################### [100%]")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":mysql                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("########################################### [100%]")]),s._v("\nStarting MySQL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  OK  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"卸载mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#卸载mysql"}},[s._v("#")]),s._v(" 卸载MySQL")]),s._v(" "),n("p",[s._v("不需要关闭服务直接卸载：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@rhce ~]# rpm -e --nodeps mysql-5.7.17-1.el6.x86_64\nShutting down MySQL..[  OK  ]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("blockquote",[n("p",[s._v("注意这里配置了，在卸载服务时会把mysql目录删除，所以要先备份数据。")])]),s._v(" "),n("h3",{attrs:{id:"rpm相关命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rpm相关命令"}},[s._v("#")]),s._v(" rpm相关命令")]),s._v(" "),n("ul",[n("li",[s._v("rpm -qp --scripts  mysql-5.5.32-1.x86_64.rpm - 查看包内脚本信息")]),s._v(" "),n("li",[s._v("rpm -qpl mysql-5.5.32-1.x86_64.rpm - 查看rpm包内包含哪些文件及目录")])]),s._v(" "),n("h3",{attrs:{id:"编译命令说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译命令说明"}},[s._v("#")]),s._v(" 编译命令说明")]),s._v(" "),n("p",[n("strong",[s._v("rpmbuild")])]),s._v(" "),n("ul",[n("li",[s._v("-ba 既生成src.rpm又生成二进制rpm")]),s._v(" "),n("li",[s._v("-bs 只生成src的rpm")]),s._v(" "),n("li",[s._v("-bb 只生二进制的rpm")]),s._v(" "),n("li",[s._v("-bp 执行到pre")]),s._v(" "),n("li",[s._v("-bc 执行到 build段")]),s._v(" "),n("li",[s._v("-bi 执行install段")]),s._v(" "),n("li",[s._v("-bl 检测有文件没包含")])]),s._v(" "),n("p",[n("strong",[s._v("更新YUM源")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("createrepo --update 3rd/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{438:function(t,s,a){"use strict";a.r(s);var e=a(51),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"greenplum维护手册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#greenplum维护手册"}},[t._v("#")]),t._v(" Greenplum维护手册")]),t._v(" "),a("h2",{attrs:{id:"启动数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动数据库"}},[t._v("#")]),t._v(" 启动数据库")]),t._v(" "),a("blockquote",[a("p",[t._v("gpstart")])]),t._v(" "),a("p",[t._v("常用可选参数：")]),t._v(" "),a("ul",[a("li",[t._v("-a : 直接启动，不提示终端用户输入确认")]),t._v(" "),a("li",[t._v("-m:只启动master 实例，主要在故障处理时使用")])]),t._v(" "),a("h2",{attrs:{id:"停止数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止数据库"}},[t._v("#")]),t._v(" 停止数据库")]),t._v(" "),a("blockquote",[a("p",[t._v("gpstop")])]),t._v(" "),a("p",[t._v("常用可选参数：")]),t._v(" "),a("ul",[a("li",[t._v("-a：直接停止，不提示终端用户输入确认")]),t._v(" "),a("li",[t._v("-m：只停止master实例，与"),a("code",[t._v("gpstart –m")]),t._v("对应使用")]),t._v(" "),a("li",[t._v("-M fast：停止数据库，中断所有数据库连接，回滚正在运行的事务")]),t._v(" "),a("li",[t._v("-u：不停止数据库，只加载pg_hba.conf和postgresql.conf中运行时参数，当改动参数配置时候使用。")]),t._v(" "),a("li",[t._v("-f：强制停止数据库")]),t._v(" "),a("li",[t._v("-r： 重启数据库")])]),t._v(" "),a("h2",{attrs:{id:"重启数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启数据库"}},[t._v("#")]),t._v(" 重启数据库")]),t._v(" "),a("blockquote",[a("p",[t._v("gpstop -a -M immediate && gpstart -a && gpstop -u")])]),t._v(" "),a("h2",{attrs:{id:"查看实例配置和状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看实例配置和状态"}},[t._v("#")]),t._v(" 查看实例配置和状态")]),t._v(" "),a("blockquote",[a("p",[t._v("select * from gp_segment_configuration order by 1")])]),t._v(" "),a("p",[t._v("主要字段说明：")]),t._v(" "),a("ul",[a("li",[t._v("Content：该字段相等的两个实例，是一对Ｐ（primary instance）和Ｍ（mirror            Instance)")]),t._v(" "),a("li",[t._v("Isprimary：实例是否作为primary instance运行")]),t._v(" "),a("li",[t._v("Valid：实例是否有效，如处于false状态，则说明该实例已经down掉。")]),t._v(" "),a("li",[t._v("Port：实例运行的端口")]),t._v(" "),a("li",[t._v("Datadir:实例对应的数据目录")])]),t._v(" "),a("h2",{attrs:{id:"实例配置的数据表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例配置的数据表"}},[t._v("#")]),t._v(" 实例配置的数据表")]),t._v(" "),a("p",[t._v("gp_segment_configuration、pg_filespace_entry、gp_fault_strategy")]),t._v(" "),a("p",[t._v("其它常用的系统表：pg_class,pg_attribute,pg_database,pg_tables……")]),t._v(" "),a("p",[t._v("可以用tab来匹配表名；")]),t._v(" "),a("h2",{attrs:{id:"显示数据库运行状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显示数据库运行状态"}},[t._v("#")]),t._v(" 显示数据库运行状态")]),t._v(" "),a("blockquote",[a("p",[t._v("gpstate 显示Greenplum数据库运行状态、详细配置等信息")])]),t._v(" "),a("p",[t._v("常用可选参数:")]),t._v(" "),a("ul",[a("li",[t._v("-c：primary instance 和 mirror instance 的对应关系")]),t._v(" "),a("li",[t._v("-m：只列出mirror 实例的状态和配置信息")]),t._v(" "),a("li",[t._v("-f：显示standby master 的详细信息")]),t._v(" "),a("li",[t._v("-s：查看详细状态，如在同步，可显示数据同步完成百分比")]),t._v(" "),a("li",[t._v("--version,查看数据库version，也可使用"),a("code",[t._v("pg_controldata")]),t._v("查看数据库版本和postgresql版本） 该命令默认列出数据库运行状态汇总信息，常用于日常巡检。")])]),t._v(" "),a("h2",{attrs:{id:"查看用户会话和查询信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看用户会话和查询信息"}},[t._v("#")]),t._v(" 查看用户会话和查询信息")]),t._v(" "),a("blockquote",[a("p",[t._v("select * from pg_stat_activity")])]),t._v(" "),a("p",[t._v("该表能查看到当前数据库连接的IP 地址，用户名，提交的查询等。另外也可以在master 主机上查看进程，对每个客户端连接，master 都会创建一个进程。"),a("code",[t._v("ps -ef |grep -i postgres |grep -i con")])]),t._v(" "),a("h2",{attrs:{id:"杀会话"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#杀会话"}},[t._v("#")]),t._v(" 杀会话")]),t._v(" "),a("blockquote",[a("p",[t._v("select pg_cancel_backend(procpid);")])]),t._v(" "),a("ul",[a("li",[t._v("如果无法杀掉则使用")])]),t._v(" "),a("blockquote",[a("p",[t._v("select pg_terminate_backend(procpid);")])]),t._v(" "),a("p",[t._v("**注意：**很可能不能杀掉会话，此时只能重启数据库了，如果使用"),a("code",[t._v("kill -9")]),t._v("去杀进程也会导致数据库重启。")]),t._v(" "),a("h2",{attrs:{id:"查看表占用空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看表占用空间"}},[t._v("#")]),t._v(" 查看表占用空间")]),t._v(" "),a("blockquote",[a("p",[t._v("select pg_size_pretty(pg_relation_size('schema.tablename'));")])]),t._v(" "),a("p",[t._v("与pg_tables子查询查看所有表的占用空间")]),t._v(" "),a("blockquote",[a("p",[t._v("select pg_size_pretty(pg_database_size('databasename));")])]),t._v(" "),a("p",[t._v("**注意：**数据库所对应的存储系统里，建议至少保留30%的自由空间，日常巡检，要检查")]),t._v(" "),a("p",[t._v("存储空间的剩余容量。")]),t._v(" "),a("h2",{attrs:{id:"收集统计信息回收空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#收集统计信息回收空间"}},[t._v("#")]),t._v(" 收集统计信息回收空间")]),t._v(" "),a("p",[t._v("定期使用"),a("code",[t._v("Vacuum analyze tablename")]),t._v("回收垃圾和收集统计信息，尤其在大数据量删除，导入以后，非常重要、需要定期对数据字典做vacuum和reindex ，如pg_class,pg_attribute等系统表。\n可以查询"),a("code",[t._v("gp_toolkit.gp_bloat_diag")]),t._v("看膨胀很大的表；")]),t._v(" "),a("blockquote",[a("p",[t._v("Alter table可以用来代替vacuum full 回收空间(除了系统表):")]),t._v(" "),a("p",[t._v("alter table test set with (reorganize=true);")])]),t._v(" "),a("p",[t._v("每天定期运行以下脚本:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("#!/bin/bash\nsource ~/.bash_profile\nDBNAME=\"fedw\"\nSYSTABLES=\"' pg_catalog.' || relname || ';' from pg_class a, pg_namespace b \\\nwhere a.relnamespace=b.oid and b.nspname='pg_catalog' and a.relkind='r'\"\npsql -tc \"SELECT 'VACUUM' || $SYSTABLES\" $DBNAME | psql -a $DBNAME\nreindexdb -s -d $DBNAME\nanalyzedb -a -s pg_catalog -d $DBNAME\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h2",{attrs:{id:"查看数据分布情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看数据分布情况"}},[t._v("#")]),t._v(" 查看数据分布情况")]),t._v(" "),a("p",[t._v("两种方式")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Select gp_segment_id,count(*) from tablename group by 1")])]),t._v(" "),a("li",[a("p",[t._v("在命令运行：gpskew -t public.ate -a postgres")])])]),t._v(" "),a("p",[t._v("如数据分布不均匀，将发挥不了并行计算的优势，严重影响性能。")]),t._v(" "),a("h2",{attrs:{id:"登录每一个实例数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录每一个实例数据库"}},[t._v("#")]),t._v(" 登录每一个实例数据库")]),t._v(" "),a("blockquote",[a("p",[t._v("PGOPTIONS='-c gp_session_role=utility' psql -ddbname –p xxxx")])]),t._v(" "),a("p",[t._v("可以通过这个命令登录实例，一般用于检测单个实例是否运行正常，还有就是用于在集群发生不一致时（只有在非常特殊的情况下才有可能发生，如表不一致等），进行表维护。")]),t._v(" "),a("ul",[a("li",[t._v("进入维护模式，允许修改系统表")])]),t._v(" "),a("blockquote",[a("p",[t._v("set allow_system_table_mods='dml';")])]),t._v(" "),a("h2",{attrs:{id:"实例恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例恢复"}},[t._v("#")]),t._v(" 实例恢复")]),t._v(" "),a("blockquote",[a("p",[t._v("gprecoverseg")])]),t._v(" "),a("p",[t._v("通过"),a("code",[t._v("gpstate")]),t._v("或查询gp_segement_configuration系统表发现有实例down掉以后，使用该命令进行恢复。")]),t._v(" "),a("ul",[a("li",[t._v("-F 强制恢复")]),t._v(" "),a("li",[t._v("-i XXX 通过XXX文件指定只修复特定的镜像，以加快修复速度。与-o配合使用。")]),t._v(" "),a("li",[t._v("-o XXX 生成镜像修复指定配置文件. 与-i配合使用。")]),t._v(" "),a("li",[t._v("-a 全量修复镜像。")]),t._v(" "),a("li",[t._v("-r 恢复实例角色。")])]),t._v(" "),a("h2",{attrs:{id:"查看锁信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看锁信息"}},[t._v("#")]),t._v(" 查看锁信息")]),t._v(" "),a("p",[t._v("注：在Greenplum里（截至到4.0版本），INSERT 和COPY都是行级锁，UPDATE/DELETE都是表级锁；")]),t._v(" "),a("blockquote",[a("p",[t._v("SELECT locktype, database, c.relname, l.relation, l.transactionid, l.transaction, l.pid, l.mode, l.granted, a.current_query FROM pg_locks l, pg_class c, pg_stat_activity a WHERE l.relation=c.oid AND l.pid=a.procpid ORDER BY c.relname;")])]),t._v(" "),a("p",[t._v("主要字段说明：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("relname: 表名")])]),t._v(" "),a("li",[a("p",[t._v("locktype、mode 标识了锁的类型")])])]),t._v(" "),a("p",[t._v("**注：**也可以通过pgadminIII的工具->服务器状态查看当前运行的SQL及锁等待情况。")]),t._v(" "),a("p",[t._v("发生Deadlock时，系统自动让其中一个SQL失败，并提示deadlock信息。")]),t._v(" "),a("h2",{attrs:{id:"查询执行计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询执行计划"}},[t._v("#")]),t._v(" 查询执行计划")]),t._v(" "),a("blockquote",[a("p",[t._v("explain")])]),t._v(" "),a("p",[t._v("在提交大的查询之前，使用explain分析执行计划、发现潜在优化机会，避免将系统资源熬尽。")]),t._v(" "),a("blockquote",[a("p",[t._v("explain analyze  sql")])]),t._v(" "),a("p",[t._v("将执行一次SQL，并行将过程中的具体cost和运行情况记录下来。")]),t._v(" "),a("p",[t._v("也可以用pgadminIII进行explain的图形化显示，进而来优化执行路径，如表关联策略等。")]),t._v(" "),a("p",[t._v("**注：**可以在Master的postgresql.conf中 修改")]),t._v(" "),a("p",[t._v("log_min_duration_statement=5000s，SQL运行耗时超过这个值得都在pg_log纪")]),t._v(" "),a("p",[t._v("录SQL的实际耗时，用来监控耗时的SQL。")]),t._v(" "),a("h2",{attrs:{id:"数据库并行备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库并行备份"}},[t._v("#")]),t._v(" 数据库并行备份")]),t._v(" "),a("blockquote",[a("p",[t._v("gp_dump")])]),t._v(" "),a("p",[t._v("常用参数")]),t._v(" "),a("ul",[a("li",[t._v("-s: 只导出对象定义（表结构，函数等）")]),t._v(" "),a("li",[t._v("-n: 只导出某个schema")])]),t._v(" "),a("p",[t._v("gp_dump默认在master的data目录上产生这些文件：")]),t._v(" "),a("ul",[a("li",[t._v("gp_catalog_1__ ：关于数据库系统配置的备份文件")]),t._v(" "),a("li",[t._v("gp_cdatabase_1__：数据库创建语句的备份文件")]),t._v(" "),a("li",[t._v("gp_dump_1__：数据库对象ddl语句")]),t._v(" "),a("li",[t._v("gp_dump_status_1__：备份操作的日志")])]),t._v(" "),a("p",[t._v("在每个segment instance上的data目录上产生的文件：")]),t._v(" "),a("ul",[a("li",[t._v("gp_dump_0__：用户数据备份文件")]),t._v(" "),a("li",[t._v("gp_dump_status_0__：备份日志")])]),t._v(" "),a("blockquote",[a("p",[t._v("gpcorndump")])]),t._v(" "),a("p",[t._v("可以用于备份数据库配置文件和全局数据（如角色、资源队列等）")]),t._v(" "),a("p",[a("strong",[t._v("Example:")])]),t._v(" "),a("blockquote",[a("p",[t._v("gpcrondump -x mydatabase  –u  /xxx/  -c -g –G –a –q >>$DATE.log")])]),t._v(" "),a("ul",[a("li",[t._v("-g 备份postgresql.conf、pg_hba.conf、pg_ident.conf")]),t._v(" "),a("li",[t._v("-G  备份全局对象")]),t._v(" "),a("li",[t._v("-u  备份到的目录(如果没有-u，则数据备份到每个数据目录里面)")])]),t._v(" "),a("p",[t._v("gpcrondump的文件可以用"),a("code",[t._v("gp_restore")]),t._v("恢复")]),t._v(" "),a("blockquote",[a("p",[t._v("gp_restore --gp-c --gp-d=/data/backup/db_dumps/20110423/ --gp-k=20110423103328  -d gpadmin")])]),t._v(" "),a("p",[t._v("也可以用"),a("code",[t._v("gpdbresotre")]),t._v("恢复：(需要数据在一个Host上)")]),t._v(" "),a("blockquote",[a("p",[t._v("gpdbrestoree  -R master=/data/backup/db_dumps/20110423")]),t._v(" "),a("p",[t._v("-T 可以只恢复其中的某表（比gp_dump多这个参数）")]),t._v(" "),a("p",[t._v("gpdbrestore -t 20120229182541 -T public.account")])]),t._v(" "),a("h2",{attrs:{id:"数据库恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库恢复"}},[t._v("#")]),t._v(" 数据库恢复")]),t._v(" "),a("blockquote",[a("p",[t._v("gp_restore")])]),t._v(" "),a("p",[t._v("必选参数")]),t._v(" "),a("ul",[a("li",[t._v("--gp-k=key ：key 为gp_dump 导出来的文件的后缀时间戳")]),t._v(" "),a("li",[t._v("-d dbname  ：将备份文件恢复到dbname")])]),t._v(" "),a("h2",{attrs:{id:"串行备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#串行备份"}},[t._v("#")]),t._v(" 串行备份")]),t._v(" "),a("blockquote",[a("p",[t._v("pg_dump/pg_dumpall")])]),t._v(" "),a("p",[t._v("一般用于环境迁移和DDL、FUNCTION等备份；")]),t._v(" "),a("p",[a("strong",[t._v("如：")])]),t._v(" "),a("blockquote",[a("p",[t._v("pg_dump  -s  -n public  demodb –f  demodb.sql")])]),t._v(" "),a("p",[t._v("将只备份demodb数据库中的public下的所有DDL和FUNCTION，-s表示不备份数据；\n恢复时，使用")]),t._v(" "),a("blockquote",[a("p",[t._v("psql  -d demodb –f  demodb.sql")])]),t._v(" "),a("h2",{attrs:{id:"数据库僵尸进程处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库僵尸进程处理"}},[t._v("#")]),t._v(" 数据库僵尸进程处理")]),t._v(" "),a("p",[t._v("首先使用kill -15 去停止进程，kill -15不响应，再用kill -11;一般情况下，不要用kill -9，否则可能导致数据库宕机且状态不一致，严重的导致数据库不能重新启动，可能需要用pg_resetxlog去重置日志，有可能导致数据丢失；")]),t._v(" "),a("h2",{attrs:{id:"参数更改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数更改"}},[t._v("#")]),t._v(" 参数更改")]),t._v(" "),a("p",[t._v("通过gpconfig配置Master和所有Segment的postgresql.conf中参数。")]),t._v(" "),a("blockquote",[a("p",[t._v("gpconfig -c work_mem -v 120MB –masteronly")])]),t._v(" "),a("ul",[a("li",[t._v("修改master上的work_mem =120MB")])]),t._v(" "),a("blockquote",[a("p",[t._v("gpconfig -c max_connections -v 100 -m 10")])]),t._v(" "),a("ul",[a("li",[t._v("修改Master上max_connections=10，Segment上修改成100")])]),t._v(" "),a("blockquote",[a("p",[t._v("gpconfig -r default_statistics_target")])]),t._v(" "),a("ul",[a("li",[t._v("注释参数，使用缺省参数")])]),t._v(" "),a("blockquote",[a("p",[t._v("gpconfig –l 列出所有的参数\ngpconfig -s max_connections     显示某个参数")])]),t._v(" "),a("h2",{attrs:{id:"其它常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其它常用命令"}},[t._v("#")]),t._v(" 其它常用命令")]),t._v(" "),a("blockquote",[a("p",[t._v("gpssh  -f  all_hosts")])]),t._v(" "),a("ul",[a("li",[t._v("通过SSH同时访问多个节点，并可同时执行shell")])]),t._v(" "),a("blockquote",[a("p",[t._v("gpcheckperf")])]),t._v(" "),a("ul",[a("li",[t._v("检查网络和硬盘性能")])]),t._v(" "),a("blockquote",[a("p",[t._v("checkos  -f all_hosts")])]),t._v(" "),a("ul",[a("li",[t._v("检查OS内核和参数")])]),t._v(" "),a("p",[t._v("检查Disk性能：")]),t._v(" "),a("p",[a("code",[t._v("gpcheckperf -d /data/gpdb_p1 -d /data/gpdb_p2 -d /data/gpdb_p3 -d /data/gpdb_p4 -d /data/gpdb_p5 -d /data/gpdb_p6 -d /data/gpdb_p7 -d /data/gpdb_p8 -S 64GB -r ds -D -v -f hosts-setup")])]),t._v(" "),a("p",[t._v("检查网络性能：")]),t._v(" "),a("p",[a("code",[t._v("gpcheckperf -d /data/gpdb_p1 -r N -f hosts-net0 gpcheckperf -d /data/gpdb_p1 -r N -f hosts-net1 gpcheckperf -d /data/gpdb_p1 -r N -f hosts-net2 gpcheckperf -d /data/gpdb_p1 -r N -f hosts-net3")])]),t._v(" "),a("h2",{attrs:{id:"导出导入数据文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出导入数据文件"}},[t._v("#")]),t._v(" 导出导入数据文件")]),t._v(" "),a("blockquote",[a("p",[t._v("COPY public.ods_data_msg TO '/zte/gpdata/ocs_data_msg.txt' delimiter'|';")])]),t._v(" "),a("blockquote",[a("p",[t._v("COPY public.ods_data_msg from  '/zte/gpdata/ocs_data_msg.txt' WITH delimiter'|';")])]),t._v(" "),a("h2",{attrs:{id:"进程监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进程监控"}},[t._v("#")]),t._v(" 进程监控")]),t._v(" "),a("p",[t._v("select * from pg_stat_activity  where waiting ='t' ORDER BY current_query;    select * from pg_stat_activity  where waiting ='t' ORDER BY sess_id;")]),t._v(" "),a("p",[t._v("select * from pg_stat_activity  where waiting ='f' ORDER BY current_query;    select * from pg_stat_activity  where waiting ='f' ORDER BY sess_id;")]),t._v(" "),a("h2",{attrs:{id:"添加默认分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加默认分区"}},[t._v("#")]),t._v(" 添加默认分区")]),t._v(" "),a("p",[t._v("ALTER TABLE INF.EVENT_TGPS_201307 ADD default PARTITION   PDEFAULT")]),t._v(" "),a("h2",{attrs:{id:"导出对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出对象"}},[t._v("#")]),t._v(" 导出对象")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("pg_dump  -h "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("136.6")]),t._v(".160.196 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(" -U dsj -n dsj -s -T dsj.hot_contents_user_20130710 -T dsj.tbd_bwt_evt_pd_lo_evt_20130709 --gp-syntax cqdsj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" db.sql   \npg_dump  -h "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("136.6")]),t._v(".160.196 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(" -U gpadmin  -n public -s  --gp-syntax xdcx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" xdcx_public.sql  \npg_dump  -h "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("136.6")]),t._v(".160.196 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(" -U gpadmin  -n inf -s  --gp-syntax xdcx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" xdcx_inf.sql  \npg_dump  -h "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("136.6")]),t._v(".160.196 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(" -U gpadmin  -n mid -s  --gp-syntax xdcx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" xdcx_mid.sql    \npg_dump  -h "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("136.6")]),t._v(".160.196 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(" -U inf -n public -s  --gp-syntax xdcx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" xdcx_public.sql    \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h2",{attrs:{id:"表的字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表的字段"}},[t._v("#")]),t._v(" 表的字段")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" PG_ATTRIBUTE  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" ATTRELID "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("  RELFILENODE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" PG_CLASS  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" UPPER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RELNAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("UPPER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DS_EVT_CALL_AREA_201312'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" attstattarget"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-1'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" attnum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h2",{attrs:{id:"查看建表语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看建表语句"}},[t._v("#")]),t._v(" 查看建表语句")]),t._v(" "),a("blockquote",[a("p",[t._v("pg_dump -U your_db_user_name your_database -t your_table_name --schema-only")])]),t._v(" "),a("h2",{attrs:{id:"新建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建用户"}},[t._v("#")]),t._v(" 新建用户")]),t._v(" "),a("p",[t._v("基本权限：usage on schema，select on table，需要这两者都有才可以。")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" ROLE cqcis LOGIN \n  ENCRYPTED PASSWORD "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'md5265eb7390afca3acc1f251fe55e63c00'")]),t._v(" \n  NOSUPERUSER INHERIT NOCREATEDB NOCREATEROLE RESOURCE QUEUE pg_default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USAGE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" inf "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" cqcis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USAGE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" mid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" cqcis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USAGE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" cqcis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" cqcis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n新的版本中可以让某个角色自动拥有新增表的权限，老版本不支持。\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIVILEGES")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" myschema "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PUBLIC")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h2",{attrs:{id:"生成授权语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成授权语句"}},[t._v("#")]),t._v(" 生成授权语句")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'grant select on '")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("relname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("' to 用户名;'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pg_class a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pg_namespace b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" relname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%prt%'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" relkind "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'r'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" has_table_privilege"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'用户名'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'select'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'f'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relnamespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" nspname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pg_catalog'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'information_schema'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gp_toolkit'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" nspname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%pg_temp%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"导出用户信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出用户信息"}},[t._v("#")]),t._v(" 导出用户信息")]),t._v(" "),a("blockquote",[a("p",[t._v("pg_dumpall --roles-only")])]),t._v(" "),a("h2",{attrs:{id:"模式管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模式管理"}},[t._v("#")]),t._v(" 模式管理")]),t._v(" "),a("p",[t._v("查询当前可以直接访问的模式")]),t._v(" "),a("blockquote",[a("p",[t._v("SHOW search_path;")])]),t._v(" "),a("p",[t._v("设置当前可以直接访问的模式：")]),t._v(" "),a("ul",[a("li",[t._v("SET search_path TO  temp,cqdmkt,public;---session级")]),t._v(" "),a("li",[t._v("alter database cqdmkt_new  SET search_path TO  temp,cqdmkt,public;---database级")])]),t._v(" "),a("p",[t._v("第一个模式为默认模式，即在新建表或者函数式，不加模式名的情况，都默认到第一个模式下。")]),t._v(" "),a("h2",{attrs:{id:"表的字段名称及注释的系统表查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表的字段名称及注释的系统表查询"}},[t._v("#")]),t._v(" 表的字段名称及注释的系统表查询")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("  \na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nspname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" schemaname "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" tablename "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attnum                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" columnid "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" columnname "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("FORMAT_TYPE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atttypid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atttypmod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" columntype "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("description "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pg_namespace a  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pg_class b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relnamespace "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relkind"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'r'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pg_attribute d  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attrelid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attnum"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v("  pg_catalog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pg_description e   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objoid  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tableoid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classoid  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attnum"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objsubid    \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v("  a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nspname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cqdmkt'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--write your schema_name  ")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wid_chn_prd_serv_mkt_day'")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--write your table_name  ; ")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h2",{attrs:{id:"greenplum升级和扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#greenplum升级和扩容"}},[t._v("#")]),t._v(" Greenplum升级和扩容")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Upgrade")]),t._v(" "),a("blockquote",[a("p",[t._v("--小版本升级：4.0.4 —> 4.0.5  替换/usr/local/greenplum-db即可  --大版本升级：3.3.7 —> 4.0.4 $gpmigrator")])])]),t._v(" "),a("li",[a("p",[t._v("扩容")]),t._v(" "),a("blockquote",[a("p",[t._v("$gpexpand")])]),t._v(" "),a("ul",[a("li",[t._v("生成扩容文件")])]),t._v(" "),a("blockquote",[a("p",[t._v("gpexpand -f hosts -D mydw")])]),t._v(" "),a("ul",[a("li",[t._v("执行扩容")])]),t._v(" "),a("blockquote",[a("p",[t._v("gpexpand -i gpexpand_inputfile_20161202_183705 -D mydw -n 8")])])])]),t._v(" "),a("h2",{attrs:{id:"gpfdist外部表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gpfdist外部表"}},[t._v("#")]),t._v(" gpfdist外部表")]),t._v(" "),a("p",[t._v("建表SQL：")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" EXTERNAL "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" test_ext "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" \n  id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   dt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("date")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \nLOCATION "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gpfdist://master:8081/test.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  FORMAT "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delimiter")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\\\N'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("escape")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\\\'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  ENCODING "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gb18030'")]),t._v(" \nLOG "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ERRORS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" error_table SEGMENT REJECT "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LIMIT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("启动gpfdist：")]),t._v(" "),a("blockquote",[a("p",[t._v("nohup gpfdist -d /tmp/ -p 8081 &")])]),t._v(" "),a("h2",{attrs:{id:"使用vacuum-full回收垃圾的建议操作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用vacuum-full回收垃圾的建议操作流程"}},[t._v("#")]),t._v(" 使用vacuum full回收垃圾的建议操作流程")]),t._v(" "),a("ol",[a("li",[t._v("录下表的索引定义")]),t._v(" "),a("li",[t._v("除索引")]),t._v(" "),a("li",[t._v("acuum full 表")]),t._v(" "),a("li",[t._v("行重建索引")])]),t._v(" "),a("h2",{attrs:{id:"关闭orca"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭orca"}},[t._v("#")]),t._v(" 关闭ORCA")]),t._v(" "),a("ul",[a("li",[t._v("set optimizer=off;")]),t._v(" "),a("li",[t._v("gpconfig -c optimizer -v off")])]),t._v(" "),a("h2",{attrs:{id:"gplogfilter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gplogfilter"}},[t._v("#")]),t._v(" gplogfilter")]),t._v(" "),a("ul",[a("li",[t._v("最近1天错误日志 - "),a("code",[t._v("gplogfilter -t -n 1")])]),t._v(" "),a("li",[t._v("最近5分钟错误日志 - "),a("code",[t._v("gplogfilter -d :10")])]),t._v(" "),a("li",[t._v("包含特定字符 - "),a("code",[t._v("gplogfilter -f '|con1 cmd22|'")])]),t._v(" "),a("li",[t._v("某时间段内的ERROR - "),a("code",[t._v("gplogfilter -b '2011-01-01 01:01:11' -e '2011-01-01 02:00:00' -c i -f ERROR")])]),t._v(" "),a("li",[t._v("搜索所有csv - "),a("code",[t._v("gplogfilter -b '2011-01-01 01:01:11' -e '2011-01-01 02:00:00' /data/*/pg_log/gpdb-2011-01-*.csv")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Greenplum维护手册 | 韦勇的博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="DBA，程序员，专注于IT互联网，大数据，包括但不限于数据库、Python等。">
    <meta name="keywords" content="DBA博客,个人技术博客,数据库,前端开发,前端框架,web前端,技术文档,学习,mysql,redis,mongodb,postgresql,greenplum,aerospike,scylladb,vertica,Python,JavaScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.c231a23d.css" as="style"><link rel="preload" href="/assets/js/app.b45ba360.js" as="script"><link rel="preload" href="/assets/js/2.6eac6864.js" as="script"><link rel="preload" href="/assets/js/3.a88a92d5.js" as="script"><link rel="preload" href="/assets/js/39.7f29c316.js" as="script"><link rel="prefetch" href="/assets/js/10.9ac750bc.js"><link rel="prefetch" href="/assets/js/11.d59f0158.js"><link rel="prefetch" href="/assets/js/12.8cb6333d.js"><link rel="prefetch" href="/assets/js/13.8d09723d.js"><link rel="prefetch" href="/assets/js/14.489067bb.js"><link rel="prefetch" href="/assets/js/15.67863306.js"><link rel="prefetch" href="/assets/js/16.7bf247d8.js"><link rel="prefetch" href="/assets/js/17.121f6b76.js"><link rel="prefetch" href="/assets/js/18.4a67525f.js"><link rel="prefetch" href="/assets/js/19.99a721fb.js"><link rel="prefetch" href="/assets/js/20.4d4ffe62.js"><link rel="prefetch" href="/assets/js/21.988d351d.js"><link rel="prefetch" href="/assets/js/22.1e452d5b.js"><link rel="prefetch" href="/assets/js/23.705c804a.js"><link rel="prefetch" href="/assets/js/24.4160caef.js"><link rel="prefetch" href="/assets/js/25.c0cead69.js"><link rel="prefetch" href="/assets/js/26.8474fcb9.js"><link rel="prefetch" href="/assets/js/27.68577f4d.js"><link rel="prefetch" href="/assets/js/28.76404f22.js"><link rel="prefetch" href="/assets/js/29.29ebfa2e.js"><link rel="prefetch" href="/assets/js/30.42cb86c5.js"><link rel="prefetch" href="/assets/js/31.e9a9f49e.js"><link rel="prefetch" href="/assets/js/32.a1c8cda8.js"><link rel="prefetch" href="/assets/js/33.de67351d.js"><link rel="prefetch" href="/assets/js/34.72daac17.js"><link rel="prefetch" href="/assets/js/35.0d28f4f7.js"><link rel="prefetch" href="/assets/js/36.f50a6e95.js"><link rel="prefetch" href="/assets/js/37.0cb9802c.js"><link rel="prefetch" href="/assets/js/38.14a9b8c9.js"><link rel="prefetch" href="/assets/js/4.c2705a33.js"><link rel="prefetch" href="/assets/js/40.4bd4ac79.js"><link rel="prefetch" href="/assets/js/41.beb899d2.js"><link rel="prefetch" href="/assets/js/42.92fd262d.js"><link rel="prefetch" href="/assets/js/43.f93ed735.js"><link rel="prefetch" href="/assets/js/44.37e9f48e.js"><link rel="prefetch" href="/assets/js/45.171bf2c1.js"><link rel="prefetch" href="/assets/js/46.ab0fa104.js"><link rel="prefetch" href="/assets/js/47.2bd4da2a.js"><link rel="prefetch" href="/assets/js/48.6f1ece74.js"><link rel="prefetch" href="/assets/js/49.7ee1a812.js"><link rel="prefetch" href="/assets/js/5.4c01046b.js"><link rel="prefetch" href="/assets/js/50.4ea52293.js"><link rel="prefetch" href="/assets/js/51.b5737a73.js"><link rel="prefetch" href="/assets/js/52.a8911a99.js"><link rel="prefetch" href="/assets/js/53.562b75b3.js"><link rel="prefetch" href="/assets/js/54.43b31295.js"><link rel="prefetch" href="/assets/js/55.722f0ac0.js"><link rel="prefetch" href="/assets/js/56.dd56fc0d.js"><link rel="prefetch" href="/assets/js/57.51f8e820.js"><link rel="prefetch" href="/assets/js/58.a6751fea.js"><link rel="prefetch" href="/assets/js/59.5b67abf1.js"><link rel="prefetch" href="/assets/js/6.38f9d1c7.js"><link rel="prefetch" href="/assets/js/60.40b9f1c0.js"><link rel="prefetch" href="/assets/js/61.cf3bc22e.js"><link rel="prefetch" href="/assets/js/62.ee744d9e.js"><link rel="prefetch" href="/assets/js/63.ecae0239.js"><link rel="prefetch" href="/assets/js/64.2e99c3e7.js"><link rel="prefetch" href="/assets/js/65.b3515acb.js"><link rel="prefetch" href="/assets/js/66.0c5c25c6.js"><link rel="prefetch" href="/assets/js/67.b90820e6.js"><link rel="prefetch" href="/assets/js/68.9d0729eb.js"><link rel="prefetch" href="/assets/js/69.751b150c.js"><link rel="prefetch" href="/assets/js/7.e34b3bc8.js"><link rel="prefetch" href="/assets/js/70.67171620.js"><link rel="prefetch" href="/assets/js/71.59324e4a.js"><link rel="prefetch" href="/assets/js/72.d931ea49.js"><link rel="prefetch" href="/assets/js/73.82b3b67b.js"><link rel="prefetch" href="/assets/js/74.55622a29.js"><link rel="prefetch" href="/assets/js/75.4130e842.js"><link rel="prefetch" href="/assets/js/76.c5f76e21.js"><link rel="prefetch" href="/assets/js/8.d51727c6.js"><link rel="prefetch" href="/assets/js/9.44347f46.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c231a23d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">韦勇的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系统" class="dropdown-title"><a href="/system/" class="link-title">系统</a> <span class="title" style="display:none;">系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>系统文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/654590/" class="nav-link">Linux维护手册</a></li><li class="dropdown-subitem"><a href="/pages/85d59c/" class="nav-link">使用iotune测试磁盘读写</a></li><li class="dropdown-subitem"><a href="/pages/45c411/" class="nav-link">源码编译gcc</a></li><li class="dropdown-subitem"><a href="/pages/187f4d/" class="nav-link">YCSB压测</a></li><li class="dropdown-subitem"><a href="/pages/ca2bd6/" class="nav-link">write ahead</a></li></ul></li><li class="dropdown-item"><h4>编程开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">编程开发</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><a href="/mysql/" class="link-title">MySQL</a> <span class="title" style="display:none;">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a6ac55/" class="nav-link">部署</a></li></ul></li><li class="dropdown-item"><h4>HA</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c78f1b/" class="nav-link">HA选型</a></li><li class="dropdown-subitem"><a href="/pages/0439fa/" class="nav-link">MGR</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a0df55/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>笔记文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ee31c0/" class="nav-link">MySQL8新特性</a></li><li class="dropdown-subitem"><a href="/pages/08b679/" class="nav-link">SQL优化</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PostgreSQL" class="dropdown-title"><a href="/postgresql/" class="link-title">PostgreSQL</a> <span class="title" style="display:none;">PostgreSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/859ac7/" class="nav-link">部署</a></li><li class="dropdown-subitem"><a href="/pages/2373b5/" class="nav-link">运维手册</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/96963a/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>源码开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ddbfb5/" class="nav-link">统计SQL执行耗时分位</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/distributed/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Greenplum</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/441817/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/4bb09b/" aria-current="page" class="nav-link router-link-exact-active router-link-active">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/84a443/" class="nav-link">监控指标</a></li></ul></li><li class="dropdown-item"><h4>Scylladb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2cae68/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/342275/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/95d8cc/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/e27c40/" class="nav-link">数据迁移</a></li><li class="dropdown-subitem"><a href="/pages/cf45d3/" class="nav-link">监控部署</a></li></ul></li><li class="dropdown-item"><h4>Aerospike</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd9ddc/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/80ee1a/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/9ba431/" class="nav-link">管理手册</a></li><li class="dropdown-subitem"><a href="/pages/76e199/" class="nav-link">ACT测试</a></li><li class="dropdown-subitem"><a href="/pages/4131aa/" class="nav-link">源码编译</a></li><li class="dropdown-subitem"><a href="/pages/75d8ce/" class="nav-link">数据加载</a></li></ul></li><li class="dropdown-item"><h4>Vertica</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b023ab/" class="nav-link">安装部署</a></li></ul></li><li class="dropdown-item"><h4>Tidb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a52d49/" class="nav-link">数据迁移</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NoSQL" class="dropdown-title"><a href="/nosql/" class="link-title">NoSQL</a> <span class="title" style="display:none;">NoSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b9b610/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/5cdb24/" class="nav-link">性能测试</a></li><li class="dropdown-subitem"><a href="/pages/52f09b/" class="nav-link">运维手册</a></li><li class="dropdown-subitem"><a href="/pages/855952/" class="nav-link">安全加固</a></li><li class="dropdown-subitem"><a href="/pages/fea0b7/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" class="nav-link">新特性</a></li></ul></li><li class="dropdown-item"><h4>MongoDB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/61caf7/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/e25894/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/7de6de/" class="nav-link">运维手册</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程开发" class="dropdown-title"><a href="/dev/" class="link-title">编程开发</a> <span class="title" style="display:none;">编程开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c77a4b/" class="nav-link">开发笔记</a></li><li class="dropdown-subitem"><a href="/pages/8503e3/" class="nav-link">安装笔记</a></li><li class="dropdown-subitem"><a href="/pages/6ec23d/" class="nav-link">sqlalchemy</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/23f6e2/" class="nav-link">开发笔记</a></li></ul></li><li class="dropdown-item"><h4>Shell</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">安装部署</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/weiyong.jpeg"> <div class="blogger-info"><h3>yong.wei</h3> <span>
        数据库小学生
      </span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系统" class="dropdown-title"><a href="/system/" class="link-title">系统</a> <span class="title" style="display:none;">系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>系统文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/654590/" class="nav-link">Linux维护手册</a></li><li class="dropdown-subitem"><a href="/pages/85d59c/" class="nav-link">使用iotune测试磁盘读写</a></li><li class="dropdown-subitem"><a href="/pages/45c411/" class="nav-link">源码编译gcc</a></li><li class="dropdown-subitem"><a href="/pages/187f4d/" class="nav-link">YCSB压测</a></li><li class="dropdown-subitem"><a href="/pages/ca2bd6/" class="nav-link">write ahead</a></li></ul></li><li class="dropdown-item"><h4>编程开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">编程开发</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><a href="/mysql/" class="link-title">MySQL</a> <span class="title" style="display:none;">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a6ac55/" class="nav-link">部署</a></li></ul></li><li class="dropdown-item"><h4>HA</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c78f1b/" class="nav-link">HA选型</a></li><li class="dropdown-subitem"><a href="/pages/0439fa/" class="nav-link">MGR</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a0df55/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>笔记文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ee31c0/" class="nav-link">MySQL8新特性</a></li><li class="dropdown-subitem"><a href="/pages/08b679/" class="nav-link">SQL优化</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PostgreSQL" class="dropdown-title"><a href="/postgresql/" class="link-title">PostgreSQL</a> <span class="title" style="display:none;">PostgreSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/859ac7/" class="nav-link">部署</a></li><li class="dropdown-subitem"><a href="/pages/2373b5/" class="nav-link">运维手册</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/96963a/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>源码开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ddbfb5/" class="nav-link">统计SQL执行耗时分位</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/distributed/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Greenplum</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/441817/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/4bb09b/" aria-current="page" class="nav-link router-link-exact-active router-link-active">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/84a443/" class="nav-link">监控指标</a></li></ul></li><li class="dropdown-item"><h4>Scylladb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2cae68/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/342275/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/95d8cc/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/e27c40/" class="nav-link">数据迁移</a></li><li class="dropdown-subitem"><a href="/pages/cf45d3/" class="nav-link">监控部署</a></li></ul></li><li class="dropdown-item"><h4>Aerospike</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd9ddc/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/80ee1a/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/9ba431/" class="nav-link">管理手册</a></li><li class="dropdown-subitem"><a href="/pages/76e199/" class="nav-link">ACT测试</a></li><li class="dropdown-subitem"><a href="/pages/4131aa/" class="nav-link">源码编译</a></li><li class="dropdown-subitem"><a href="/pages/75d8ce/" class="nav-link">数据加载</a></li></ul></li><li class="dropdown-item"><h4>Vertica</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b023ab/" class="nav-link">安装部署</a></li></ul></li><li class="dropdown-item"><h4>Tidb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a52d49/" class="nav-link">数据迁移</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NoSQL" class="dropdown-title"><a href="/nosql/" class="link-title">NoSQL</a> <span class="title" style="display:none;">NoSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b9b610/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/5cdb24/" class="nav-link">性能测试</a></li><li class="dropdown-subitem"><a href="/pages/52f09b/" class="nav-link">运维手册</a></li><li class="dropdown-subitem"><a href="/pages/855952/" class="nav-link">安全加固</a></li><li class="dropdown-subitem"><a href="/pages/fea0b7/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" class="nav-link">新特性</a></li></ul></li><li class="dropdown-item"><h4>MongoDB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/61caf7/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/e25894/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/7de6de/" class="nav-link">运维手册</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程开发" class="dropdown-title"><a href="/dev/" class="link-title">编程开发</a> <span class="title" style="display:none;">编程开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c77a4b/" class="nav-link">开发笔记</a></li><li class="dropdown-subitem"><a href="/pages/8503e3/" class="nav-link">安装笔记</a></li><li class="dropdown-subitem"><a href="/pages/6ec23d/" class="nav-link">sqlalchemy</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/23f6e2/" class="nav-link">开发笔记</a></li></ul></li><li class="dropdown-item"><h4>Shell</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">安装部署</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Greenplum</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dee4e3/" class="sidebar-link">HA部署</a></li><li><a href="/pages/441817/" class="sidebar-link">Greenplum架构介绍</a></li><li><a href="/pages/4bb09b/" aria-current="page" class="active sidebar-link">维护手册</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/4bb09b/#启动数据库" class="sidebar-link">启动数据库</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#停止数据库" class="sidebar-link">停止数据库</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#重启数据库" class="sidebar-link">重启数据库</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#查看实例配置和状态" class="sidebar-link">查看实例配置和状态</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#实例配置的数据表" class="sidebar-link">实例配置的数据表</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#显示数据库运行状态" class="sidebar-link">显示数据库运行状态</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#查看用户会话和查询信息" class="sidebar-link">查看用户会话和查询信息</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#杀会话" class="sidebar-link">杀会话</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#查看表占用空间" class="sidebar-link">查看表占用空间</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#收集统计信息回收空间" class="sidebar-link">收集统计信息回收空间</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#查看数据分布情况" class="sidebar-link">查看数据分布情况</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#登录每一个实例数据库" class="sidebar-link">登录每一个实例数据库</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#实例恢复" class="sidebar-link">实例恢复</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#查看锁信息" class="sidebar-link">查看锁信息</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#查询执行计划" class="sidebar-link">查询执行计划</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#数据库并行备份" class="sidebar-link">数据库并行备份</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#数据库恢复" class="sidebar-link">数据库恢复</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#串行备份" class="sidebar-link">串行备份</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#数据库僵尸进程处理" class="sidebar-link">数据库僵尸进程处理</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#参数更改" class="sidebar-link">参数更改</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#其它常用命令" class="sidebar-link">其它常用命令</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#导出导入数据文件" class="sidebar-link">导出导入数据文件</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#进程监控" class="sidebar-link">进程监控</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#添加默认分区" class="sidebar-link">添加默认分区</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#导出对象" class="sidebar-link">导出对象</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#表的字段" class="sidebar-link">表的字段</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#查看建表语句" class="sidebar-link">查看建表语句</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#新建用户" class="sidebar-link">新建用户</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#生成授权语句" class="sidebar-link">生成授权语句</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#导出用户信息" class="sidebar-link">导出用户信息</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#模式管理" class="sidebar-link">模式管理</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#表的字段名称及注释的系统表查询" class="sidebar-link">表的字段名称及注释的系统表查询</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#greenplum升级和扩容" class="sidebar-link">Greenplum升级和扩容</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#gpfdist外部表" class="sidebar-link">gpfdist外部表</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#使用vacuum-full回收垃圾的建议操作流程" class="sidebar-link">使用vacuum full回收垃圾的建议操作流程</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#关闭orca" class="sidebar-link">关闭ORCA</a></li><li class="sidebar-sub-header"><a href="/pages/4bb09b/#gplogfilter" class="sidebar-link">gplogfilter</a></li></ul></li><li><a href="/pages/84a443/" class="sidebar-link">监控指标</a></li><li><a href="/pages/79caea/" class="sidebar-link">坏快修复</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ScyllaDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Aerospike</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vertica</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TiDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-f6108aee><div class="articleInfo" data-v-f6108aee><ul class="breadcrumbs" data-v-f6108aee><li data-v-f6108aee><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-f6108aee></a></li> <li data-v-f6108aee><a href="/distributed" title="分布式-目录页" data-v-f6108aee>分布式</a></li> <li data-v-f6108aee><a href="/distributed/#Greenplum" title="分布式#Greenplum" data-v-f6108aee>Greenplum</a></li></ul> <div class="info" data-v-f6108aee><div title="作者" class="author iconfont icon-touxiang" data-v-f6108aee><a href="javascript:;" data-v-f6108aee>yong.wei</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-f6108aee><a href="javascript:;" data-v-f6108aee>2020-01-04</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          Greenplum维护手册
        </h1> <div class="theme-vdoing-content content__default"><h1 id="greenplum维护手册"><a href="#greenplum维护手册" class="header-anchor">#</a> Greenplum维护手册</h1> <h2 id="启动数据库"><a href="#启动数据库" class="header-anchor">#</a> 启动数据库</h2> <blockquote><p>gpstart</p></blockquote> <p>常用可选参数：</p> <ul><li>-a : 直接启动，不提示终端用户输入确认</li> <li>-m:只启动master 实例，主要在故障处理时使用</li></ul> <h2 id="停止数据库"><a href="#停止数据库" class="header-anchor">#</a> 停止数据库</h2> <blockquote><p>gpstop</p></blockquote> <p>常用可选参数：</p> <ul><li>-a：直接停止，不提示终端用户输入确认</li> <li>-m：只停止master实例，与<code>gpstart –m</code>对应使用</li> <li>-M fast：停止数据库，中断所有数据库连接，回滚正在运行的事务</li> <li>-u：不停止数据库，只加载pg_hba.conf和postgresql.conf中运行时参数，当改动参数配置时候使用。</li> <li>-f：强制停止数据库</li> <li>-r： 重启数据库</li></ul> <h2 id="重启数据库"><a href="#重启数据库" class="header-anchor">#</a> 重启数据库</h2> <blockquote><p>gpstop -a -M immediate &amp;&amp; gpstart -a &amp;&amp; gpstop -u</p></blockquote> <h2 id="查看实例配置和状态"><a href="#查看实例配置和状态" class="header-anchor">#</a> 查看实例配置和状态</h2> <blockquote><p>select * from gp_segment_configuration order by 1</p></blockquote> <p>主要字段说明：</p> <ul><li>Content：该字段相等的两个实例，是一对Ｐ（primary instance）和Ｍ（mirror            Instance)</li> <li>Isprimary：实例是否作为primary instance运行</li> <li>Valid：实例是否有效，如处于false状态，则说明该实例已经down掉。</li> <li>Port：实例运行的端口</li> <li>Datadir:实例对应的数据目录</li></ul> <h2 id="实例配置的数据表"><a href="#实例配置的数据表" class="header-anchor">#</a> 实例配置的数据表</h2> <p>gp_segment_configuration、pg_filespace_entry、gp_fault_strategy</p> <p>其它常用的系统表：pg_class,pg_attribute,pg_database,pg_tables……</p> <p>可以用tab来匹配表名；</p> <h2 id="显示数据库运行状态"><a href="#显示数据库运行状态" class="header-anchor">#</a> 显示数据库运行状态</h2> <blockquote><p>gpstate 显示Greenplum数据库运行状态、详细配置等信息</p></blockquote> <p>常用可选参数:</p> <ul><li>-c：primary instance 和 mirror instance 的对应关系</li> <li>-m：只列出mirror 实例的状态和配置信息</li> <li>-f：显示standby master 的详细信息</li> <li>-s：查看详细状态，如在同步，可显示数据同步完成百分比</li> <li>--version,查看数据库version，也可使用<code>pg_controldata</code>查看数据库版本和postgresql版本） 该命令默认列出数据库运行状态汇总信息，常用于日常巡检。</li></ul> <h2 id="查看用户会话和查询信息"><a href="#查看用户会话和查询信息" class="header-anchor">#</a> 查看用户会话和查询信息</h2> <blockquote><p>select * from pg_stat_activity</p></blockquote> <p>该表能查看到当前数据库连接的IP 地址，用户名，提交的查询等。另外也可以在master 主机上查看进程，对每个客户端连接，master 都会创建一个进程。<code>ps -ef |grep -i postgres |grep -i con</code></p> <h2 id="杀会话"><a href="#杀会话" class="header-anchor">#</a> 杀会话</h2> <blockquote><p>select pg_cancel_backend(procpid);</p></blockquote> <ul><li>如果无法杀掉则使用</li></ul> <blockquote><p>select pg_terminate_backend(procpid);</p></blockquote> <p>**注意：**很可能不能杀掉会话，此时只能重启数据库了，如果使用<code>kill -9</code>去杀进程也会导致数据库重启。</p> <h2 id="查看表占用空间"><a href="#查看表占用空间" class="header-anchor">#</a> 查看表占用空间</h2> <blockquote><p>select pg_size_pretty(pg_relation_size('schema.tablename'));</p></blockquote> <p>与pg_tables子查询查看所有表的占用空间</p> <blockquote><p>select pg_size_pretty(pg_database_size('databasename));</p></blockquote> <p>**注意：**数据库所对应的存储系统里，建议至少保留30%的自由空间，日常巡检，要检查</p> <p>存储空间的剩余容量。</p> <h2 id="收集统计信息回收空间"><a href="#收集统计信息回收空间" class="header-anchor">#</a> 收集统计信息回收空间</h2> <p>定期使用<code>Vacuum analyze tablename</code>回收垃圾和收集统计信息，尤其在大数据量删除，导入以后，非常重要、需要定期对数据字典做vacuum和reindex ，如pg_class,pg_attribute等系统表。
可以查询<code>gp_toolkit.gp_bloat_diag</code>看膨胀很大的表；</p> <blockquote><p>Alter table可以用来代替vacuum full 回收空间(除了系统表):</p> <p>alter table test set with (reorganize=true);</p></blockquote> <p>每天定期运行以下脚本:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#!/bin/bash
source ~/.bash_profile
DBNAME=&quot;fedw&quot;
SYSTABLES=&quot;' pg_catalog.' || relname || ';' from pg_class a, pg_namespace b \
where a.relnamespace=b.oid and b.nspname='pg_catalog' and a.relkind='r'&quot;
psql -tc &quot;SELECT 'VACUUM' || $SYSTABLES&quot; $DBNAME | psql -a $DBNAME
reindexdb -s -d $DBNAME
analyzedb -a -s pg_catalog -d $DBNAME
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="查看数据分布情况"><a href="#查看数据分布情况" class="header-anchor">#</a> 查看数据分布情况</h2> <p>两种方式</p> <ul><li><p>Select gp_segment_id,count(*) from tablename group by 1</p></li> <li><p>在命令运行：gpskew -t public.ate -a postgres</p></li></ul> <p>如数据分布不均匀，将发挥不了并行计算的优势，严重影响性能。</p> <h2 id="登录每一个实例数据库"><a href="#登录每一个实例数据库" class="header-anchor">#</a> 登录每一个实例数据库</h2> <blockquote><p>PGOPTIONS='-c gp_session_role=utility' psql -ddbname –p xxxx</p></blockquote> <p>可以通过这个命令登录实例，一般用于检测单个实例是否运行正常，还有就是用于在集群发生不一致时（只有在非常特殊的情况下才有可能发生，如表不一致等），进行表维护。</p> <ul><li>进入维护模式，允许修改系统表</li></ul> <blockquote><p>set allow_system_table_mods='dml';</p></blockquote> <h2 id="实例恢复"><a href="#实例恢复" class="header-anchor">#</a> 实例恢复</h2> <blockquote><p>gprecoverseg</p></blockquote> <p>通过<code>gpstate</code>或查询gp_segement_configuration系统表发现有实例down掉以后，使用该命令进行恢复。</p> <ul><li>-F 强制恢复</li> <li>-i XXX 通过XXX文件指定只修复特定的镜像，以加快修复速度。与-o配合使用。</li> <li>-o XXX 生成镜像修复指定配置文件. 与-i配合使用。</li> <li>-a 全量修复镜像。</li> <li>-r 恢复实例角色。</li></ul> <h2 id="查看锁信息"><a href="#查看锁信息" class="header-anchor">#</a> 查看锁信息</h2> <p>注：在Greenplum里（截至到4.0版本），INSERT 和COPY都是行级锁，UPDATE/DELETE都是表级锁；</p> <blockquote><p>SELECT locktype, database, c.relname, l.relation, l.transactionid, l.transaction, l.pid, l.mode, l.granted, a.current_query FROM pg_locks l, pg_class c, pg_stat_activity a WHERE l.relation=c.oid AND l.pid=a.procpid ORDER BY c.relname;</p></blockquote> <p>主要字段说明：</p> <ul><li><p>relname: 表名</p></li> <li><p>locktype、mode 标识了锁的类型</p></li></ul> <p>**注：**也可以通过pgadminIII的工具-&gt;服务器状态查看当前运行的SQL及锁等待情况。</p> <p>发生Deadlock时，系统自动让其中一个SQL失败，并提示deadlock信息。</p> <h2 id="查询执行计划"><a href="#查询执行计划" class="header-anchor">#</a> 查询执行计划</h2> <blockquote><p>explain</p></blockquote> <p>在提交大的查询之前，使用explain分析执行计划、发现潜在优化机会，避免将系统资源熬尽。</p> <blockquote><p>explain analyze  sql</p></blockquote> <p>将执行一次SQL，并行将过程中的具体cost和运行情况记录下来。</p> <p>也可以用pgadminIII进行explain的图形化显示，进而来优化执行路径，如表关联策略等。</p> <p>**注：**可以在Master的postgresql.conf中 修改</p> <p>log_min_duration_statement=5000s，SQL运行耗时超过这个值得都在pg_log纪</p> <p>录SQL的实际耗时，用来监控耗时的SQL。</p> <h2 id="数据库并行备份"><a href="#数据库并行备份" class="header-anchor">#</a> 数据库并行备份</h2> <blockquote><p>gp_dump</p></blockquote> <p>常用参数</p> <ul><li>-s: 只导出对象定义（表结构，函数等）</li> <li>-n: 只导出某个schema</li></ul> <p>gp_dump默认在master的data目录上产生这些文件：</p> <ul><li>gp_catalog_1__ ：关于数据库系统配置的备份文件</li> <li>gp_cdatabase_1__：数据库创建语句的备份文件</li> <li>gp_dump_1__：数据库对象ddl语句</li> <li>gp_dump_status_1__：备份操作的日志</li></ul> <p>在每个segment instance上的data目录上产生的文件：</p> <ul><li>gp_dump_0__：用户数据备份文件</li> <li>gp_dump_status_0__：备份日志</li></ul> <blockquote><p>gpcorndump</p></blockquote> <p>可以用于备份数据库配置文件和全局数据（如角色、资源队列等）</p> <p><strong>Example:</strong></p> <blockquote><p>gpcrondump -x mydatabase  –u  /xxx/  -c -g –G –a –q &gt;&gt;$DATE.log</p></blockquote> <ul><li>-g 备份postgresql.conf、pg_hba.conf、pg_ident.conf</li> <li>-G  备份全局对象</li> <li>-u  备份到的目录(如果没有-u，则数据备份到每个数据目录里面)</li></ul> <p>gpcrondump的文件可以用<code>gp_restore</code>恢复</p> <blockquote><p>gp_restore --gp-c --gp-d=/data/backup/db_dumps/20110423/ --gp-k=20110423103328  -d gpadmin</p></blockquote> <p>也可以用<code>gpdbresotre</code>恢复：(需要数据在一个Host上)</p> <blockquote><p>gpdbrestoree  -R master=/data/backup/db_dumps/20110423</p> <p>-T 可以只恢复其中的某表（比gp_dump多这个参数）</p> <p>gpdbrestore -t 20120229182541 -T public.account</p></blockquote> <h2 id="数据库恢复"><a href="#数据库恢复" class="header-anchor">#</a> 数据库恢复</h2> <blockquote><p>gp_restore</p></blockquote> <p>必选参数</p> <ul><li>--gp-k=key ：key 为gp_dump 导出来的文件的后缀时间戳</li> <li>-d dbname  ：将备份文件恢复到dbname</li></ul> <h2 id="串行备份"><a href="#串行备份" class="header-anchor">#</a> 串行备份</h2> <blockquote><p>pg_dump/pg_dumpall</p></blockquote> <p>一般用于环境迁移和DDL、FUNCTION等备份；</p> <p><strong>如：</strong></p> <blockquote><p>pg_dump  -s  -n public  demodb –f  demodb.sql</p></blockquote> <p>将只备份demodb数据库中的public下的所有DDL和FUNCTION，-s表示不备份数据；
恢复时，使用</p> <blockquote><p>psql  -d demodb –f  demodb.sql</p></blockquote> <h2 id="数据库僵尸进程处理"><a href="#数据库僵尸进程处理" class="header-anchor">#</a> 数据库僵尸进程处理</h2> <p>首先使用kill -15 去停止进程，kill -15不响应，再用kill -11;一般情况下，不要用kill -9，否则可能导致数据库宕机且状态不一致，严重的导致数据库不能重新启动，可能需要用pg_resetxlog去重置日志，有可能导致数据丢失；</p> <h2 id="参数更改"><a href="#参数更改" class="header-anchor">#</a> 参数更改</h2> <p>通过gpconfig配置Master和所有Segment的postgresql.conf中参数。</p> <blockquote><p>gpconfig -c work_mem -v 120MB –masteronly</p></blockquote> <ul><li>修改master上的work_mem =120MB</li></ul> <blockquote><p>gpconfig -c max_connections -v 100 -m 10</p></blockquote> <ul><li>修改Master上max_connections=10，Segment上修改成100</li></ul> <blockquote><p>gpconfig -r default_statistics_target</p></blockquote> <ul><li>注释参数，使用缺省参数</li></ul> <blockquote><p>gpconfig –l 列出所有的参数
gpconfig -s max_connections     显示某个参数</p></blockquote> <h2 id="其它常用命令"><a href="#其它常用命令" class="header-anchor">#</a> 其它常用命令</h2> <blockquote><p>gpssh  -f  all_hosts</p></blockquote> <ul><li>通过SSH同时访问多个节点，并可同时执行shell</li></ul> <blockquote><p>gpcheckperf</p></blockquote> <ul><li>检查网络和硬盘性能</li></ul> <blockquote><p>checkos  -f all_hosts</p></blockquote> <ul><li>检查OS内核和参数</li></ul> <p>检查Disk性能：</p> <p><code>gpcheckperf -d /data/gpdb_p1 -d /data/gpdb_p2 -d /data/gpdb_p3 -d /data/gpdb_p4 -d /data/gpdb_p5 -d /data/gpdb_p6 -d /data/gpdb_p7 -d /data/gpdb_p8 -S 64GB -r ds -D -v -f hosts-setup</code></p> <p>检查网络性能：</p> <p><code>gpcheckperf -d /data/gpdb_p1 -r N -f hosts-net0 gpcheckperf -d /data/gpdb_p1 -r N -f hosts-net1 gpcheckperf -d /data/gpdb_p1 -r N -f hosts-net2 gpcheckperf -d /data/gpdb_p1 -r N -f hosts-net3</code></p> <h2 id="导出导入数据文件"><a href="#导出导入数据文件" class="header-anchor">#</a> 导出导入数据文件</h2> <blockquote><p>COPY public.ods_data_msg TO '/zte/gpdata/ocs_data_msg.txt' delimiter'|';</p></blockquote> <blockquote><p>COPY public.ods_data_msg from  '/zte/gpdata/ocs_data_msg.txt' WITH delimiter'|';</p></blockquote> <h2 id="进程监控"><a href="#进程监控" class="header-anchor">#</a> 进程监控</h2> <p>select * from pg_stat_activity  where waiting ='t' ORDER BY current_query;    select * from pg_stat_activity  where waiting ='t' ORDER BY sess_id;</p> <p>select * from pg_stat_activity  where waiting ='f' ORDER BY current_query;    select * from pg_stat_activity  where waiting ='f' ORDER BY sess_id;</p> <h2 id="添加默认分区"><a href="#添加默认分区" class="header-anchor">#</a> 添加默认分区</h2> <p>ALTER TABLE INF.EVENT_TGPS_201307 ADD default PARTITION   PDEFAULT</p> <h2 id="导出对象"><a href="#导出对象" class="header-anchor">#</a> 导出对象</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>pg_dump  -h <span class="token number">136.6</span>.160.196 -p <span class="token number">5432</span> -U dsj -n dsj -s -T dsj.hot_contents_user_20130710 -T dsj.tbd_bwt_evt_pd_lo_evt_20130709 --gp-syntax cqdsj <span class="token operator">&gt;</span> db.sql   
pg_dump  -h <span class="token number">136.6</span>.160.196 -p <span class="token number">5432</span> -U gpadmin  -n public -s  --gp-syntax xdcx <span class="token operator">&gt;</span> xdcx_public.sql  
pg_dump  -h <span class="token number">136.6</span>.160.196 -p <span class="token number">5432</span> -U gpadmin  -n inf -s  --gp-syntax xdcx <span class="token operator">&gt;</span> xdcx_inf.sql  
pg_dump  -h <span class="token number">136.6</span>.160.196 -p <span class="token number">5432</span> -U gpadmin  -n mid -s  --gp-syntax xdcx <span class="token operator">&gt;</span> xdcx_mid.sql    
pg_dump  -h <span class="token number">136.6</span>.160.196 -p <span class="token number">5432</span> -U inf -n public -s  --gp-syntax xdcx <span class="token operator">&gt;</span> xdcx_public.sql    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="表的字段"><a href="#表的字段" class="header-anchor">#</a> 表的字段</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> PG_ATTRIBUTE  <span class="token keyword">WHERE</span> ATTRELID <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span>  RELFILENODE <span class="token keyword">FROM</span> PG_CLASS  <span class="token keyword">WHERE</span> UPPER<span class="token punctuation">(</span>RELNAME<span class="token punctuation">)</span><span class="token operator">=</span>UPPER<span class="token punctuation">(</span><span class="token string">'DS_EVT_CALL_AREA_201312'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">and</span> attstattarget<span class="token operator">=</span><span class="token string">'-1'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> attnum<span class="token punctuation">;</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="查看建表语句"><a href="#查看建表语句" class="header-anchor">#</a> 查看建表语句</h2> <blockquote><p>pg_dump -U your_db_user_name your_database -t your_table_name --schema-only</p></blockquote> <h2 id="新建用户"><a href="#新建用户" class="header-anchor">#</a> 新建用户</h2> <p>基本权限：usage on schema，select on table，需要这两者都有才可以。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> ROLE cqcis LOGIN 
  ENCRYPTED PASSWORD <span class="token string">'md5265eb7390afca3acc1f251fe55e63c00'</span> 
  NOSUPERUSER INHERIT NOCREATEDB NOCREATEROLE RESOURCE QUEUE pg_default<span class="token punctuation">;</span> 
<span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> inf <span class="token keyword">TO</span> cqcis<span class="token punctuation">;</span> <span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> mid <span class="token keyword">TO</span> cqcis<span class="token punctuation">;</span> <span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> <span class="token keyword">public</span> <span class="token keyword">TO</span> cqcis<span class="token punctuation">;</span>  
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> tmp<span class="token punctuation">.</span>test <span class="token keyword">to</span> cqcis<span class="token punctuation">;</span>
新的版本中可以让某个角色自动拥有新增表的权限，老版本不支持。
<span class="token keyword">ALTER</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">PRIVILEGES</span> <span class="token operator">IN</span> <span class="token keyword">SCHEMA</span> myschema <span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLES</span> <span class="token keyword">TO</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="生成授权语句"><a href="#生成授权语句" class="header-anchor">#</a> 生成授权语句</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token string">'grant select on '</span><span class="token operator">||</span>relname<span class="token operator">||</span><span class="token string">' to 用户名;'</span> <span class="token keyword">from</span> pg_class a<span class="token punctuation">,</span>pg_namespace b <span class="token keyword">where</span> relname <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'%prt%'</span> <span class="token operator">and</span> relkind <span class="token operator">=</span><span class="token string">'r'</span> <span class="token operator">and</span> has_table_privilege<span class="token punctuation">(</span><span class="token string">'用户名'</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span>oid<span class="token punctuation">,</span><span class="token string">'select'</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'f'</span> <span class="token operator">and</span> a<span class="token punctuation">.</span>relnamespace<span class="token operator">=</span>b<span class="token punctuation">.</span>oid <span class="token operator">and</span> nspname <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'pg_catalog'</span><span class="token punctuation">,</span><span class="token string">'information_schema'</span><span class="token punctuation">,</span><span class="token string">'gp_toolkit'</span><span class="token punctuation">)</span> <span class="token operator">and</span> nspname <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'%pg_temp%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="导出用户信息"><a href="#导出用户信息" class="header-anchor">#</a> 导出用户信息</h2> <blockquote><p>pg_dumpall --roles-only</p></blockquote> <h2 id="模式管理"><a href="#模式管理" class="header-anchor">#</a> 模式管理</h2> <p>查询当前可以直接访问的模式</p> <blockquote><p>SHOW search_path;</p></blockquote> <p>设置当前可以直接访问的模式：</p> <ul><li>SET search_path TO  temp,cqdmkt,public;---session级</li> <li>alter database cqdmkt_new  SET search_path TO  temp,cqdmkt,public;---database级</li></ul> <p>第一个模式为默认模式，即在新建表或者函数式，不加模式名的情况，都默认到第一个模式下。</p> <h2 id="表的字段名称及注释的系统表查询"><a href="#表的字段名称及注释的系统表查询" class="header-anchor">#</a> 表的字段名称及注释的系统表查询</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>  
a<span class="token punctuation">.</span>nspname <span class="token keyword">AS</span> schemaname <span class="token punctuation">,</span>b<span class="token punctuation">.</span>relname <span class="token keyword">AS</span> tablename <span class="token punctuation">,</span>d<span class="token punctuation">.</span>attnum                            <span class="token keyword">AS</span> columnid <span class="token punctuation">,</span>d<span class="token punctuation">.</span>attname <span class="token keyword">AS</span> columnname <span class="token punctuation">,</span>FORMAT_TYPE<span class="token punctuation">(</span>d<span class="token punctuation">.</span>atttypid<span class="token punctuation">,</span>d<span class="token punctuation">.</span>atttypmod<span class="token punctuation">)</span>  <span class="token keyword">AS</span> columntype <span class="token punctuation">,</span>e<span class="token punctuation">.</span>description <span class="token keyword">FROM</span> pg_catalog<span class="token punctuation">.</span>pg_namespace a  
<span class="token keyword">JOIN</span> pg_catalog<span class="token punctuation">.</span>pg_class b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>oid<span class="token operator">=</span>b<span class="token punctuation">.</span>relnamespace <span class="token operator">AND</span> b<span class="token punctuation">.</span>relkind<span class="token operator">=</span><span class="token string">'r'</span> <span class="token keyword">JOIN</span> pg_catalog<span class="token punctuation">.</span>pg_attribute d  <span class="token keyword">ON</span> b<span class="token punctuation">.</span>oid<span class="token operator">=</span>d<span class="token punctuation">.</span>attrelid <span class="token operator">AND</span> d<span class="token punctuation">.</span>attnum<span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>  pg_catalog<span class="token punctuation">.</span>pg_description e   <span class="token keyword">ON</span> b<span class="token punctuation">.</span>oid<span class="token operator">=</span>e<span class="token punctuation">.</span>objoid  <span class="token operator">AND</span> b<span class="token punctuation">.</span>tableoid<span class="token operator">=</span>e<span class="token punctuation">.</span>classoid  <span class="token operator">AND</span> d<span class="token punctuation">.</span>attnum<span class="token operator">=</span>e<span class="token punctuation">.</span>objsubid    
<span class="token keyword">where</span>  a<span class="token punctuation">.</span>nspname<span class="token operator">=</span>  <span class="token string">'cqdmkt'</span> <span class="token comment">--write your schema_name  </span>
 <span class="token operator">and</span> b<span class="token punctuation">.</span>relname<span class="token operator">=</span>   <span class="token string">'wid_chn_prd_serv_mkt_day'</span>     <span class="token comment">--write your table_name  ; </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="greenplum升级和扩容"><a href="#greenplum升级和扩容" class="header-anchor">#</a> Greenplum升级和扩容</h2> <ul><li><p>Upgrade</p> <blockquote><p>--小版本升级：4.0.4 —&gt; 4.0.5  替换/usr/local/greenplum-db即可  --大版本升级：3.3.7 —&gt; 4.0.4 $gpmigrator</p></blockquote></li> <li><p>扩容</p> <blockquote><p>$gpexpand</p></blockquote> <ul><li>生成扩容文件</li></ul> <blockquote><p>gpexpand -f hosts -D mydw</p></blockquote> <ul><li>执行扩容</li></ul> <blockquote><p>gpexpand -i gpexpand_inputfile_20161202_183705 -D mydw -n 8</p></blockquote></li></ul> <h2 id="gpfdist外部表"><a href="#gpfdist外部表" class="header-anchor">#</a> gpfdist外部表</h2> <p>建表SQL：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> test_ext <span class="token punctuation">(</span> 
  id <span class="token keyword">integer</span><span class="token punctuation">,</span>   name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   dt <span class="token keyword">date</span> <span class="token punctuation">)</span> 
LOCATION <span class="token punctuation">(</span><span class="token string">'gpfdist://master:8081/test.txt'</span><span class="token punctuation">)</span>  FORMAT <span class="token string">'text'</span> <span class="token punctuation">(</span><span class="token keyword">delimiter</span> <span class="token string">','</span> <span class="token boolean">null</span> <span class="token string">'\\N'</span> <span class="token keyword">escape</span> <span class="token string">'\\'</span><span class="token punctuation">)</span>  ENCODING <span class="token string">'gb18030'</span> 
LOG <span class="token keyword">ERRORS</span> <span class="token keyword">INTO</span> error_table SEGMENT REJECT <span class="token keyword">LIMIT</span> <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动gpfdist：</p> <blockquote><p>nohup gpfdist -d /tmp/ -p 8081 &amp;</p></blockquote> <h2 id="使用vacuum-full回收垃圾的建议操作流程"><a href="#使用vacuum-full回收垃圾的建议操作流程" class="header-anchor">#</a> 使用vacuum full回收垃圾的建议操作流程</h2> <ol><li>录下表的索引定义</li> <li>除索引</li> <li>acuum full 表</li> <li>行重建索引</li></ol> <h2 id="关闭orca"><a href="#关闭orca" class="header-anchor">#</a> 关闭ORCA</h2> <ul><li>set optimizer=off;</li> <li>gpconfig -c optimizer -v off</li></ul> <h2 id="gplogfilter"><a href="#gplogfilter" class="header-anchor">#</a> gplogfilter</h2> <ul><li>最近1天错误日志 - <code>gplogfilter -t -n 1</code></li> <li>最近5分钟错误日志 - <code>gplogfilter -d :10</code></li> <li>包含特定字符 - <code>gplogfilter -f '|con1 cmd22|'</code></li> <li>某时间段内的ERROR - <code>gplogfilter -b '2011-01-01 01:01:11' -e '2011-01-01 02:00:00' -c i -f ERROR</code></li> <li>搜索所有csv - <code>gplogfilter -b '2011-01-01 01:01:11' -e '2011-01-01 02:00:00' /data/*/pg_log/gpdb-2011-01-*.csv</code></li></ul></div></div> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E6%89%8B%E5%86%8C" title="标签">
      #手册
    </a></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/07/10, 18:07:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/441817/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">
        Greenplum架构介绍
      </div></a> <a href="/pages/84a443/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">
        监控指标
      </div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/441817/" class="prev">Greenplum架构介绍</a></span> <span class="next"><a href="/pages/84a443/">监控指标</a>
        →
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/fe6a06/"><div>分区维护</div></a> <span>11-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ca2bd6/"><div>验证write ahead是否有效</div></a> <span>10-16</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/64607c/"><div>使用undrop-for-innodb恢复数据</div></a> <span>09-25</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> </main></div> <div class="footer"><div class="icons"><a href="mailto:583675636@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
     | Copyright © 2020-2020
    <span>yong.wei | <a href="" target="_blank"></a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b45ba360.js" defer></script><script src="/assets/js/2.6eac6864.js" defer></script><script src="/assets/js/3.a88a92d5.js" defer></script><script src="/assets/js/39.7f29c316.js" defer></script>
  </body>
</html>
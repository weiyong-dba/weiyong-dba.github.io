(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{437:function(s,t,a){"use strict";a.r(t);var e=a(51),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"greenplum监控指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#greenplum监控指标"}},[s._v("#")]),s._v(" Greenplum监控指标")]),s._v(" "),a("h2",{attrs:{id:"端口监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口监控"}},[s._v("#")]),s._v(" 端口监控")]),s._v(" "),a("p",[s._v("监控5432端口存活情况")]),s._v(" "),a("h2",{attrs:{id:"segment监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#segment监控"}},[s._v("#")]),s._v(" Segment监控")]),s._v(" "),a("p",[s._v("通过查询gp_segment_configuration监控segment的运行情况。")]),s._v(" "),a("ul",[a("li",[s._v("角色切换")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT * FROM gp_segment_configuration WHERE status <> 'u' or   mode = 'c' or mode = 'r' or  preferred_role <> role;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("节点DOWN")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT * FROM gp_segment_configuration WHERE status <> 'u';\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("change tracking mode")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT * FROM gp_segment_configuration WHERE mode = 'c';\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("re-synched")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT * FROM gp_segment_configuration WHERE mode = 'r';\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("检查数据分布")])]),s._v(" "),a("blockquote",[a("p",[s._v("SELECT gp_segment_id, count(*) FROM gp_dist_random('pg_class') GROUP BY 1;")])]),s._v(" "),a("p",[s._v("查看数据分布，说明部分seg有硬件或者网络问题")]),s._v(" "),a("ul",[a("li",[s._v("检查master与standby同步情况")])]),s._v(" "),a("blockquote",[a("p",[s._v("SELECT procpid, state FROM pg_stat_replication;")])]),s._v(" "),a("h2",{attrs:{id:"gpcheck"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gpcheck"}},[s._v("#")]),s._v(" gpcheck")]),s._v(" "),a("ul",[a("li",[s._v("gpcheckperf")]),s._v(" "),a("li",[s._v("gpcheckcat -O")]),s._v(" "),a("li",[s._v("gpcheckcat -R persistent postgres")]),s._v(" "),a("li",[s._v("gpcheckcat -R pgclass tenddata")]),s._v(" "),a("li",[s._v("gpcheckcat -R namespace")]),s._v(" "),a("li",[s._v("gpcheckcat -R distribution_policy")]),s._v(" "),a("li",[s._v("gpcheckcat -R dependency")])]),s._v(" "),a("h2",{attrs:{id:"丢失统计信息的表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#丢失统计信息的表"}},[s._v("#")]),s._v(" 丢失统计信息的表")]),s._v(" "),a("blockquote",[a("p",[s._v("SELECT * FROM gp_toolkit.gp_stats_missing;")])]),s._v(" "),a("p",[s._v("如何处理？")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("analyze\nanalyzedb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"表碎片"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表碎片"}},[s._v("#")]),s._v(" 表碎片")]),s._v(" "),a("blockquote",[a("p",[s._v("SELECT * FROM gp_toolkit.gp_bloat_diag;")])]),s._v(" "),a("p",[s._v("处理")]),s._v(" "),a("blockquote",[a("p",[s._v("VACUUM FULL")])]),s._v(" "),a("h2",{attrs:{id:"查看日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看日志"}},[s._v("#")]),s._v(" 查看日志")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('awk -F "," \'{print $12" "$13}\' postgresql-2014-02*.csv |grep -E\n"WARNING|ERROR|FATAL|PANIC"|sort|uniq -c|sort –rn\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"数据库连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库连接"}},[s._v("#")]),s._v(" 数据库连接")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" -name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*.csv"')]),s._v(" -type f -mtime -28 -exec "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"connection\nauthorized"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" +"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(","),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v(","),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$5")]),s._v("}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/\\:[0-\n9]*//g'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -n -r\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);
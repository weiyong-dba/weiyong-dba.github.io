<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Centos7下安装scylladb集群 | 韦勇的博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="DBA，程序员，专注于IT互联网，大数据，包括但不限于数据库、Python等。">
    <meta name="keywords" content="DBA博客,个人技术博客,数据库,前端开发,前端框架,web前端,技术文档,学习,mysql,redis,mongodb,postgresql,greenplum,aerospike,scylladb,vertica,Python,JavaScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.c231a23d.css" as="style"><link rel="preload" href="/assets/js/app.b45ba360.js" as="script"><link rel="preload" href="/assets/js/2.6eac6864.js" as="script"><link rel="preload" href="/assets/js/3.a88a92d5.js" as="script"><link rel="preload" href="/assets/js/42.92fd262d.js" as="script"><link rel="prefetch" href="/assets/js/10.9ac750bc.js"><link rel="prefetch" href="/assets/js/11.d59f0158.js"><link rel="prefetch" href="/assets/js/12.8cb6333d.js"><link rel="prefetch" href="/assets/js/13.8d09723d.js"><link rel="prefetch" href="/assets/js/14.489067bb.js"><link rel="prefetch" href="/assets/js/15.67863306.js"><link rel="prefetch" href="/assets/js/16.7bf247d8.js"><link rel="prefetch" href="/assets/js/17.121f6b76.js"><link rel="prefetch" href="/assets/js/18.4a67525f.js"><link rel="prefetch" href="/assets/js/19.99a721fb.js"><link rel="prefetch" href="/assets/js/20.4d4ffe62.js"><link rel="prefetch" href="/assets/js/21.988d351d.js"><link rel="prefetch" href="/assets/js/22.1e452d5b.js"><link rel="prefetch" href="/assets/js/23.705c804a.js"><link rel="prefetch" href="/assets/js/24.4160caef.js"><link rel="prefetch" href="/assets/js/25.c0cead69.js"><link rel="prefetch" href="/assets/js/26.8474fcb9.js"><link rel="prefetch" href="/assets/js/27.68577f4d.js"><link rel="prefetch" href="/assets/js/28.76404f22.js"><link rel="prefetch" href="/assets/js/29.29ebfa2e.js"><link rel="prefetch" href="/assets/js/30.42cb86c5.js"><link rel="prefetch" href="/assets/js/31.e9a9f49e.js"><link rel="prefetch" href="/assets/js/32.a1c8cda8.js"><link rel="prefetch" href="/assets/js/33.de67351d.js"><link rel="prefetch" href="/assets/js/34.72daac17.js"><link rel="prefetch" href="/assets/js/35.0d28f4f7.js"><link rel="prefetch" href="/assets/js/36.f50a6e95.js"><link rel="prefetch" href="/assets/js/37.0cb9802c.js"><link rel="prefetch" href="/assets/js/38.14a9b8c9.js"><link rel="prefetch" href="/assets/js/39.7f29c316.js"><link rel="prefetch" href="/assets/js/4.c2705a33.js"><link rel="prefetch" href="/assets/js/40.4bd4ac79.js"><link rel="prefetch" href="/assets/js/41.beb899d2.js"><link rel="prefetch" href="/assets/js/43.f93ed735.js"><link rel="prefetch" href="/assets/js/44.37e9f48e.js"><link rel="prefetch" href="/assets/js/45.171bf2c1.js"><link rel="prefetch" href="/assets/js/46.ab0fa104.js"><link rel="prefetch" href="/assets/js/47.2bd4da2a.js"><link rel="prefetch" href="/assets/js/48.6f1ece74.js"><link rel="prefetch" href="/assets/js/49.7ee1a812.js"><link rel="prefetch" href="/assets/js/5.4c01046b.js"><link rel="prefetch" href="/assets/js/50.4ea52293.js"><link rel="prefetch" href="/assets/js/51.b5737a73.js"><link rel="prefetch" href="/assets/js/52.a8911a99.js"><link rel="prefetch" href="/assets/js/53.562b75b3.js"><link rel="prefetch" href="/assets/js/54.43b31295.js"><link rel="prefetch" href="/assets/js/55.722f0ac0.js"><link rel="prefetch" href="/assets/js/56.dd56fc0d.js"><link rel="prefetch" href="/assets/js/57.51f8e820.js"><link rel="prefetch" href="/assets/js/58.a6751fea.js"><link rel="prefetch" href="/assets/js/59.5b67abf1.js"><link rel="prefetch" href="/assets/js/6.38f9d1c7.js"><link rel="prefetch" href="/assets/js/60.40b9f1c0.js"><link rel="prefetch" href="/assets/js/61.cf3bc22e.js"><link rel="prefetch" href="/assets/js/62.ee744d9e.js"><link rel="prefetch" href="/assets/js/63.ecae0239.js"><link rel="prefetch" href="/assets/js/64.2e99c3e7.js"><link rel="prefetch" href="/assets/js/65.b3515acb.js"><link rel="prefetch" href="/assets/js/66.0c5c25c6.js"><link rel="prefetch" href="/assets/js/67.b90820e6.js"><link rel="prefetch" href="/assets/js/68.9d0729eb.js"><link rel="prefetch" href="/assets/js/69.751b150c.js"><link rel="prefetch" href="/assets/js/7.e34b3bc8.js"><link rel="prefetch" href="/assets/js/70.67171620.js"><link rel="prefetch" href="/assets/js/71.59324e4a.js"><link rel="prefetch" href="/assets/js/72.d931ea49.js"><link rel="prefetch" href="/assets/js/73.82b3b67b.js"><link rel="prefetch" href="/assets/js/74.55622a29.js"><link rel="prefetch" href="/assets/js/75.4130e842.js"><link rel="prefetch" href="/assets/js/76.c5f76e21.js"><link rel="prefetch" href="/assets/js/8.d51727c6.js"><link rel="prefetch" href="/assets/js/9.44347f46.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c231a23d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">韦勇的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系统" class="dropdown-title"><a href="/system/" class="link-title">系统</a> <span class="title" style="display:none;">系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>系统文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/654590/" class="nav-link">Linux维护手册</a></li><li class="dropdown-subitem"><a href="/pages/85d59c/" class="nav-link">使用iotune测试磁盘读写</a></li><li class="dropdown-subitem"><a href="/pages/45c411/" class="nav-link">源码编译gcc</a></li><li class="dropdown-subitem"><a href="/pages/187f4d/" class="nav-link">YCSB压测</a></li><li class="dropdown-subitem"><a href="/pages/ca2bd6/" class="nav-link">write ahead</a></li></ul></li><li class="dropdown-item"><h4>编程开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">编程开发</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><a href="/mysql/" class="link-title">MySQL</a> <span class="title" style="display:none;">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a6ac55/" class="nav-link">部署</a></li></ul></li><li class="dropdown-item"><h4>HA</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c78f1b/" class="nav-link">HA选型</a></li><li class="dropdown-subitem"><a href="/pages/0439fa/" class="nav-link">MGR</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a0df55/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>笔记文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ee31c0/" class="nav-link">MySQL8新特性</a></li><li class="dropdown-subitem"><a href="/pages/08b679/" class="nav-link">SQL优化</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PostgreSQL" class="dropdown-title"><a href="/postgresql/" class="link-title">PostgreSQL</a> <span class="title" style="display:none;">PostgreSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/859ac7/" class="nav-link">部署</a></li><li class="dropdown-subitem"><a href="/pages/2373b5/" class="nav-link">运维手册</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/96963a/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>源码开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ddbfb5/" class="nav-link">统计SQL执行耗时分位</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/distributed/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Greenplum</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/441817/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/4bb09b/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/84a443/" class="nav-link">监控指标</a></li></ul></li><li class="dropdown-item"><h4>Scylladb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2cae68/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/342275/" aria-current="page" class="nav-link router-link-exact-active router-link-active">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/95d8cc/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/e27c40/" class="nav-link">数据迁移</a></li><li class="dropdown-subitem"><a href="/pages/cf45d3/" class="nav-link">监控部署</a></li></ul></li><li class="dropdown-item"><h4>Aerospike</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd9ddc/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/80ee1a/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/9ba431/" class="nav-link">管理手册</a></li><li class="dropdown-subitem"><a href="/pages/76e199/" class="nav-link">ACT测试</a></li><li class="dropdown-subitem"><a href="/pages/4131aa/" class="nav-link">源码编译</a></li><li class="dropdown-subitem"><a href="/pages/75d8ce/" class="nav-link">数据加载</a></li></ul></li><li class="dropdown-item"><h4>Vertica</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b023ab/" class="nav-link">安装部署</a></li></ul></li><li class="dropdown-item"><h4>Tidb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a52d49/" class="nav-link">数据迁移</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NoSQL" class="dropdown-title"><a href="/nosql/" class="link-title">NoSQL</a> <span class="title" style="display:none;">NoSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b9b610/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/5cdb24/" class="nav-link">性能测试</a></li><li class="dropdown-subitem"><a href="/pages/52f09b/" class="nav-link">运维手册</a></li><li class="dropdown-subitem"><a href="/pages/855952/" class="nav-link">安全加固</a></li><li class="dropdown-subitem"><a href="/pages/fea0b7/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" class="nav-link">新特性</a></li></ul></li><li class="dropdown-item"><h4>MongoDB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/61caf7/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/e25894/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/7de6de/" class="nav-link">运维手册</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程开发" class="dropdown-title"><a href="/dev/" class="link-title">编程开发</a> <span class="title" style="display:none;">编程开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c77a4b/" class="nav-link">开发笔记</a></li><li class="dropdown-subitem"><a href="/pages/8503e3/" class="nav-link">安装笔记</a></li><li class="dropdown-subitem"><a href="/pages/6ec23d/" class="nav-link">sqlalchemy</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/23f6e2/" class="nav-link">开发笔记</a></li></ul></li><li class="dropdown-item"><h4>Shell</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">安装部署</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/weiyong.jpeg"> <div class="blogger-info"><h3>yong.wei</h3> <span>
        数据库小学生
      </span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系统" class="dropdown-title"><a href="/system/" class="link-title">系统</a> <span class="title" style="display:none;">系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>系统文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/654590/" class="nav-link">Linux维护手册</a></li><li class="dropdown-subitem"><a href="/pages/85d59c/" class="nav-link">使用iotune测试磁盘读写</a></li><li class="dropdown-subitem"><a href="/pages/45c411/" class="nav-link">源码编译gcc</a></li><li class="dropdown-subitem"><a href="/pages/187f4d/" class="nav-link">YCSB压测</a></li><li class="dropdown-subitem"><a href="/pages/ca2bd6/" class="nav-link">write ahead</a></li></ul></li><li class="dropdown-item"><h4>编程开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">编程开发</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><a href="/mysql/" class="link-title">MySQL</a> <span class="title" style="display:none;">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a6ac55/" class="nav-link">部署</a></li></ul></li><li class="dropdown-item"><h4>HA</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c78f1b/" class="nav-link">HA选型</a></li><li class="dropdown-subitem"><a href="/pages/0439fa/" class="nav-link">MGR</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a0df55/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>笔记文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ee31c0/" class="nav-link">MySQL8新特性</a></li><li class="dropdown-subitem"><a href="/pages/08b679/" class="nav-link">SQL优化</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PostgreSQL" class="dropdown-title"><a href="/postgresql/" class="link-title">PostgreSQL</a> <span class="title" style="display:none;">PostgreSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/859ac7/" class="nav-link">部署</a></li><li class="dropdown-subitem"><a href="/pages/2373b5/" class="nav-link">运维手册</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/96963a/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>源码开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ddbfb5/" class="nav-link">统计SQL执行耗时分位</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/distributed/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Greenplum</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/441817/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/4bb09b/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/84a443/" class="nav-link">监控指标</a></li></ul></li><li class="dropdown-item"><h4>Scylladb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2cae68/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/342275/" aria-current="page" class="nav-link router-link-exact-active router-link-active">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/95d8cc/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/e27c40/" class="nav-link">数据迁移</a></li><li class="dropdown-subitem"><a href="/pages/cf45d3/" class="nav-link">监控部署</a></li></ul></li><li class="dropdown-item"><h4>Aerospike</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd9ddc/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/80ee1a/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/9ba431/" class="nav-link">管理手册</a></li><li class="dropdown-subitem"><a href="/pages/76e199/" class="nav-link">ACT测试</a></li><li class="dropdown-subitem"><a href="/pages/4131aa/" class="nav-link">源码编译</a></li><li class="dropdown-subitem"><a href="/pages/75d8ce/" class="nav-link">数据加载</a></li></ul></li><li class="dropdown-item"><h4>Vertica</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b023ab/" class="nav-link">安装部署</a></li></ul></li><li class="dropdown-item"><h4>Tidb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a52d49/" class="nav-link">数据迁移</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NoSQL" class="dropdown-title"><a href="/nosql/" class="link-title">NoSQL</a> <span class="title" style="display:none;">NoSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b9b610/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/5cdb24/" class="nav-link">性能测试</a></li><li class="dropdown-subitem"><a href="/pages/52f09b/" class="nav-link">运维手册</a></li><li class="dropdown-subitem"><a href="/pages/855952/" class="nav-link">安全加固</a></li><li class="dropdown-subitem"><a href="/pages/fea0b7/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" class="nav-link">新特性</a></li></ul></li><li class="dropdown-item"><h4>MongoDB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/61caf7/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/e25894/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/7de6de/" class="nav-link">运维手册</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程开发" class="dropdown-title"><a href="/dev/" class="link-title">编程开发</a> <span class="title" style="display:none;">编程开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c77a4b/" class="nav-link">开发笔记</a></li><li class="dropdown-subitem"><a href="/pages/8503e3/" class="nav-link">安装笔记</a></li><li class="dropdown-subitem"><a href="/pages/6ec23d/" class="nav-link">sqlalchemy</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/23f6e2/" class="nav-link">开发笔记</a></li></ul></li><li class="dropdown-item"><h4>Shell</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">安装部署</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Greenplum</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ScyllaDB</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/342275/" aria-current="page" class="active sidebar-link">HA部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/342275/#常用网址" class="sidebar-link">常用网址</a></li><li class="sidebar-sub-header"><a href="/pages/342275/#硬件需求" class="sidebar-link">硬件需求</a></li><li class="sidebar-sub-header"><a href="/pages/342275/#安装scylladb" class="sidebar-link">安装scylladb</a></li><li class="sidebar-sub-header"><a href="/pages/342275/#配置scylla" class="sidebar-link">配置scylla</a></li><li class="sidebar-sub-header"><a href="/pages/342275/#安装scylladb监控" class="sidebar-link">安装scylladb监控</a></li><li class="sidebar-sub-header"><a href="/pages/342275/#压测" class="sidebar-link">压测</a></li><li class="sidebar-sub-header"><a href="/pages/342275/#安装scylla-manager" class="sidebar-link">安装scylla-manager</a></li><li class="sidebar-sub-header"><a href="/pages/342275/#scylla连接池配置" class="sidebar-link">scylla连接池配置</a></li></ul></li><li><a href="/pages/2cae68/" class="sidebar-link">Seastar架构介绍(一)</a></li><li><a href="/pages/314365/" class="sidebar-link">Seastar架构介绍(二)</a></li><li><a href="/pages/95d8cc/" class="sidebar-link">运维手册</a></li><li><a href="/pages/e27c40/" class="sidebar-link">数据迁移</a></li><li><a href="/pages/cf45d3/" class="sidebar-link">监控部署</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Aerospike</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vertica</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TiDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-f6108aee><div class="articleInfo" data-v-f6108aee><ul class="breadcrumbs" data-v-f6108aee><li data-v-f6108aee><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-f6108aee></a></li> <li data-v-f6108aee><a href="/distributed" title="分布式-目录页" data-v-f6108aee>分布式</a></li> <li data-v-f6108aee><a href="/distributed/#ScyllaDB" title="分布式#ScyllaDB" data-v-f6108aee>ScyllaDB</a></li></ul> <div class="info" data-v-f6108aee><div title="作者" class="author iconfont icon-touxiang" data-v-f6108aee><a href="javascript:;" data-v-f6108aee>yong.wei</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-f6108aee><a href="javascript:;" data-v-f6108aee>2020-09-25</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          Centos7下安装scylladb集群
        </h1> <div class="theme-vdoing-content content__default"><h1 id="scylladb高可用部署"><a href="#scylladb高可用部署" class="header-anchor">#</a> ScyllaDB高可用部署</h1> <h2 id="常用网址"><a href="#常用网址" class="header-anchor">#</a> 常用网址</h2> <ul><li>官方网址
https://www.scylladb.com</li> <li>Github
https://github.com/scylladb</li> <li>Google user list
https://groups.google.com/forum/#!forum/scylladb-users</li> <li>Scylladb dev list
https://groups.google.com/forum/#!forum/scylladb-dev</li> <li>Seastar dev list
https://groups.google.com/forum/#!forum/seastar-dev</li> <li>Kairosdb group list
https://groups.google.com/forum/#!forum/kairosdb-group</li></ul> <h2 id="硬件需求"><a href="#硬件需求" class="header-anchor">#</a> 硬件需求</h2> <table><thead><tr><th>Installation</th> <th>Cores</th> <th>Memory</th> <th>Disk</th> <th>Network</th></tr></thead> <tbody><tr><td>Test, minimal</td> <td>4</td> <td>2 GB</td> <td>Single plain SSD</td> <td>1 Gbps</td></tr> <tr><td>Production</td> <td>20 cores - 2 socket，10 cores each</td> <td>128 GB</td> <td>RAID-0, 4 SSDs, 1-5 TBs</td> <td>10 Gbps</td></tr> <tr><td>Analytics, heavy duty</td> <td>28 cores - 2 socket, 14 cores each</td> <td>256 GB - 1 TB</td> <td>NVMe, 10 TB</td> <td>10-56 Gbps</td></tr></tbody></table> <p><strong>实测单块SSD性能</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>disks:
  - mountpoint: /var/lib/scylla/data
    read_iops: <span class="token number">269435</span>
    read_bandwidth: <span class="token number">2931620096</span>
    write_iops: <span class="token number">244322</span>
    write_bandwidth: <span class="token number">2399274496</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="安装scylladb"><a href="#安装scylladb" class="header-anchor">#</a> 安装scylladb</h2> <p>安装scylladb时，机器能连外网，有几个步骤需要：</p> <ol><li>运行scylla_setup 时，ntp选项</li> <li>运行scylla_setup时，检测是否有新版本时</li> <li>运行scylla_setup 时，node-exporter选项，这个也可以先跳过，安装安装后修改<code>/usr/sbin/node_exporter_install</code>中下载地址为内网地址后再运行<code>node_exporter_install</code>安装即可。</li></ol> <p><strong>开始安装</strong></p> <ol><li>yum remove -y abrt gcc-gnat</li> <li>sudo wget -O /etc/yum.repos.d/scylla.repo http://repositories.scylladb.com/scylla/repo/146c1863e35dde22ea5e12cc16607478/centos/scylladb-2.0.repo (这个换成要安装的版本号，只要大版本号就行，例如2.1,2.2等)。</li> <li>curl -o /etc/yum.repos.d/scylla.repo -L http://repositories.scylladb.com/scylla/repo/2809e983-e3b9-49c7-bdc4-1a09c55b8bb4/centos/scylladb-3.0.repo(3.0版本)</li> <li>yum install python34-six python-backports-ssl_match_hostname -y</li> <li>rpm -ivh python3-pyudev-0.21.0-1.el7.noarch.rpm</li> <li>sudo yum install scylla</li> <li>sudo yum install scylla-debug*(需要调试才安装这个)</li> <li>sudo yum install scylla-gdb*(Scylla 自己的gdb，需要调试才安装)</li> <li>yum -y install --downloadonly --downloaddir=/etc/yum.repos.d/abc scylla-gdb</li> <li>yum install python34-six</li></ol> <p><strong>安装特定版本</strong> -
<code>sudo yum install scylla-1.7.1</code>(这个换成特定的版本号)</p> <h2 id="配置scylla"><a href="#配置scylla" class="header-anchor">#</a> 配置scylla</h2> <ol><li><p>在每个节点运行<code>scylla_setup</code>，大部分都选yes，创建文件系统时，要选择SSD盘符（fdisk –l获取）</p></li> <li><p>配置<code>/etc/scylla/scylla.yaml</code></p> <ul><li>cluster_name - 这个改成和项目相关的一个名字，如果是测试系统，默认值就行。
<ul><li><code>sed -i &quot;s/\#cluster_name: 'Test Cluster'/cluster_name: 'my-scylladb'/g&quot; /etc/scylla/scylla.yaml</code></li></ul></li> <li>data_file_directories - 数据目录值，默认值就行，除非自己创建文件系统，自己mount到某个特定的目录。</li> <li>commitlog_directory - 日志目录值，默认值就行，如果机器上有两个ssd盘，其中一个小容量的ssd盘可以分配给日志目录，这样就需要自己指定一个特定的值。</li> <li>seeds - &quot;1.1.1.1,11.1.1.2,1.1.1.3&quot; 这个要换成自己集群的机器的IP地址，一般从集群中选3个机器就行。
<ul><li><code>sed -i 's/seeds: \&quot;127.0.0.1\&quot;/seeds: \&quot;1.1.1.1,11.1.1.2,1.1.1.3\&quot;/g' /etc/scylla/scylla.yaml</code></li></ul></li> <li>listen_address - 本机IP地址
<ul><li><code>sed -i 's/listen_address: localhost/listen_address: '&quot;$local_ip&quot;'/g' /etc/scylla/scylla.yaml</code></li></ul></li> <li>rpc_address - 本机IP地址
<ul><li><code>sed -i 's/rpc_address: localhost/rpc_address: '&quot;$local_ip&quot;'/g' /etc/scylla/scylla.yaml</code></li></ul></li> <li>api_address - 本机IP地址
<ul><li><code>sed -i 's/api_address: 127.0.0.1/api_address: '&quot;$local_ip&quot;'/g' /etc/scylla/scylla.yaml</code></li></ul></li> <li>auto_snapshot - false，如果在每次drop/truncate keyspace或者table后，不想保留原来的数据，可以设置为false。默认是生成snapshot目录的，这样每次drop/truncate操作后，需要手动在每个节点上手动删除相应的snapshot目录，比较麻烦。但如果确实需要保存旧的数据，这个就保留默认的值。
<ul><li><code>sed -i 's/# auto_snapshot: true/auto_snapshot: false/g' /etc/scylla/scylla.yaml</code></li></ul></li></ul></li> <li><p>禁用更新检查<code>/etc/scylla.d/housekeeping.cfg</code></p> <ul><li>check-version: False
<ul><li><code>sed -i 's/check-version: True/check-version: False/g' /etc/scylla.d/housekeeping.cfg</code></li></ul></li></ul></li> <li><p>修改服务超时时间<code>/lib/systemd/system/scylla-server.service</code> 的TimeoutStartSec=3600</p></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -i 's/TimeoutStartSec=900/TimeoutStartSec=3600/g' /lib/systemd/system/scylla-server.service
systemctl daemon-reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li><p>启动/关闭/重启scylla服务</p> <ul><li>sudo service scylla-server start</li> <li>sudo service scylla-server stop</li> <li>sudo service scylla-server restart</li></ul></li> <li><p>cqlsh操作</p> <p>在一台主机上运行<code>cqlsh</code>主机IP，进入cqlsh shell界面：</p></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>cqlsh <span class="token number">172</span>.xx.xx.xx
cqlsh<span class="token operator">&gt;</span>

desc keyspaces 查看所有的keyspace：
cqlsh<span class="token operator">&gt;</span> desc keyspaces<span class="token punctuation">;</span>
system_traces  system_schema  system  stream  hbase

进入某个keyspace：
cqlsh<span class="token operator">&gt;</span> use hbase <span class="token punctuation">;</span>
cqlsh:hbase<span class="token operator">&gt;</span>

查看keyspace所有的table：
cqlsh:hbase<span class="token operator">&gt;</span> desc hbase<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="5"><li>配置scylla</li></ol> <p>server的全局配置参数<code>/etc/sysconfig/scylla-server</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SCYLLA_ARGS=&quot;--log-to-syslog 1 --log-to-stdout 0 --default-log-level info --collectd-address=127.0.0.1:25826 --collectd=1 --collectd-poll-period 3000 --network-stack posix --background-writer-scheduling-quota=0.3 --auto-adjust-flush-quota=true&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>最后background-writer-scheduling-quota是说compaction write占cpu的比例，这个是为了减少客户端请求的延迟，--auto-adjust-flush-quota=true是配置memtable自动flush，这两个参数是2.1以后才有。一般情况无需更改这个配置文件，更改后需要重启scylla服务。</p> <ol start="6"><li>查看scylla的系统日志</li></ol> <p>执行</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>journalctl -xe _COMM=Scylla`，可以加until 和since选项查看某个特定时间段的日志，在Centos上，也可以直接查询 /var/log/messages查看包括scylla在内的整个系统日志。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="7"><li>定位backtrace栈的内容：</li></ol> <p>如果在系统log里发现如下内容：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>scylla: Reactor stalled for 2012 ms on shard 6.
scylla: Backtrace:
scylla: 0x00000000004eef58
scylla: 0x00000000004ef239
scylla: 0x00007fc8745dd0ff
scylla: 0x0000000000ba0fdf
scylla: 0x0000000000b86f03
scylla: 0x0000000000b8101f
scylla: 0x0000000000b820a5
scylla: 0x0000000000b821b5
scylla: 0x0000000000b4a120
scylla: 0x0000000000b4aa51
scylla: 0x0000000000bc936b
scylla: 0x0000000000bcd167
scylla: 0x0000000000bcd748
scylla: 0x0000000000bae9c0
scylla: 0x0000000000b99c01
scylla: 0x0000000000bb583d
scylla: 0x0000000000550a2c
scylla: 0x00000000004ecd0f
scylla: 0x000000000054083a
scylla: 0x00000000005420e0
scylla: 0x000000000059a54d
scylla: 0x00007fc8745d5dc4
scylla: 0x00007fc874302cec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>可以运行下面类似的命令来打印出问题时栈对应的函数：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>addr2line -Cfpi -e /usr/lib/debug/usr/bin/scylla.debug 0x00000000004eef58 0x00000000004ef239 0x00007fc8745dd0ff 0x0000000000ba0fdf 0x0000000000b86f03 0x0000000000b8101f 0x0000000000b820a5 0x0000000000b821b5  0x0000000000b4a120 0x0000000000b4aa51 0x0000000000bc936b 0x0000000000bcd167 0x0000000000bcd748 0x0000000000bae9c0 0x0000000000b99c01 0x0000000000bb583d 0x0000000000550a2c 0x00000000004ecd0f 0x000000000054083a 0x00000000005420e0 0x000000000059a54d 0x00007fc8745d5dc4 0x00007fc874302cec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里16进制的地址信息换成对应的真实地址。</p> <ol start="9"><li>运行nodetool工具</li></ol> <p>运行nodetool工具需要java 1.8版本或更高版本，一般安装scylla rpm包后会自动安装，需要配置一下,<code>.bash_profile</code>里面加上：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token string">&quot;/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre&quot;</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>nodetool tablehistograms</code> - 可以看某个table的运行历史信息，主要看分片大小和延迟。</li> <li><code>nodetool flush</code> - 可以强制把内存中memtable flush到磁盘上</li> <li><code>nodetool getlogginglevels/setlogginglevel</code> - 查询和设置logging level，默认的level就行，这个主要在查问题时需要，一次最好只打开一个模块的，会对性能有很大影响，不要在生产系统使用。</li></ul> <h2 id="安装scylladb监控"><a href="#安装scylladb监控" class="header-anchor">#</a> 安装scylladb监控</h2> <p>详见<a href="/2019/09/17/scylla-monitor-install/">安装scylla-grafana-monitoring</a></p> <h2 id="压测"><a href="#压测" class="header-anchor">#</a> 压测</h2> <p>cassandra-stress是客户端压力测试工具</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">nohup</span> cassandra-stress user <span class="token assign-left variable">profile</span><span class="token operator">=</span>/root/test.yaml <span class="token assign-left variable">duration</span><span class="token operator">=</span>100h <span class="token string">'ops(insert=7,events=3)'</span> -pop <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">30000000000</span><span class="token punctuation">..</span><span class="token number">40000000000</span> -mode native cql3 -rate <span class="token assign-left variable">threads</span><span class="token operator">=</span><span class="token number">3000</span> -node <span class="token number">172</span>.x.x.1,172.x.x.2,172.x.x.3 <span class="token operator">&amp;&gt;</span> /dev/null <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在文件test.yaml可以模拟生产系统的schema，在命令行ops里指定写和读的比例，threads指定有多少线程在运行，duration指定运行时间，更详细的命令参数可以看help，下面是我自己写的test.yaml内容：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">keyspace</span><span class="token punctuation">:</span> test
<span class="token key atrule">keyspace_definition</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
 CREATE KEYSPACE test WITH replication = {'class': 'SimpleStrategy', 'replication_factor': '2'}  AND durable_writes = true;</span>
<span class="token key atrule">table</span><span class="token punctuation">:</span> test_20171121
<span class="token key atrule">table_definition</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
  CREATE TABLE test_20171121 (
        id text,
        datatime int,
        features text,
        PRIMARY KEY (id, datatime)
  ) WITH CLUSTERING ORDER BY (datatime DESC)
   AND bloom_filter_fp_chance = 0.01
   AND caching = {'keys': 'ALL','rows_per_partition': 'ALL'}
   AND comment = ''
   AND compaction = {'class': 'SizeTieredCompactionStrategy'}
   AND compression = {'sstable_compression': 'org.apache.cassandra.io.compress.LZ4Compressor'}
   AND dclocal_read_repair_chance = 0.1
   AND default_time_to_live = 604800
   AND gc_grace_seconds = 0
   AND max_index_interval = 2048
   AND memtable_flush_period_in_ms = 0
   AND min_index_interval = 128
   AND speculative_retry = '99.0PERCENTILE';</span>
<span class="token key atrule">columnspec</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> id
    <span class="token key atrule">size</span><span class="token punctuation">:</span> fixed(120)
    <span class="token key atrule">population</span><span class="token punctuation">:</span> uniform(1..1000000000000)
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> datatime
    <span class="token key atrule">size</span><span class="token punctuation">:</span> fixed(120)
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span> fixed(1)
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> features
    <span class="token key atrule">size</span><span class="token punctuation">:</span> fixed(120)
<span class="token key atrule">insert</span><span class="token punctuation">:</span>
  <span class="token key atrule">partitions</span><span class="token punctuation">:</span> fixed(1)
  <span class="token key atrule">batchtype</span><span class="token punctuation">:</span> UNLOGGED
  <span class="token key atrule">select</span><span class="token punctuation">:</span> fixed(1)/1
<span class="token key atrule">queries</span><span class="token punctuation">:</span>
  <span class="token key atrule">events</span><span class="token punctuation">:</span>
   <span class="token key atrule">cql</span><span class="token punctuation">:</span> select * from test_20171121 where id = <span class="token punctuation">?</span> limit 1
   <span class="token key atrule">fields</span><span class="token punctuation">:</span> samerow
  <span class="token key atrule">latest_event</span><span class="token punctuation">:</span>
   <span class="token key atrule">cql</span><span class="token punctuation">:</span> select * from test_20171121 where id = <span class="token punctuation">?</span> LIMIT 1
   <span class="token key atrule">fields</span><span class="token punctuation">:</span> samerow
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>这里columnspec: 规范内容里，可以指定每个字段的大小（size），对于clustering key, 可以指定 cluster属性，表示一个partition里有多少个clustering key，可以测试一个partition里有很多行的情况。</p> <h2 id="安装scylla-manager"><a href="#安装scylla-manager" class="header-anchor">#</a> 安装scylla-manager</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">curl</span> -o /etc/yum.repos.d/scylla-manager.repo -L http://repositories.scylladb.com/scylla/repo/2809e983-e3b9-49c7-bdc4-1a09c55b8bb4/centos/scylladb-manager-1.3.repo
<span class="token function">sudo</span> <span class="token function">curl</span> -o /etc/yum.repos.d/scylla.repo -L http://repositories.scylladb.com/scylla/repo/2809e983-e3b9-49c7-bdc4-1a09c55b8bb4/centos/scylladb-manager-1.2.repo
<span class="token function">sudo</span> yum <span class="token function">install</span> scylla-manager-server scylla-manager-client
yum -y <span class="token function">install</span> --downloadonly --downloaddir<span class="token operator">=</span>/etc/yum.repos.d/abc scylla-manager-server scylla-manager-client
scyllamgr_setup
systemctl start scylla-manager.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="scylla连接池配置"><a href="#scylla连接池配置" class="header-anchor">#</a> scylla连接池配置</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>＃本地主机的最小连接（同一数据中心中的一个）
coreConnectionsPerLocalHost：1
＃本地主机的最大连接数（同一数据中心中的一个）
maxConnectionsPerLocalHost：1
＃远程主机的最小连接（远程数据中心中的一个）
coreConnectionsPerRemoteHost：1
＃远程主机（同一数据中心中的一个）的最大连接数
maxConnectionsPerRemoteHost：1
＃每个本地连接（同一数据中心中的一个）的最大并发请求数
maxRequestsPerLocalConnection：32768
＃每个远程连接的最大并发请求数（远程数据中心中的一个）
maxRequestsPerRemoteConnection：2048
＃触发打开新本地连接的请求数（如果有）
newLocalConnectionThreshold：30000
＃触发打开新的远程连接的请求数（如果有）
newRemoteConnectionThreshold：400
＃等待获取连接的毫秒数（此后转到查询计划中的下一个可用主机）
poolTimeoutMillis：0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></div></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/07/28, 11:07:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/79caea/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">
        坏快修复
      </div></a> <a href="/pages/2cae68/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">
        Seastar架构介绍(一)
      </div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/79caea/" class="prev">坏快修复</a></span> <span class="next"><a href="/pages/2cae68/">Seastar架构介绍(一)</a>
        →
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/fe6a06/"><div>分区维护</div></a> <span>11-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ca2bd6/"><div>验证write ahead是否有效</div></a> <span>10-16</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/64607c/"><div>使用undrop-for-innodb恢复数据</div></a> <span>09-25</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> </main></div> <div class="footer"><div class="icons"><a href="mailto:583675636@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
     | Copyright © 2020-2020
    <span>yong.wei | <a href="" target="_blank"></a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b45ba360.js" defer></script><script src="/assets/js/2.6eac6864.js" defer></script><script src="/assets/js/3.a88a92d5.js" defer></script><script src="/assets/js/42.92fd262d.js" defer></script>
  </body>
</html>
(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{450:function(s,a,t){"use strict";t.r(a);var e=t(51),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mysql高可用架构之pxc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql高可用架构之pxc"}},[s._v("#")]),s._v(" MySQL高可用架构之PXC")]),s._v(" "),t("h2",{attrs:{id:"pxc主要特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pxc主要特性"}},[s._v("#")]),s._v(" PXC主要特性")]),s._v(" "),t("ul",[t("li",[s._v("同步复制，没有数据延迟。")]),s._v(" "),t("li",[s._v("多主复制，所有节点都可以读写。")]),s._v(" "),t("li",[s._v("行级别并行复制。")]),s._v(" "),t("li",[s._v("新增节点自动完成同步。")]),s._v(" "),t("li",[s._v("所有节点数据强一致性。")]),s._v(" "),t("li",[s._v("Configuration script for ProxySQL")]),s._v(" "),t("li",[s._v("Automatic configuration of SSL encryption")]),s._v(" "),t("li",[s._v("兼容MySQL Server Community Edition, Percona Server, and MariaDB。")])]),s._v(" "),t("h2",{attrs:{id:"pxc主要限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pxc主要限制"}},[s._v("#")]),s._v(" PXC主要限制")]),s._v(" "),t("ul",[t("li",[s._v("仅支持innodb引擎，因此操作mysql.*系统表需要用DDL而不能用DML。")]),s._v(" "),t("li",[t("code",[s._v("LOCK TABLES")]),s._v("和"),t("code",[s._v("UNLOCK TABLES")]),s._v("在multi-master模式下不支持。")]),s._v(" "),t("li",[s._v("Lock functions, such as GET_LOCK(), RELEASE_LOCK(), and so on。")]),s._v(" "),t("li",[s._v("Query log不能写入表，只能写入文件。")]),s._v(" "),t("li",[s._v("Maximum allowed transaction size is defined by the wsrep_max_ws_rows and wsrep_max_ws_size variables. LOAD DATA INFILE processing will commit every 10 000 rows. So large transactions due to LOAD DATA will be split to series of small transactions.")]),s._v(" "),t("li",[s._v("乐观锁")]),s._v(" "),t("li",[s._v("XA transactions are not supported due to possible rollback on commit.")]),s._v(" "),t("li",[s._v("集群性能由最差节点决定。")]),s._v(" "),t("li",[s._v("建议3个节点，第三个节点可以是仲裁节点。")]),s._v(" "),t("li",[s._v("InnoDB fake changes feature is not supported.")]),s._v(" "),t("li",[s._v("enforce_storage_engine=InnoDB is not compatible with wsrep_replicate_myisam=OFF (default).")]),s._v(" "),t("li",[s._v("不支持传输表空间")]),s._v(" "),t("li",[s._v("必须有主键")])]),s._v(" "),t("h2",{attrs:{id:"部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("在3个node上执行安装。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://www.percona.com/downloads/percona-release/redhat/1.0-13/percona-release-1.0-13.noarch.rpm -y\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" Percona-XtraDB-Cluster-57 -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"参数配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数配置"}},[s._v("#")]),s._v(" 参数配置")]),s._v(" "),t("p",[s._v("编辑"),t("code",[s._v("/etc/percona-xtradb-cluster.conf.d/wsrep.cnf")]),s._v("文件，按实际修改。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_provider")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/lib64/galera3/libgalera_smm.so\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_cluster_address")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gcomm://x.x.x.x,x.x.x.x,x.x.x.x\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binlog_format")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ROW\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("default_storage_engine")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("InnoDB\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_slave_threads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\nwsrep_log_conflicts\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("innodb_autoinc_lock_mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_node_address")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x.x.x.x\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_cluster_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pxc-cluster\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_node_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pxc-cluster-node-1\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pxc_strict_mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENFORCING\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_sst_method")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xtrabackup-v2\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_sst_auth")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sstuser:s3cretPass"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("第二个节点：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_node_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pxc-cluster-node-2\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_node_address")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".70.62\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("第二个节点：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_node_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pxc-cluster-node-3\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("wsrep_node_address")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".70.63\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("ol",[t("li",[s._v("启动第一个节点 - "),t("code",[s._v("systemctl start mysql@bootstrap.service")])]),s._v(" "),t("li",[s._v("从error日志里面找到临时密码，登录mysql修改密码 - "),t("code",[s._v("set password=password('123456');")])]),s._v(" "),t("li",[s._v("查看状态 - "),t("code",[s._v("show status like 'wsrep%';")])]),s._v(" "),t("li",[s._v("创建复制用户")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@pxc1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sstuser'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'passw0rd'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@pxc1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" RELOAD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LOCK")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" PROCESS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" CLIENT "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sstuser'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@pxc1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" FLUSH "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("启动第二个节点 - "),t("code",[s._v("systemctl start mysqld.service")])]),s._v(" "),t("li",[s._v("等待第二个节点的 - "),t("code",[s._v("wsrep_local_state_comment")]),s._v("变成Synced")]),s._v(" "),t("li",[s._v("启动第三个节点 - "),t("code",[s._v("systemctl start mysqld.service")])])]),s._v(" "),t("h3",{attrs:{id:"基准测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基准测试"}},[s._v("#")]),s._v(" 基准测试")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("准备环境 - "),t("code",[s._v("create database proxytest default character set utf8;")])])]),s._v(" "),t("li",[t("p",[s._v("执行测试 - "),t("code",[s._v("sysbench --test=/usr/share/doc/sysbench/tests/db/oltp.lua --mysql-host=node1 --mysql-port=3306 --mysql-user=proxysql --mysql-password=proxysql --mysql-db=proxytest --oltp-tables-count=10 --oltp-table-size=1000000 --report-interval=20 --oltp-dist-type=uniform --rand-init=on --max-requests=0 --oltp-read-only=off --max-time=120 --num-threads=16 prepare")])])]),s._v(" "),t("li",[t("p",[s._v("测试结果")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("MySQL架构")]),s._v(" "),t("th",[s._v("tps")]),s._v(" "),t("th",[s._v("qps")]),s._v(" "),t("th",[s._v("95% response time")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("单mysql实例 直连")]),s._v(" "),t("td",[s._v("2341")]),s._v(" "),t("td",[s._v("42138")]),s._v(" "),t("td",[s._v("8.78ms")])]),s._v(" "),t("tr",[t("td",[s._v("innodb cluster 直连")]),s._v(" "),t("td",[s._v("1935")]),s._v(" "),t("td",[s._v("34844")]),s._v(" "),t("td",[s._v("9.77ms")])]),s._v(" "),t("tr",[t("td",[s._v("innodb cluster router")]),s._v(" "),t("td",[s._v("1529")]),s._v(" "),t("td",[s._v("27529")]),s._v(" "),t("td",[s._v("13.02ms")])]),s._v(" "),t("tr",[t("td",[s._v("pxc")]),s._v(" "),t("td",[s._v("1800")]),s._v(" "),t("td",[s._v("32419")]),s._v(" "),t("td",[s._v("10.85ms")])])])])])]),s._v(" "),t("h2",{attrs:{id:"仲裁节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#仲裁节点"}},[s._v("#")]),s._v(" 仲裁节点")]),s._v(" "),t("p",[s._v("PXC双节点由于脑裂的发生和quorum机制，通常单纯双节点的percona集群无法保证环境的可靠性。因此引入了仲裁技术--\x3earbitrator来防止双节点的集群环境中由于通信故障而导致节点无法正常同步的情况发生。当节点无法接受到其他节点的通信时，如果可以同arbitrator连接，可以通过arbitrator接受和发送同步数据。arbitrator不应用接收的同步数据，但需要查看所有的同步活动，因此arbitrator所在的网络速度慢的话会导致整个集群性能下降。")]),s._v(" "),t("h3",{attrs:{id:"增加仲裁节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加仲裁节点"}},[s._v("#")]),s._v(" 增加仲裁节点")]),s._v(" "),t("ul",[t("li",[s._v("编辑"),t("code",[s._v("/etc/sysconfig/garb")]),s._v("文件。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright (C) 2012 Codership Oy")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This config file is to be sourced by garb service script.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A comma-separated list of node addresses (address[:port]) in the cluster")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GALERA_NODES")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node1:4567,node2:4567"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Galera cluster name, should be the same as on the rest of the nodes.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GALERA_GROUP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pxc-cluster"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Optional Galera internal options string (e.g. SSL settings)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# see http://galeracluster.com/documentation-webpages/galeraparameters.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# GALERA_OPTIONS=""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Log file for garbd. Optional, by default logs to syslog")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Deprecated for CentOS7, use journalctl to query the log for garbd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# LOG_FILE=""')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ul",[t("li",[s._v("启动服务 - "),t("code",[s._v("service garb start")])]),s._v(" "),t("li",[s._v("检查状态 - "),t("code",[s._v("service garb status")])])]),s._v(" "),t("h3",{attrs:{id:"验证仲裁节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证仲裁节点"}},[s._v("#")]),s._v(" 验证仲裁节点")]),s._v(" "),t("ol",[t("li",[s._v("关闭主从节点网络连接")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -A INPUT -d node2 -s node1 -j REJECT")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -A OUTPUT -d node2 -s node1 -j REJECT")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("查看节点状态")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wsrep_local_state%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------------+--------------------------------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("                                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------------+--------------------------------------+                                 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_local_state_comment "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Synced                               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("虽然网络不通，但是集群状态正常。")]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("数据同步测试")])]),s._v(" "),t("ul",[t("li",[s._v("主节点")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" test "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nRecords: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  Duplicates: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Warnings")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" test "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \nQuery OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" test "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name2'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("ul",[t("li",[s._v("从节点")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+-------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" name  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+-------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" name  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" name2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+-------+")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("仲裁节点起作用了。")])])}),[],!1,null,null,null);a.default=r.exports}}]);
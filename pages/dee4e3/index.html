<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Greenplum高可用部署 | 韦勇的博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="DBA，程序员，专注于IT互联网，大数据，包括但不限于数据库、Python等。">
    <meta name="keywords" content="DBA博客,个人技术博客,数据库,前端开发,前端框架,web前端,技术文档,学习,mysql,redis,mongodb,postgresql,greenplum,aerospike,scylladb,vertica,Python,JavaScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.c231a23d.css" as="style"><link rel="preload" href="/assets/js/app.b45ba360.js" as="script"><link rel="preload" href="/assets/js/2.6eac6864.js" as="script"><link rel="preload" href="/assets/js/3.a88a92d5.js" as="script"><link rel="preload" href="/assets/js/37.0cb9802c.js" as="script"><link rel="prefetch" href="/assets/js/10.9ac750bc.js"><link rel="prefetch" href="/assets/js/11.d59f0158.js"><link rel="prefetch" href="/assets/js/12.8cb6333d.js"><link rel="prefetch" href="/assets/js/13.8d09723d.js"><link rel="prefetch" href="/assets/js/14.489067bb.js"><link rel="prefetch" href="/assets/js/15.67863306.js"><link rel="prefetch" href="/assets/js/16.7bf247d8.js"><link rel="prefetch" href="/assets/js/17.121f6b76.js"><link rel="prefetch" href="/assets/js/18.4a67525f.js"><link rel="prefetch" href="/assets/js/19.99a721fb.js"><link rel="prefetch" href="/assets/js/20.4d4ffe62.js"><link rel="prefetch" href="/assets/js/21.988d351d.js"><link rel="prefetch" href="/assets/js/22.1e452d5b.js"><link rel="prefetch" href="/assets/js/23.705c804a.js"><link rel="prefetch" href="/assets/js/24.4160caef.js"><link rel="prefetch" href="/assets/js/25.c0cead69.js"><link rel="prefetch" href="/assets/js/26.8474fcb9.js"><link rel="prefetch" href="/assets/js/27.68577f4d.js"><link rel="prefetch" href="/assets/js/28.76404f22.js"><link rel="prefetch" href="/assets/js/29.29ebfa2e.js"><link rel="prefetch" href="/assets/js/30.42cb86c5.js"><link rel="prefetch" href="/assets/js/31.e9a9f49e.js"><link rel="prefetch" href="/assets/js/32.a1c8cda8.js"><link rel="prefetch" href="/assets/js/33.de67351d.js"><link rel="prefetch" href="/assets/js/34.72daac17.js"><link rel="prefetch" href="/assets/js/35.0d28f4f7.js"><link rel="prefetch" href="/assets/js/36.f50a6e95.js"><link rel="prefetch" href="/assets/js/38.14a9b8c9.js"><link rel="prefetch" href="/assets/js/39.7f29c316.js"><link rel="prefetch" href="/assets/js/4.c2705a33.js"><link rel="prefetch" href="/assets/js/40.4bd4ac79.js"><link rel="prefetch" href="/assets/js/41.beb899d2.js"><link rel="prefetch" href="/assets/js/42.92fd262d.js"><link rel="prefetch" href="/assets/js/43.f93ed735.js"><link rel="prefetch" href="/assets/js/44.37e9f48e.js"><link rel="prefetch" href="/assets/js/45.171bf2c1.js"><link rel="prefetch" href="/assets/js/46.ab0fa104.js"><link rel="prefetch" href="/assets/js/47.2bd4da2a.js"><link rel="prefetch" href="/assets/js/48.6f1ece74.js"><link rel="prefetch" href="/assets/js/49.7ee1a812.js"><link rel="prefetch" href="/assets/js/5.4c01046b.js"><link rel="prefetch" href="/assets/js/50.4ea52293.js"><link rel="prefetch" href="/assets/js/51.b5737a73.js"><link rel="prefetch" href="/assets/js/52.a8911a99.js"><link rel="prefetch" href="/assets/js/53.562b75b3.js"><link rel="prefetch" href="/assets/js/54.43b31295.js"><link rel="prefetch" href="/assets/js/55.722f0ac0.js"><link rel="prefetch" href="/assets/js/56.dd56fc0d.js"><link rel="prefetch" href="/assets/js/57.51f8e820.js"><link rel="prefetch" href="/assets/js/58.a6751fea.js"><link rel="prefetch" href="/assets/js/59.5b67abf1.js"><link rel="prefetch" href="/assets/js/6.38f9d1c7.js"><link rel="prefetch" href="/assets/js/60.40b9f1c0.js"><link rel="prefetch" href="/assets/js/61.cf3bc22e.js"><link rel="prefetch" href="/assets/js/62.ee744d9e.js"><link rel="prefetch" href="/assets/js/63.ecae0239.js"><link rel="prefetch" href="/assets/js/64.2e99c3e7.js"><link rel="prefetch" href="/assets/js/65.b3515acb.js"><link rel="prefetch" href="/assets/js/66.0c5c25c6.js"><link rel="prefetch" href="/assets/js/67.b90820e6.js"><link rel="prefetch" href="/assets/js/68.9d0729eb.js"><link rel="prefetch" href="/assets/js/69.751b150c.js"><link rel="prefetch" href="/assets/js/7.e34b3bc8.js"><link rel="prefetch" href="/assets/js/70.67171620.js"><link rel="prefetch" href="/assets/js/71.59324e4a.js"><link rel="prefetch" href="/assets/js/72.d931ea49.js"><link rel="prefetch" href="/assets/js/73.82b3b67b.js"><link rel="prefetch" href="/assets/js/74.55622a29.js"><link rel="prefetch" href="/assets/js/75.4130e842.js"><link rel="prefetch" href="/assets/js/76.c5f76e21.js"><link rel="prefetch" href="/assets/js/8.d51727c6.js"><link rel="prefetch" href="/assets/js/9.44347f46.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c231a23d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">韦勇的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系统" class="dropdown-title"><a href="/system/" class="link-title">系统</a> <span class="title" style="display:none;">系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>系统文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/654590/" class="nav-link">Linux维护手册</a></li><li class="dropdown-subitem"><a href="/pages/85d59c/" class="nav-link">使用iotune测试磁盘读写</a></li><li class="dropdown-subitem"><a href="/pages/45c411/" class="nav-link">源码编译gcc</a></li><li class="dropdown-subitem"><a href="/pages/187f4d/" class="nav-link">YCSB压测</a></li><li class="dropdown-subitem"><a href="/pages/ca2bd6/" class="nav-link">write ahead</a></li></ul></li><li class="dropdown-item"><h4>编程开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">编程开发</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><a href="/mysql/" class="link-title">MySQL</a> <span class="title" style="display:none;">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a6ac55/" class="nav-link">部署</a></li></ul></li><li class="dropdown-item"><h4>HA</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c78f1b/" class="nav-link">HA选型</a></li><li class="dropdown-subitem"><a href="/pages/0439fa/" class="nav-link">MGR</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a0df55/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>笔记文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ee31c0/" class="nav-link">MySQL8新特性</a></li><li class="dropdown-subitem"><a href="/pages/08b679/" class="nav-link">SQL优化</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PostgreSQL" class="dropdown-title"><a href="/postgresql/" class="link-title">PostgreSQL</a> <span class="title" style="display:none;">PostgreSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/859ac7/" class="nav-link">部署</a></li><li class="dropdown-subitem"><a href="/pages/2373b5/" class="nav-link">运维手册</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/96963a/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>源码开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ddbfb5/" class="nav-link">统计SQL执行耗时分位</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/distributed/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Greenplum</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/441817/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" aria-current="page" class="nav-link router-link-exact-active router-link-active">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/4bb09b/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/84a443/" class="nav-link">监控指标</a></li></ul></li><li class="dropdown-item"><h4>Scylladb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2cae68/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/342275/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/95d8cc/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/e27c40/" class="nav-link">数据迁移</a></li><li class="dropdown-subitem"><a href="/pages/cf45d3/" class="nav-link">监控部署</a></li></ul></li><li class="dropdown-item"><h4>Aerospike</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd9ddc/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/80ee1a/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/9ba431/" class="nav-link">管理手册</a></li><li class="dropdown-subitem"><a href="/pages/76e199/" class="nav-link">ACT测试</a></li><li class="dropdown-subitem"><a href="/pages/4131aa/" class="nav-link">源码编译</a></li><li class="dropdown-subitem"><a href="/pages/75d8ce/" class="nav-link">数据加载</a></li></ul></li><li class="dropdown-item"><h4>Vertica</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b023ab/" class="nav-link">安装部署</a></li></ul></li><li class="dropdown-item"><h4>Tidb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a52d49/" class="nav-link">数据迁移</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NoSQL" class="dropdown-title"><a href="/nosql/" class="link-title">NoSQL</a> <span class="title" style="display:none;">NoSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b9b610/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/5cdb24/" class="nav-link">性能测试</a></li><li class="dropdown-subitem"><a href="/pages/52f09b/" class="nav-link">运维手册</a></li><li class="dropdown-subitem"><a href="/pages/855952/" class="nav-link">安全加固</a></li><li class="dropdown-subitem"><a href="/pages/fea0b7/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" aria-current="page" class="nav-link router-link-exact-active router-link-active">新特性</a></li></ul></li><li class="dropdown-item"><h4>MongoDB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/61caf7/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/e25894/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/7de6de/" class="nav-link">运维手册</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程开发" class="dropdown-title"><a href="/dev/" class="link-title">编程开发</a> <span class="title" style="display:none;">编程开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c77a4b/" class="nav-link">开发笔记</a></li><li class="dropdown-subitem"><a href="/pages/8503e3/" class="nav-link">安装笔记</a></li><li class="dropdown-subitem"><a href="/pages/6ec23d/" class="nav-link">sqlalchemy</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/23f6e2/" class="nav-link">开发笔记</a></li></ul></li><li class="dropdown-item"><h4>Shell</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">安装部署</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/weiyong.jpeg"> <div class="blogger-info"><h3>yong.wei</h3> <span>
        数据库小学生
      </span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系统" class="dropdown-title"><a href="/system/" class="link-title">系统</a> <span class="title" style="display:none;">系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>系统文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/654590/" class="nav-link">Linux维护手册</a></li><li class="dropdown-subitem"><a href="/pages/85d59c/" class="nav-link">使用iotune测试磁盘读写</a></li><li class="dropdown-subitem"><a href="/pages/45c411/" class="nav-link">源码编译gcc</a></li><li class="dropdown-subitem"><a href="/pages/187f4d/" class="nav-link">YCSB压测</a></li><li class="dropdown-subitem"><a href="/pages/ca2bd6/" class="nav-link">write ahead</a></li></ul></li><li class="dropdown-item"><h4>编程开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">编程开发</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><a href="/mysql/" class="link-title">MySQL</a> <span class="title" style="display:none;">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a6ac55/" class="nav-link">部署</a></li></ul></li><li class="dropdown-item"><h4>HA</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c78f1b/" class="nav-link">HA选型</a></li><li class="dropdown-subitem"><a href="/pages/0439fa/" class="nav-link">MGR</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a0df55/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>笔记文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ee31c0/" class="nav-link">MySQL8新特性</a></li><li class="dropdown-subitem"><a href="/pages/08b679/" class="nav-link">SQL优化</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PostgreSQL" class="dropdown-title"><a href="/postgresql/" class="link-title">PostgreSQL</a> <span class="title" style="display:none;">PostgreSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>运维相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/859ac7/" class="nav-link">部署</a></li><li class="dropdown-subitem"><a href="/pages/2373b5/" class="nav-link">运维手册</a></li></ul></li><li class="dropdown-item"><h4>备份恢复</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/96963a/" class="nav-link">备份恢复实践</a></li></ul></li><li class="dropdown-item"><h4>源码开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ddbfb5/" class="nav-link">统计SQL执行耗时分位</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/distributed/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Greenplum</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/441817/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" aria-current="page" class="nav-link router-link-exact-active router-link-active">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/4bb09b/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/84a443/" class="nav-link">监控指标</a></li></ul></li><li class="dropdown-item"><h4>Scylladb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2cae68/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/342275/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/95d8cc/" class="nav-link">维护手册</a></li><li class="dropdown-subitem"><a href="/pages/e27c40/" class="nav-link">数据迁移</a></li><li class="dropdown-subitem"><a href="/pages/cf45d3/" class="nav-link">监控部署</a></li></ul></li><li class="dropdown-item"><h4>Aerospike</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd9ddc/" class="nav-link">架构介绍</a></li><li class="dropdown-subitem"><a href="/pages/80ee1a/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/9ba431/" class="nav-link">管理手册</a></li><li class="dropdown-subitem"><a href="/pages/76e199/" class="nav-link">ACT测试</a></li><li class="dropdown-subitem"><a href="/pages/4131aa/" class="nav-link">源码编译</a></li><li class="dropdown-subitem"><a href="/pages/75d8ce/" class="nav-link">数据加载</a></li></ul></li><li class="dropdown-item"><h4>Vertica</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b023ab/" class="nav-link">安装部署</a></li></ul></li><li class="dropdown-item"><h4>Tidb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a52d49/" class="nav-link">数据迁移</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NoSQL" class="dropdown-title"><a href="/nosql/" class="link-title">NoSQL</a> <span class="title" style="display:none;">NoSQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b9b610/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/5cdb24/" class="nav-link">性能测试</a></li><li class="dropdown-subitem"><a href="/pages/52f09b/" class="nav-link">运维手册</a></li><li class="dropdown-subitem"><a href="/pages/855952/" class="nav-link">安全加固</a></li><li class="dropdown-subitem"><a href="/pages/fea0b7/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/dee4e3/" aria-current="page" class="nav-link router-link-exact-active router-link-active">新特性</a></li></ul></li><li class="dropdown-item"><h4>MongoDB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/61caf7/" class="nav-link">安装部署</a></li><li class="dropdown-subitem"><a href="/pages/e25894/" class="nav-link">HA</a></li><li class="dropdown-subitem"><a href="/pages/7de6de/" class="nav-link">运维手册</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程开发" class="dropdown-title"><a href="/dev/" class="link-title">编程开发</a> <span class="title" style="display:none;">编程开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c77a4b/" class="nav-link">开发笔记</a></li><li class="dropdown-subitem"><a href="/pages/8503e3/" class="nav-link">安装笔记</a></li><li class="dropdown-subitem"><a href="/pages/6ec23d/" class="nav-link">sqlalchemy</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/23f6e2/" class="nav-link">开发笔记</a></li></ul></li><li class="dropdown-item"><h4>Shell</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages//" class="nav-link">安装部署</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Greenplum</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dee4e3/" aria-current="page" class="active sidebar-link">HA部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dee4e3/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#下载软件包" class="sidebar-link">下载软件包</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#配置系统" class="sidebar-link">配置系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dee4e3/#禁用selinu和firewall" class="sidebar-link">禁用SELinu和Firewall</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#系统参数" class="sidebar-link">系统参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#初始化db" class="sidebar-link">初始化DB</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#数据库参数调整" class="sidebar-link">数据库参数调整</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#账号配置" class="sidebar-link">账号配置</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#master节点高可用配置" class="sidebar-link">Master节点高可用配置</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#配置gphdfs" class="sidebar-link">配置gphdfs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dee4e3/#安装hadoop-client" class="sidebar-link">安装hadoop client</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#配置gphdfs-2" class="sidebar-link">配置gphdfs</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#数据加载测试" class="sidebar-link">数据加载测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#pxf" class="sidebar-link">PXF</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#gpcopy" class="sidebar-link">gpcopy</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#故障恢复" class="sidebar-link">故障恢复</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dee4e3/#primary节点故障" class="sidebar-link">primary节点故障</a></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#mirror节点故障" class="sidebar-link">mirror节点故障</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/dee4e3/#tpch测试" class="sidebar-link">TPCH测试</a></li></ul></li><li><a href="/pages/441817/" class="sidebar-link">Greenplum架构介绍</a></li><li><a href="/pages/4bb09b/" class="sidebar-link">维护手册</a></li><li><a href="/pages/84a443/" class="sidebar-link">监控指标</a></li><li><a href="/pages/79caea/" class="sidebar-link">坏快修复</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ScyllaDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Aerospike</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vertica</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TiDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-f6108aee><div class="articleInfo" data-v-f6108aee><ul class="breadcrumbs" data-v-f6108aee><li data-v-f6108aee><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-f6108aee></a></li> <li data-v-f6108aee><a href="/distributed" title="分布式-目录页" data-v-f6108aee>分布式</a></li> <li data-v-f6108aee><a href="/distributed/#Greenplum" title="分布式#Greenplum" data-v-f6108aee>Greenplum</a></li></ul> <div class="info" data-v-f6108aee><div title="作者" class="author iconfont icon-touxiang" data-v-f6108aee><a href="javascript:;" data-v-f6108aee>yong.wei</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-f6108aee><a href="javascript:;" data-v-f6108aee>2020-01-04</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          Greenplum高可用部署
        </h1> <div class="theme-vdoing-content content__default"><h1 id="greenplum高可用部署"><a href="#greenplum高可用部署" class="header-anchor">#</a> Greenplum高可用部署</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>greenplum已更新至6.0版本，本文将带大家实战6.0高可用架构。</p> <h2 id="下载软件包"><a href="#下载软件包" class="header-anchor">#</a> 下载软件包</h2> <p>登录<a href="https://network.pivotal.io" target="_blank" rel="noopener noreferrer">Pivotal官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载rpm安装包。</p> <blockquote><p>注：
如果无法下载可能是你注册的时候城市选择了国内城市，可以重新注册选择国外城市即可。</p></blockquote> <h2 id="配置系统"><a href="#配置系统" class="header-anchor">#</a> 配置系统</h2> <h3 id="禁用selinu和firewall"><a href="#禁用selinu和firewall" class="header-anchor">#</a> 禁用SELinu和Firewall</h3> <p>vi /etc/selinux/config</p> <blockquote><p>SELINUX=disabled</p></blockquote> <p>关闭防火墙</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl stop firewalld.service
systemctl disable firewalld.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="系统参数"><a href="#系统参数" class="header-anchor">#</a> 系统参数</h3> <p><strong>/etc/sysctl.conf</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># kernel.shmall = _PHYS_PAGES / 2 # echo $(expr $(getconf _PHYS_PAGES) / 2)
kernel.shmall = 8000000
# kernel.shmmax = kernel.shmall * PAGE_SIZE # echo $(expr $(getconf _PHYS_PAGES) / 2 \* $(getconf PAGE_SIZE))
kernel.shmmax = 30000000000
kernel.shmmni = 4096
vm.overcommit_memory = 2
vm.overcommit_ratio = 95
net.ipv4.ip_local_port_range = 10000 65535
kernel.sem = 500 2048000 200 40960
kernel.sysrq = 1
kernel.core_uses_pid = 1
kernel.msgmnb = 65536
kernel.msgmax = 65536
kernel.msgmni = 2048
net.ipv4.tcp_syncookies = 1
net.ipv4.conf.default.accept_source_route = 0
net.ipv4.tcp_max_syn_backlog = 4096
net.ipv4.conf.all.arp_filter = 1
net.core.netdev_max_backlog = 10000
net.core.rmem_max = 2097152
net.core.wmem_max = 2097152
vm.swappiness = 10
vm.zone_reclaim_mode = 0
vm.dirty_expire_centisecs = 500
vm.dirty_writeback_centisecs = 100
# 以下4项是64GB物理内存的优化建议，如果小于64GB，则删除vm.dirty_background_bytes和vm.dirty_bytes，同事设置vm.dirty_background_ratio = 3，vm.dirty_ratio = 10。
vm.dirty_background_ratio = 0
vm.dirty_ratio = 0
vm.dirty_background_bytes = 1610612736
vm.dirty_bytes = 4294967296
# vm.min_free_kbytes不可高于5%的物理内存，awk 'BEGIN {OFMT = &quot;%.0f&quot;;} /MemTotal/ {print &quot;vm.min_free_kbytes =&quot;, $2 * .03;}' /proc/meminfo &gt;&gt; /etc/sysctl.conf
vm.min_free_kbytes = 1972773
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><strong>/etc/security/limits.conf</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@gpadmin soft nofile 655350
@gpadmin hard nofile 655350
@gpadmin soft nproc 655350
@gpadmin hard nproc 655350
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>文件系统建议挂载配置</strong></p> <p><code>/dev/data /data xfs nodev,noatime,nobarrier,inode64 0 0</code></p> <p><strong>配置预读</strong></p> <p><code>/sbin/blockdev --setra 16384 /dev/sdb</code></p> <p><strong>IO调度策略</strong></p> <p><code>echo deadline &gt; /sys/block/sbd/queue/scheduler</code></p> <p><strong>禁用 Transparent Huge Pages (THP)</strong></p> <p><code># grubby --update-kernel=ALL --args=&quot;transparent_hugepage=never&quot;</code></p> <p><code># cat /sys/kernel/mm/*transparent_hugepage/enabled</code></p> <p><strong>禁用IPC</strong></p> <p>/etc/systemd/logind.conf添加：</p> <blockquote><p>RemoveIPC=no</p></blockquote> <p>service systemd-logind restart</p> <p><strong>/etc/hosts 增加所有节点主机民解析</strong></p> <p>也可以使用dns解析。</p> <p><strong>创建gpadmin用户</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># groupadd gpadmin</span>
<span class="token comment"># useradd gpadmin -g gpadmin</span>
<span class="token comment"># passwd gpadmin</span>
New password: <span class="token operator">&lt;</span>changeme<span class="token operator">&gt;</span>
Retype new password: <span class="token operator">&lt;</span>changeme<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>创建目录</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> -p /greenplum/primary
<span class="token function">mkdir</span> -p /greenplum/mirror
<span class="token function">chown</span> -R gpadmin. /greenplum
<span class="token function">chmod</span> -R <span class="token number">700</span> /greenplum
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>在所有host上安装greenplum-db-6.0.0-rhel7-x86_64.rpm包</p> <blockquote><p>yum install greenplum-db-6.0.0-rhel7-x86_64.rpm</p></blockquote> <p>安装完成后在/usr/local下生成如下目录：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>lrwxrwxrwx   1 root root   29 Sep 16 11:41 greenplum-db -&gt; /usr/local/greenplum-db-6.0.0
drwxr-xr-x  11 root root  235 Sep 16 11:41 greenplum-db-6.0.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改一下属组</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">chown</span> -R gpadmin /usr/local/greenplum*
<span class="token function">chgrp</span> -R gpadmin /usr/local/greenplum*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改gpadmin用户环境变量.bash_profile，增加：</p> <blockquote><p>echo &quot;source /usr/local/greenplum-db/greenplum_path.sh&quot;&gt;&gt;~gpadmin/.bash_profile</p></blockquote> <p>配置所有节点的gpadmin用户之间免密登录。具体方法自行搜索了。</p> <h2 id="初始化db"><a href="#初始化db" class="header-anchor">#</a> 初始化DB</h2> <p>编辑gpinitsystem_config，这里我们直接启用了mirror。如果不需要mirror去掉mirror相关配置<code>MIRROR_PORT_BASE、REPLICATION_PORT_BASE 、MIRROR_REPLICATION_PORT_BASE 、MIRROR_DATA_DIRECTORY</code>注释即可。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># FILE NAME: gpinitsystem_config

# Configuration file needed by the gpinitsystem

################################################
#### REQUIRED PARAMETERS
################################################

#### Name of this Greenplum system enclosed in quotes.
ARRAY_NAME=&quot;mydw&quot;

#### Naming convention for utility-generated data directories.
SEG_PREFIX=gpseg

#### Base number by which primary segment port numbers
#### are calculated.
PORT_BASE=40000

#### File system location(s) where primary segment data directories
#### will be created. The number of locations in the list dictate
#### the number of primary segments that will get created per
#### physical host (if multiple addresses for a host are listed in
#### the hostfile, the number of segments will be spread evenly across
#### the specified interface addresses).
#### 要启动几个segment就写几个，比如下面启动4个segment（每个core对应一个segemnt）
declare -a DATA_DIRECTORY=(/greenplum/primary /greenplum/primary /greenplum/primary /greenplum/primary)

#### OS-configured hostname or IP address of the master host.
MASTER_HOSTNAME=greenplum-001.test.com

#### File system location where the master data directory
#### will be created.
MASTER_DIRECTORY=/greenplum/master

#### Port number for the master instance.
MASTER_PORT=1921

#### Shell utility used to connect to remote hosts.
TRUSTED_SHELL=ssh

#### Maximum log file segments between automatic WAL checkpoints.
CHECK_POINT_SEGMENTS=256

#### Default server-side character set encoding.
ENCODING=UTF-8

################################################
#### OPTIONAL MIRROR PARAMETERS
################################################

#### Base number by which mirror segment port numbers
#### are calculated.
MIRROR_PORT_BASE=50000

#### Base number by which primary file replication port
#### numbers are calculated.
REPLICATION_PORT_BASE=41000

#### Base number by which mirror file replication port
#### numbers are calculated.
MIRROR_REPLICATION_PORT_BASE=51000

#### File system location(s) where mirror segment data directories
#### will be created. The number of mirror locations must equal the
#### number of primary locations as specified in the
#### DATA_DIRECTORY parameter.
#### declare -a MIRROR_DATA_DIRECTORY=(/gpdata/mirror /gpdata/mirror)
#### 有几个primary segment这里就对应的写几个mirror segment，不写则表示不启用高可用特性
declare -a MIRROR_DATA_DIRECTORY=(/greenplum/mirror /greenplum/mirror /greenplum/mirror /greenplum/mirror)


################################################
#### OTHER OPTIONAL PARAMETERS
################################################

#### Create a database of this name after initialization.
DATABASE_NAME=mydw

#### Specify the location of the host address file here instead of
#### with the the -h option of gpinitsystem.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><p>编辑hosts文件，写入所有segent节点的hostname，如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>greenplum-001.test.com
greenplum-002.test.com
greenplum-003.test.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>执行初始化命令：</p> <blockquote><p>gpinitsystem -c gpinitsystem_config -h hosts --max_connections=500 --shared_buffers=256MB</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>[INFO]:-Checking new segment hosts, Completed
[INFO]:-Greenplum Database Creation Parameters
[INFO]:---------------------------------------
[INFO]:-Master Configuration
[INFO]:---------------------------------------
[INFO]:-Master instance name       = mydw
[INFO]:-Master hostname            = greenplum-001.test.com
[INFO]:-Master port                = 1921
[INFO]:-Master instance dir        = /greenplum/master/gpseg-1
[INFO]:-Master LOCALE              = en_US.utf8
[INFO]:-Greenplum segment prefix   = gpseg
[INFO]:-Master Database            = mydw
[INFO]:-Master connections         = 500
[INFO]:-Master buffers             = 256MB
[INFO]:-Segment connections        = 1500
[INFO]:-Segment buffers            = 256MB
[INFO]:-Checkpoint segments        = 256
[INFO]:-Encoding                   = UTF-8
[INFO]:-Postgres param file        = Off
[INFO]:-Initdb to be used          = /usr/local/greenplum-db/./bin/initdb
[INFO]:-GP_LIBRARY_PATH is         = /usr/local/greenplum-db/./lib
[INFO]:-HEAP_CHECKSUM is           = on
[INFO]:-HBA_HOSTNAMES is           = 0
[INFO]:-Ulimit check               = Passed
[INFO]:-Array host connect type    = Single hostname per node
[INFO]:-Master IP address [1]      = x.x.x.x
[INFO]:-Standby Master             = Not Configured
[INFO]:-Number of primary segments = 4
[INFO]:-Total Database segments    = 12
[INFO]:-Trusted shell              = ssh
[INFO]:-Number segment hosts       = 3
[INFO]:-Mirror port base           = 50000
[INFO]:-Number of mirror segments  = 4
[INFO]:-Mirroring config           = ON
[INFO]:-Mirroring type             = Group
[INFO]:----------------------------------------
[INFO]:-Greenplum Primary Segment Configuration
[INFO]:----------------------------------------
[INFO]:-greenplum-001.test.com        /greenplum/primary/gpseg0       40000   2       0
[INFO]:-greenplum-001.test.com        /greenplum/primary/gpseg1       40001   3       1
[INFO]:-greenplum-001.test.com        /greenplum/primary/gpseg2       40002   4       2
[INFO]:-greenplum-001.test.com        /greenplum/primary/gpseg3       40003   5       3
[INFO]:-greenplum-002.test.com        /greenplum/primary/gpseg4       40000   6       4
[INFO]:-greenplum-002.test.com        /greenplum/primary/gpseg5       40001   7       5
[INFO]:-greenplum-002.test.com        /greenplum/primary/gpseg6       40002   8       6
[INFO]:-greenplum-002.test.com        /greenplum/primary/gpseg7       40003   9       7
[INFO]:-greenplum-003.test.com        /greenplum/primary/gpseg8       40000   10      8
[INFO]:-greenplum-003.test.com        /greenplum/primary/gpseg9       40001   11      9
[INFO]:-greenplum-003.test.com        /greenplum/primary/gpseg10      40002   12      10
[INFO]:-greenplum-003.test.com        /greenplum/primary/gpseg11      40003   13      11
[INFO]:---------------------------------------
[INFO]:-Greenplum Mirror Segment Configuration
[INFO]:---------------------------------------
[INFO]:-greenplum-002.test.com        /greenplum/mirror/gpseg0        50000   14      0
[INFO]:-greenplum-002.test.com        /greenplum/mirror/gpseg1        50001   15      1
[INFO]:-greenplum-002.test.com        /greenplum/mirror/gpseg2        50002   16      2
[INFO]:-greenplum-002.test.com        /greenplum/mirror/gpseg3        50003   17      3
[INFO]:-greenplum-003.test.com        /greenplum/mirror/gpseg4        50000   18      4
[INFO]:-greenplum-003.test.com        /greenplum/mirror/gpseg5        50001   19      5
[INFO]:-greenplum-003.test.com        /greenplum/mirror/gpseg6        50002   20      6
[INFO]:-greenplum-003.test.com        /greenplum/mirror/gpseg7        50003   21      7
[INFO]:-greenplum-001.test.com        /greenplum/mirror/gpseg8        50000   22      8
[INFO]:-greenplum-001.test.com        /greenplum/mirror/gpseg9        50001   23      9
[INFO]:-greenplum-001.test.com        /greenplum/mirror/gpseg10       50002   24      10
[INFO]:-greenplum-001.test.com        /greenplum/mirror/gpseg11       50003   25      11

Continue with Greenplum creation Yy|Nn (default=N):
&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>看一下配置，没有错误，输入Y，回车。等待初始化完成即可。</p> <p>运行<code>gpstate</code>命令查看一下集群状态：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[INFO]:-Greenplum instance status summary
[INFO]:-----------------------------------------------------
[INFO]:-   Master instance                                           = Active
[INFO]:-   Master standby                                            = No master standby configured
[INFO]:-   Total segment instance count from metadata                = 24
[INFO]:-----------------------------------------------------
[INFO]:-   Primary Segment Status
[INFO]:-----------------------------------------------------
[INFO]:-   Total primary segments                                    = 12
[INFO]:-   Total primary segment valid (at master)                   = 12
[INFO]:-   Total primary segment failures (at master)                = 0
[INFO]:-   Total number of postmaster.pid files missing              = 0
[INFO]:-   Total number of postmaster.pid files found                = 12
[INFO]:-   Total number of postmaster.pid PIDs missing               = 0
[INFO]:-   Total number of postmaster.pid PIDs found                 = 12
[INFO]:-   Total number of /tmp lock files missing                   = 0
[INFO]:-   Total number of /tmp lock files found                     = 12
[INFO]:-   Total number postmaster processes missing                 = 0
[INFO]:-   Total number postmaster processes found                   = 12
[INFO]:-----------------------------------------------------
[INFO]:-   Mirror Segment Status
[INFO]:-----------------------------------------------------
[INFO]:-   Total mirror segments                                     = 12
[INFO]:-   Total mirror segment valid (at master)                    = 12
[INFO]:-   Total mirror segment failures (at master)                 = 0
[INFO]:-   Total number of postmaster.pid files missing              = 0
[INFO]:-   Total number of postmaster.pid files found                = 12
[INFO]:-   Total number of postmaster.pid PIDs missing               = 0
[INFO]:-   Total number of postmaster.pid PIDs found                 = 12
[INFO]:-   Total number of /tmp lock files missing                   = 0
[INFO]:-   Total number of /tmp lock files found                     = 12
[INFO]:-   Total number postmaster processes missing                 = 0
[INFO]:-   Total number postmaster processes found                   = 12
[INFO]:-   Total number mirror segments acting as primary segments   = 0
[INFO]:-   Total number mirror segments acting as mirror segments    = 12
[INFO]:-----------------------------------------------------
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>psql登录查看版本信息：</p> <blockquote><p>psql -p 1921 -dpostgres</p> <p>postgres=# select version();</p></blockquote> <p>PostgreSQL 9.4.24 (Greenplum Database 6.0.0 build commit:a2ff2fc318c327d702e66ab58ae4aff34c42296c) on x86_64-unknown-linux-gnu, compiled by gcc (GCC) 6.4.0, 64-bit compiled on Aug 28 2019 21:29:36
(1 row)</p> <h2 id="数据库参数调整"><a href="#数据库参数调整" class="header-anchor">#</a> 数据库参数调整</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>gpconfig -c log_statement -v <span class="token string">&quot;all&quot;</span>
gpconfig -c optimizer -v <span class="token string">&quot;off&quot;</span>
gpconfig -c gp_vmem_protect_limit -v <span class="token number">16384</span>
gpconfig -c statement_mem -v <span class="token string">&quot;256MB&quot;</span>
gpconfig -c max_statement_mem -v <span class="token string">&quot;4000MB&quot;</span>
gpconfig -c gp_max_plan_size -v <span class="token string">&quot;200MB&quot;</span>
gpconfig -c max_fsm_pages -v <span class="token number">200000</span>
gpconfig -c TimeZone -v <span class="token string">'PRC'</span>
gpconfig -c track_counts             -v <span class="token string">&quot;on&quot;</span>
gpconfig -c track_activities             -v <span class="token string">&quot;on&quot;</span>
gpconfig -c vacuum_cost_delay          -v <span class="token string">&quot;10ms&quot;</span>
gpconfig -c vacuum_cost_limit          -v <span class="token string">&quot;10000&quot;</span>
gpconfig -c maintenance_work_mem       -v <span class="token string">&quot;4GB&quot;</span>
gpconfig -c log_rotation_age           -v <span class="token string">&quot;3d&quot;</span>
gpconfig -c log_rotation_size          -v <span class="token string">&quot;1GB&quot;</span>
gpconfig -c log_truncate_on_rotation   -v <span class="token string">&quot;on&quot;</span>
gpconfig -c log_checkpoints            -v <span class="token string">&quot;on&quot;</span>
gpconfig -c log_min_duration_statement -v <span class="token string">&quot;600s&quot;</span>
gpconfig -c log_lock_waits             -v <span class="token string">&quot;on&quot;</span>
gpconfig -c gp_segment_connect_timeout             -v <span class="token string">&quot;30min&quot;</span>
gpconfig -c synchronous_commit -v <span class="token string">&quot;off&quot;</span>
gpconfig -c autovacuum_multixact_freeze_max_age -v <span class="token string">&quot;1600000000&quot;</span>
gpconfig -c vacuum_multixact_freeze_table_age -v <span class="token string">&quot;1500000000&quot;</span>
gpconfig -c vacuum_freeze_table_age -v <span class="token string">&quot;1500000000&quot;</span>
gpconfig -c gp_default_storage_options -v <span class="token string">&quot;appendonly=false,blocksize=32768,compresstype=quicklz,checksum=true,orientation=column&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>执行gpstop -u，使得参数更改生效。</p> <h2 id="账号配置"><a href="#账号配置" class="header-anchor">#</a> 账号配置</h2> <p><strong>新建用户gpmon</strong></p> <blockquote><p>create user gpmon PASSWORD 'xxx123' CONNECTION LIMIT 3 NOCREATEROLE;</p></blockquote> <p>编辑/greenplum/master/gpseg-1/pg_hba.conf，根据需要增加内容，如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>local all all trust
# all user need password
host   all  all  0.0.0.0/0   password
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>执行<code>pg_ctl reload -D /greenplum/master/gpseg-1</code> ，以上配置才生效。</p> <p><strong>授权：</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">on</span> <span class="token keyword">database</span> xx <span class="token keyword">to</span> xxs<span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">on</span> <span class="token keyword">schema</span> xx <span class="token keyword">to</span> xxs<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="master节点高可用配置"><a href="#master节点高可用配置" class="header-anchor">#</a> Master节点高可用配置</h2> <p>master节点的高可用是通过增加standby节点实现的，添加方法有两种：</p> <ul><li>gpinitsystem时增加<code>-s standby_hostname</code></li> <li>gpinitstandby -s standby_hostname</li></ul> <p><code>gpstate -f</code> 检查状态</p> <p><code>gpactivatestandby</code> 激活standby</p> <h2 id="配置gphdfs"><a href="#配置gphdfs" class="header-anchor">#</a> 配置gphdfs</h2> <p>由于6.0版本开始，gphdfs协议已经取消了，取代的是pxf，这里简单介绍一下gphdfs的配置方法，仅适用于6.0之前的版本。</p> <h3 id="安装hadoop-client"><a href="#安装hadoop-client" class="header-anchor">#</a> 安装hadoop client</h3> <p>在所有节点上安装与你的hadoop集群一致的hadoop client，这里我把client放到/usr/local/hadoop-3.1.0目录。</p> <p>修改greenplum_path.sh，增加hadoop路径配置。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;&gt;</span>/usr/local/greenplum-db/greenplum_path.sh
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/usr/local/hadoop-3.1.0
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token punctuation">\</span><span class="token variable">$HADOOP_HOME</span>/bin:<span class="token punctuation">\</span><span class="token variable">$HADOOP_HOME</span>/sbin:<span class="token punctuation">\</span><span class="token environment constant">$PATH</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MASTER_DATA_DIRECTORY</span><span class="token operator">=</span>/greenplum/master/gpseg-1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">PGPORT</span><span class="token operator">=</span><span class="token number">1921</span>
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="配置gphdfs-2"><a href="#配置gphdfs-2" class="header-anchor">#</a> 配置gphdfs</h3> <p><strong>6版本之后已经被pxf取代</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>gpconfig -c gp_hadoop_home -v <span class="token string">&quot;'/usr/local/hadoop-3.1.0'&quot;</span>
gpconfig -c gp_hadoop_target_version -v <span class="token string">&quot;'hadoop'&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>gpstop -u</code> 使配置生效。</p> <h3 id="数据加载测试"><a href="#数据加载测试" class="header-anchor">#</a> 数据加载测试</h3> <p><strong>新建外部表</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> test_gphdfs <span class="token punctuation">(</span>
    a <span class="token keyword">text</span><span class="token punctuation">,</span>
    b <span class="token keyword">bigint</span>
<span class="token punctuation">)</span> LOCATION <span class="token punctuation">(</span>
    <span class="token string">'gphdfs://xx.xx.xx.xx:9820/2018/2018-10-19/part-*'</span>
<span class="token punctuation">)</span> FORMAT <span class="token string">'text'</span> <span class="token punctuation">(</span><span class="token keyword">delimiter</span> E<span class="token string">'\t'</span> <span class="token boolean">null</span> E<span class="token string">''</span> <span class="token keyword">escape</span> E<span class="token string">'\\'</span><span class="token punctuation">)</span>
ENCODING <span class="token string">'UTF8'</span>
LOG <span class="token keyword">ERRORS</span> SEGMENT REJECT <span class="token keyword">LIMIT</span> <span class="token number">1</span> <span class="token keyword">PERCENT</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>加载外部表数</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> gphdfs <span class="token keyword">select</span> a<span class="token punctuation">,</span>b <span class="token keyword">from</span> test_gphdfs<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="pxf"><a href="#pxf" class="header-anchor">#</a> PXF</h2> <p>The Greenplum Platform Extension Framework (PXF) provides parallel, high throughput data access and federated queries across heterogeneous data sources via built-in connectors that map a Greenplum Database external table definition to an external data source. PXF has its roots in the Apache HAWQ project.</p> <ul><li>(可选) yum install krb5-libs krb5-workstation</li> <li>(可选) copy /etc/krb5.conf 到所有segment节点的/etc目录下</li> <li>(可选) 生成访问k8s的用户及key文件，默认放到是<code>$PXF_CONF/keytabs/pxf.service.keytab</code></li> <li><code>sed -i 's/connectionTimeout=&quot;20000&quot;/connectionTimeout=&quot;86400000&quot;/g' /usr/local/greenplum-db/pxf/pxf-service/conf/server.xml</code></li> <li>export PXF_CONF=/usr/local/greenplum-db/greenplum-pxf</li> <li>pxf cluster init</li> <li>mkdir -p /usr/local/greenplum-db/greenplum-pxf/servers/hdp3，也可以使用默认的default目录。</li> <li>copy hadoop集群的<code>hdfs-site.xml</code>,<code>core-site.xml</code>,<code>mapred-site.xml</code>,<code>yarn-site.xml</code>文件到<code>hdp3</code>目录下。</li> <li>copy pxf-site.xml 文件到<code>hdp3</code>目录下（基于kerberos的hadoop集群需要）。</li> <li>删除pxf-site.xml里面的<code>pxf.service.user.name</code>配置项目。</li> <li>修改conf目录下的pxf-env.sh的PXF_USER_IMPERSONATION=false。</li> <li>pxf cluster sync</li> <li>pxf cluster start</li> <li>测试</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTENSION pxf<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> EXTERNAL <span class="token keyword">TABLE</span> test<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> test <span class="token punctuation">(</span>
    offsetid <span class="token keyword">bigint</span><span class="token punctuation">,</span>
    tdid <span class="token keyword">text</span><span class="token punctuation">,</span>
    monthid <span class="token keyword">integer</span><span class="token punctuation">,</span>
    app_install <span class="token keyword">bigint</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> LOCATION <span class="token punctuation">(</span>
    <span class="token string">'pxf://data/pxf_examples/part-00000?PROFILE=hdfs:text&amp;SERVER=hdp3'</span>
<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">ALL</span> FORMAT <span class="token string">'text'</span> <span class="token punctuation">(</span><span class="token keyword">delimiter</span> E<span class="token string">'\t'</span> <span class="token boolean">null</span> E<span class="token string">''</span> <span class="token keyword">escape</span> E<span class="token string">'\\'</span><span class="token punctuation">)</span>
ENCODING <span class="token string">'UTF8'</span>
SEGMENT REJECT <span class="token keyword">LIMIT</span> <span class="token number">10</span> <span class="token keyword">PERCENT</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li><p>select count(*) from test;</p> <blockquote><p>注意：不支持开启了Erasure Coding Policies的目录及文件的读取。</p></blockquote></li></ul> <h2 id="gpcopy"><a href="#gpcopy" class="header-anchor">#</a> gpcopy</h2> <h2 id="故障恢复"><a href="#故障恢复" class="header-anchor">#</a> 故障恢复</h2> <p>正常情况下执行<code>gpstate -e</code>，输出是这样的。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[INFO]:-----------------------------------------------------
[INFO]:-Segment Mirroring Status Report
[INFO]:-----------------------------------------------------
[INFO]:-All segments are running normally
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="primary节点故障"><a href="#primary节点故障" class="header-anchor">#</a> primary节点故障</h3> <p>primary节点故障后，原来的mirror会提升为primary。执行<code>gpstate -e</code>查看。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[INFO]:-Downed Segments (may include segments where status could not be retrieved)
[INFO]:-   Segment                  Port    Config status   Status
[INFO]:-   greenplum-002.test.com   40002   Up              Process error -- database process may be down
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>恢复：</strong></p> <p><code>gprecoverseg -a</code></p> <p>再次执行<code>gpstate -e</code>查看，角色发生了变化。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[INFO]:-Segments with Primary and Mirror Roles Switched
[INFO]:-   Current Primary          Port    Mirror                   Port
[INFO]:-   greenplum-003.test.com   50002   greenplum-002.test.com   40002
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>角色切换</strong></p> <p>执行<code>gprecoverseg -r</code>，恢复角色，这个操作会阻塞其他操作，需要在业务低峰时间执行。</p> <h3 id="mirror节点故障"><a href="#mirror节点故障" class="header-anchor">#</a> mirror节点故障</h3> <p>同<strong>rimary节点故障</strong>恢复步骤，唯一不同是最后一步不需要执行，因为没有发生角色切换。</p> <h2 id="tpch测试"><a href="#tpch测试" class="header-anchor">#</a> TPCH测试</h2> <ol><li>下载pg_tpch - <code>wget https://github.com/tvondra/pg_tpch/archive/master.zip</code></li> <li>下载tpch-dbgen - <code>git clone https://github.com/electrum/tpch-dbgen.git</code></li> <li>修改makefile中的几个参数：</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">################</span>
<span class="token comment">## CHANGE NAME OF ANSI COMPILER HERE</span>
<span class="token comment">################</span>
CC      <span class="token operator">=</span> gcc
<span class="token comment"># Current values for DATABASE are: INFORMIX, DB2, TDAT (Teradata)</span>
<span class="token comment">#                                  SQLSERVER, SYBASE, ORACLE, VECTORWISE</span>
<span class="token comment"># Current values for MACHINE are:  ATT, DOS, HP, IBM, ICL, MVS,</span>
<span class="token comment">#                                  SGI, SUN, U2200, VMS, LINUX, WIN32</span>
<span class="token comment"># Current values for WORKLOAD are:  TPCH</span>
<span class="token assign-left variable">DATABASE</span><span class="token operator">=</span>ORACLE
MACHINE <span class="token operator">=</span> LINUX
WORKLOAD <span class="token operator">=</span> TPCH
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="4"><li>安装 - <code>make</code></li> <li>使用dbgen产生测试数据, -s表示scale（单位为GB) - <code>./dbgen -s 100 f</code></li> <li>将数据转换为postgresql识别的格式，删除末尾的分隔符| - <code>for i in</code>ls *.tbl<code>; do sed 's/|$//' $i &gt; ${i/tbl/csv}; done</code></li> <li>将pg_tpch的文件逗拷贝到dbgen下面 - <code>cp -r * ../tpch-dbgen</code></li> <li>生成测试SQL , SF=dbgen指定的scale值</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>SF=100
mkdir dss/queries
for q in `seq 1 22`
do
    DSS_QUERY=dss/templates ./qgen -s $SF $q &gt; dss/queries/$q.sql
    sed 's/^select/explain select/' dss/queries/$q.sql &gt; dss/queries/$q.explain.sql
done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="9"><li>在greenplum数据库中创建数据库和用户</li> <li>加载测试数据 - <code>./tpch.sh ./results localhost 5432 tpch gpadmin password {row|column}</code></li> <li>生成报告 - <code>php process.php ./results output.csv</code></li> <li>测试结果</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>2019-12-04 10:40:36 [1575427236] : preparing TPC-H database
2019-12-04 10:40:36 [1575427236] :   loading data
2019-12-04 10:40:37 [1575427237] :   creating primary keys
2019-12-04 10:40:37 [1575427237] :   creating foreign keys
2019-12-04 10:40:37 [1575427237] :   creating indexes
2019-12-04 10:40:37 [1575427237] :   analyzing
2019-12-04 10:40:38 [1575427238] : running TPC-H benchmark
2019-12-04 10:40:38 [1575427238] : running queries defined in TPC-H benchmark
2019-12-04 10:40:38 [1575427238] : finished TPC-H benchmark
2019-12-04 12:06:01 [1575432361] : preparing TPC-H database
2019-12-04 12:06:01 [1575432361] :   loading data
2019-12-04 12:07:20 [1575432440] : preparing TPC-H database
2019-12-04 12:07:20 [1575432440] :   loading data
2019-12-04 12:44:26 [1575434666] :   creating primary keys
2019-12-04 12:44:26 [1575434666] :   creating foreign keys
2019-12-04 12:44:26 [1575434666] :   creating indexes
2019-12-04 12:47:00 [1575434820] :   analyzing
2019-12-04 12:47:14 [1575434834] : running TPC-H benchmark
2019-12-04 12:47:14 [1575434834] : running queries defined in TPC-H benchmark
2019-12-04 12:47:14 [1575434834] :   running query 1
2019-12-04 12:47:49 [1575434869] :     query 1 finished OK (34 seconds)
2019-12-04 12:47:49 [1575434869] :   running query 2
2019-12-04 12:47:56 [1575434876] :     query 2 finished OK (5 seconds)
2019-12-04 12:47:56 [1575434876] :   running query 3
2019-12-04 12:48:07 [1575434887] :     query 3 finished OK (10 seconds)
2019-12-04 12:48:07 [1575434887] :   running query 4
2019-12-04 12:48:17 [1575434897] :     query 4 finished OK (9 seconds)
2019-12-04 12:48:17 [1575434897] :   running query 5
2019-12-04 12:48:33 [1575434913] :     query 5 finished OK (15 seconds)
2019-12-04 12:48:33 [1575434913] :   running query 6
2019-12-04 12:48:38 [1575434918] :     query 6 finished OK (4 seconds)
2019-12-04 12:48:38 [1575434918] :   running query 7
2019-12-04 12:48:48 [1575434928] :     query 7 finished OK (9 seconds)
2019-12-04 12:48:48 [1575434928] :   running query 8
2019-12-04 12:48:58 [1575434938] :     query 8 finished OK (9 seconds)
2019-12-04 12:48:58 [1575434938] :   running query 9
2019-12-04 12:49:27 [1575434967] :     query 9 finished OK (27 seconds)
2019-12-04 12:49:27 [1575434967] :   running query 10
2019-12-04 12:49:36 [1575434976] :     query 10 finished OK (8 seconds)
2019-12-04 12:49:36 [1575434976] :   running query 11
2019-12-04 12:49:40 [1575434980] :     query 11 finished OK (3 seconds)
2019-12-04 12:49:40 [1575434980] :   running query 12
2019-12-04 12:49:48 [1575434988] :     query 12 finished OK (7 seconds)
2019-12-04 12:49:48 [1575434988] :   running query 13
2019-12-04 12:49:56 [1575434996] :     query 13 finished OK (8 seconds)
2019-12-04 12:49:56 [1575434996] :   running query 14
2019-12-04 12:50:02 [1575435002] :     query 14 finished OK (5 seconds)
2019-12-04 12:50:02 [1575435002] :   running query 15
2019-12-04 12:50:12 [1575435012] :     query 15 finished OK (9 seconds)
2019-12-04 12:50:12 [1575435012] :   running query 16
2019-12-04 12:50:16 [1575435016] :     query 16 finished OK (3 seconds)
2019-12-04 12:50:16 [1575435016] :   running query 17
2019-12-04 12:51:24 [1575435084] :     query 17 finished OK (67 seconds)
2019-12-04 12:51:24 [1575435084] :   running query 18
2019-12-04 12:52:07 [1575435127] :     query 18 finished OK (42 seconds)
2019-12-04 12:52:07 [1575435127] :   running query 19
2019-12-04 12:52:13 [1575435133] :     query 19 finished OK (5 seconds)
2019-12-04 12:52:13 [1575435133] :   running query 20
2019-12-04 12:52:27 [1575435147] :     query 20 finished OK (12 seconds)
2019-12-04 12:52:27 [1575435147] :   running query 21
2019-12-04 12:52:54 [1575435174] :     query 21 finished OK (25 seconds)
2019-12-04 12:52:54 [1575435174] :   running query 22
2019-12-04 12:53:01 [1575435181] :     query 22 finished OK (6 seconds)
2019-12-04 12:53:01 [1575435181] : finished TPC-H benchmark
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div></div></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/07/10, 18:07:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/pages/441817/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">
        Greenplum架构介绍
      </div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/441817/">Greenplum架构介绍</a>
        →
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/fe6a06/"><div>分区维护</div></a> <span>11-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ca2bd6/"><div>验证write ahead是否有效</div></a> <span>10-16</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/64607c/"><div>使用undrop-for-innodb恢复数据</div></a> <span>09-25</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> </main></div> <div class="footer"><div class="icons"><a href="mailto:583675636@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
     | Copyright © 2020-2020
    <span>yong.wei | <a href="" target="_blank"></a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b45ba360.js" defer></script><script src="/assets/js/2.6eac6864.js" defer></script><script src="/assets/js/3.a88a92d5.js" defer></script><script src="/assets/js/37.0cb9802c.js" defer></script>
  </body>
</html>
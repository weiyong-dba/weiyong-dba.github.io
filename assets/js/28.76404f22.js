(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{449:function(s,a,e){"use strict";e.r(a);var t=e(51),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"mysql备份恢复实践"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql备份恢复实践"}},[s._v("#")]),s._v(" MySQL备份恢复实践")]),s._v(" "),e("h2",{attrs:{id:"备份方式介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#备份方式介绍"}},[s._v("#")]),s._v(" 备份方式介绍")]),s._v(" "),e("p",[s._v("mysql单表备份主要有以下几种方式：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("mysqldump")]),s._v(" "),e("p",[s._v("优点：")]),s._v(" "),e("ul",[e("li",[s._v("简单")])]),s._v(" "),e("p",[s._v("缺点：")]),s._v(" "),e("ul",[e("li",[s._v("效率低，尤其是大表恢复起来非常慢，超过1G的表基本不用考虑。")])])]),s._v(" "),e("li",[e("p",[s._v("文本文件")]),s._v(" "),e("p",[s._v("把表数据导成文本文件，使用source导入恢复。效率比mysqldump高，但是如果字段内容含有blob类型则不适用。")])]),s._v(" "),e("li",[e("p",[s._v("myisam")]),s._v(" "),e("p",[s._v("如果是innodb表，可以先转换成myisam存储引擎，然后copy相关文件即可。大部分时间都消耗在引擎转换上。")])]),s._v(" "),e("li",[e("p",[s._v("传输表空间")]),s._v(" "),e("p",[s._v("普适方法，尤其处理大表效率高。当表含有日期时间类型字段时可能有错误，我在这篇文章"),e("RouterLink",{attrs:{to:"/2019/09/04/mysql-transfer-tablespace-error-1808/"}},[s._v("MySQL传输表空间错误ERROR 1808 (HY000)处理")]),s._v("里面描述了处理过程。")],1)]),s._v(" "),e("li",[e("p",[s._v("innobackupex")]),s._v(" "),e("p",[s._v("热备，全量备份。")])])]),s._v(" "),e("h2",{attrs:{id:"innobackupex"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#innobackupex"}},[s._v("#")]),s._v(" innobackupex")]),s._v(" "),e("p",[s._v("innobackupex主要用于数据库的全量备份，支持备份到本地，也支持备份到远程服务器，下面介绍使用innobackupex进行备份恢复的方法。")]),s._v(" "),e("p",[e("strong",[s._v("备份命令：")])]),s._v(" "),e("ul",[e("li",[s._v("备份到本机")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" innobackupex --defaults-file"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/mysql3307/etc/my.cnf --compress --user"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("backup --password"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("backuppass --parallel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" /backup/mysql3307 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("远程备份")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("innobackupex --defaults-file"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --lock-wait-timeout"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" --slave-info --safe-slave-backup --compress --parallel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" --user"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysqluser --password"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mypass --tmpdir"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup --stream"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xbstream /backup "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" backup@remote_host_ip "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xbstream -x -C /backup"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("恢复命令：")])]),s._v(" "),e("p",[s._v("如果备份的时候使用了compress选项，恢复时需要先decompress。")]),s._v(" "),e("ul",[e("li",[s._v("解压")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("innobackupex --apply-log  --decompress --parallel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" /backup\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("应用日志")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("innobackupex --apply-log --parallel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" /backup\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("单表恢复（使用import tablespace 恢复）")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("innobackupex --apply-log --export /backup\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);
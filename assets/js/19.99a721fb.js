(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{465:function(_,t,v){"use strict";v.r(t);var e=v(51),r=Object(e.a)({},(function(){var _=this,t=_.$createElement,v=_._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"mysql传输表空间错误error-1808-hy000-处理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mysql传输表空间错误error-1808-hy000-处理"}},[_._v("#")]),_._v(" MySQL传输表空间错误ERROR 1808 (HY000)处理")]),_._v(" "),v("h2",{attrs:{id:"前言"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[_._v("#")]),_._v(" 前言")]),_._v(" "),v("p",[_._v("在MySQL运维过程中，经常遇到单个innodb表迁移的情况，迁移的方法大概有以下几种：")]),_._v(" "),v("ul",[v("li",[_._v("select into outfile，导出文本文件，再load data infile")]),_._v(" "),v("li",[_._v("mysqldump")]),_._v(" "),v("li",[_._v("修改引擎为myisam，copy表文件")]),_._v(" "),v("li",[_._v("传输表空间")])]),_._v(" "),v("p",[_._v("以上前3种方法在数据量不大的情况下使用很方便快捷，但是如果表的数据量很大，占用磁盘空间TB以上时，迁移速度几乎无法接受。传输表空间就是为了解决这个问题而生的，当处理几十甚至上白GB的表时，速度也是可以接受的。")]),_._v(" "),v("p",[_._v("同时传输表空间也有局限，当表包含DATETIME和TIMESTAMP类型的字段时，操作失败，报错如下：")]),_._v(" "),v("blockquote",[v("p",[_._v("ERROR 1808 (HY000): Schema mismatch (Column optime precise type mismatch.)")])]),_._v(" "),v("p",[_._v("解决这个问题的变通方法是:")]),_._v(" "),v("ol",[v("li",[_._v("将原始的.frm文件修改为使用Memory存储引擎")]),_._v(" "),v("li",[_._v("然后使用alter table xxx engine=innodb")]),_._v(" "),v("li",[_._v("alter table xxx import tablespace")])]),_._v(" "),v("h2",{attrs:{id:"详细步骤"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#详细步骤"}},[_._v("#")]),_._v(" 详细步骤")]),_._v(" "),v("p",[_._v("将表的原始.frm文件复制到要导入表空间的服务器上的数据目录。")]),_._v(" "),v("p",[_._v("修改表的.frm文件以使用Memory存储引擎,此修改需要在.frm文件中更改7个字节，以定义表的存储引擎类型。使用十六进制编辑工具：")]),_._v(" "),v("p",[_._v("更改偏移位置0003处的字节，即legacy_db_type从 0c（for InnoDB）到06 （for Memory），如下所示：")]),_._v(" "),v("blockquote",[v("p",[_._v("00000000  fe 01 09 "),v("strong",[_._v("06")]),_._v(" 03 00 00 10  01 00 00 30 00 00 10 00")])]),_._v(" "),v("p",[_._v("剩下的6个字节没有固定的偏移量。在.frm文件中 搜索“ InnoDB”以找到其他6个字节的行。该行显示如下：")]),_._v(" "),v("blockquote",[v("p",[_._v("00001010  ff 00 00 00 00 00 00 06  00 49 6e 6e 6f 44 42 00  |.........InnoDB.|")])]),_._v(" "),v("p",[_._v("修改字节，使行显示如下：")]),_._v(" "),v("blockquote",[v("p",[_._v("00001010  ff 00 00 00 00 00 00 06 00 "),v("strong",[_._v("4d 45 4d 4f 52 59")]),_._v(" 00")])]),_._v(" "),v("p",[_._v("运行"),v("code",[_._v("ALTER TABLE ... ENGINE=INNODB")]),_._v("以将表定义添加到InnoDB数据字典。这将创建InnoDB 具有新格式的时态数据类型的表。")]),_._v(" "),v("p",[_._v("使用导入表 ALTER TABLE ... IMPORT TABLESPACE。")]),_._v(" "),v("h2",{attrs:{id:"例外"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#例外"}},[_._v("#")]),_._v(" 例外")]),_._v(" "),v("p",[_._v("如果表有外键，需要先删除外键，再执行上面的导入步骤。删除所有外键并按照"),v("a",{attrs:{href:""}},[_._v("情况1")]),_._v("完成表导入过程。导入操作完成后，重新定义外键。")])])}),[],!1,null,null,null);t.default=r.exports}}]);